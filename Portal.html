<!DOCTYPE html>

<html lang="pt-BR">
<head>
<link rel="icon" type="image/png" href="tryvia.png" />
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
button, a.button, .btn {
    font-weight: 500;
}

button:contains('Ver Ata'),
a:contains('Ver Ata'),
.ver-ata,
.ver-ata-btn {
    background-color: #0288d1 !important;
    color: white !important;
}

.reuniao-item,
.ata-box,
.ata-list,
.card,
.card-body,
.reuniao-card {
    background-color: rgba(179, 229, 252, 0.95) !important;
    color: #000000 !important;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
</style>


<style>
.reuniao-item,
.ata-box,
.ata-list,
.card,
.card-body,
.reuniao-card {
    background-color: rgba(179, 229, 252, 0.95) !important;
    color: #000000 !important;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.ata-card,
.ata-container,
.reuniao-card,
.reuniao-item,
.reuniao-box {
    background-color: rgba(179, 229, 252, 0.95) !important; 
    color:#81d2d9 !important;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}</style>


<style>
.dashboard-card button,
.dashboard-card a.btn,
.dashboard-card a {
    background-color: #0288d1 !important; 
    color: #ffffff !important;
    font-weight: bold;
    border-radius: 6px;
    padding: 8px 16px;
    border: none;
    transition: background-color 0.3s ease;
}
.dashboard-card button:hover,
.dashboard-card a.btn:hover,
.dashboard-card a:hover {
    background-color: #0277bd !important;
}
</style>


<style>
.dashboard-card button,
.dashboard-card .btn,
.dashboard-card .acessar-btn {
    background-color: #4fc3f7 !important; 
    color: #ffffff !important;
    font-weight: bold;
    border: none;
    transition: background-color 0.3s ease;
}
.dashboard-card button:hover,
.dashboard-card .btn:hover,
.dashboard-card .acessar-btn:hover {
    background-color: #29b6f6 !important;
}
</style>


<style>
.profile-info span {
    color: #ffffff !important;
}
</style>


<style>
header h1, .top-bar h1, .top-bar-title, .header-title {
    color: #ffffff !important;
}
</style>


<style>
.content-section,
.form-container,
.documents-grid,
.dashboards-grid,
.clients-grid,
#homologacao,
#release,
#reunioes,
#documents,
#relatorio-visita,
#relatorioVisita,
#cadastro-release,
#cadastroReuniao,
#cadastro-documento,
#cadastroHomologacao,
.homologacao-card,
.modal-content,
.dashboard-card,
.client-card,
.client-card-vertical {
    background-color: rgba(179, 229, 252, 0.95) !important;
    color: #000000 !important;
}

input,
textarea,
select {
    background-color: #ffffff !important;
    color: #000000 !important;
    border-color: #999 !important;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<meta charset="utf-8"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Portal</title>
<style>
        /* CSS */
        
:root {
    --primary-color: #b3e5fc;
    --secondary-color: #81d4fa;
    --accent-color: #4fc3f7;
    --hover-color: #29b6f6;
    --dark-bg: #a1dbe9;
    --error-color: #f44336;
    --success-color: #4caf50;
    --text-color: #000000;
    --text-dark: #333333;
    --shadow-color: #29b6f647;
}


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(145deg, #0a2b59 0%, #0a2b59 100%);
            min-height: 100vh;
            color: var(--text-color);
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #ffffff;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
        }

        .logo-container {
            margin-bottom: 20px;
            padding-bottom: 0px;
            border-bottom: none;
            width: 100%;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .your-custom-logo {
            width: 180px;
            height: auto;
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }

        .nav-list {
            list-style: none;
            width: 100%;
        }

        .nav-item {
            margin: 10px 0;
            width: 100%;
        }

        .nav-item a, .nav-item button {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #333333;
            text-decoration: none;
            font-size: 1.1em;
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
            width: 100%;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
        }

        .nav-item a:hover, .nav-item button:hover, 
.nav-item.active a,
.nav-item.active button {
    background-color: var(--secondary-color) !important;
    color: #ffffff !important;
    transform: translateX(5px);
}


        .nav-item i {
            margin-right: 15px;
            font-size: 1.3em;
        }

        .main-content {
            margin-left: 250px;
            padding: 30px;
            flex-grow: 1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 20px 25px;
            border-radius: 12px;
        }

        .header h1 {
            font-size: 2.2em;
            color: var(--text-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .profile-info {
            display: flex;
            align-items: center;
        }

        .profile-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid var(--accent-color);
        }

        .profile-info span {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--text-color);
        }

        .content-section {
            display: none;
            background-color: #000000;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            min-height: 70vh;
        }

        .content-section.active {
            display: block;
        }

        #gestao.active {
            display: block;
        }

        /* Forms */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            background-color: #000000;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: bold;
            color: rgba(var(--text-color-rgb), 0.9);
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group input[type="url"],
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background-color: #ffffff;
            color: var(--text-color);
            font-size: 1em;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #999;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--accent-color);
            background-color: #ffffff;
            outline: none;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 10px;
        }

        .btn-primary {
            background-color:#29b6f6;
            color: var(--text-color);
            box-shadow: 0 2px 5px #29b6f6;
        }

        .btn-primary:hover {
            background-color:#29b6f6;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color:#29b6f6;
            color: var(--text-color);
            box-shadow: 0 2px 5px rgba(0,0,128,0.5);
        }

        .btn-secondary:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s ease, background-color 0.3s ease;
            margin-top: 5px;
        }

        .upload-area:hover {
            border-color: var(--accent-color);
            background-color: rgba(0, 0, 0, 0.85);
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 10px;
            color: rgba(var(--text-color-rgb), 0.8);
        }

        .upload-area p {
            color: rgba(var(--text-color-rgb), 0.7);
            font-size: 1.1em;
        }

        
        .documents-grid, .clients-grid, .dashboards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            padding: 20px;
            background-color: #000000;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            min-height: 200px;
        }

        .document-card, .client-card, .dashboard-card {
            background-color: #89ceee;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .document-card:hover, .client-card:hover, .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .document-header, .client-card-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .document-type, .client-status-card {
            background-color: #29b6f6;
            color: var(--text-dark);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .client-status-card {
            background-color: var(--success-color);
            color: var(--text-color);
        }

        .delete-btn, .delete-btn-card {
            background: none;
            border: none;
            color: rgba(var(--text-color-rgb), 0.7);
            font-size: 1.2em;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .delete-btn:hover, .delete-btn-card:hover {
            color: var(--error-color);
        }

        .document-title, .client-name {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #000000;
        }

        .document-author, .client-email, .client-phone {
            font-size: 0.95em;
            color: rgba(var(--text-color-rgb), 0.7);
            margin-bottom: 10px;
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px 20px;
            color: rgba(var(--text-color-rgb), 0.6);
            font-size: 1.2em;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: rgba(var(--text-color-rgb), 0.4);
        }

        
        .client-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .client-tab-button {
            padding: 15px 25px;
            border: none;
            background: none;
            color: rgba(var(--text-color-rgb), 0.7);
            font-size: 1.1em;
            cursor: pointer;
            transition: color 0.3s ease, border-bottom 0.3s ease;
            margin-right: 15px;
            border-bottom: 2px solid transparent;
        }

        .client-tab-button.active {
            color: var(--text-color);
            border-bottom-color: var(--accent-color);
            font-weight: bold;
        }

        .client-tab-button:hover {
            color: var(--text-color);
        }

        .client-tab-content {
            display: none;
        }
        
        #add-client .upload-area {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 150px;
            cursor: pointer;
        }

        #add-client .upload-area:hover {
            background-color: rgba(0, 0, 0, 0.85);
        }

        #add-client .logo-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: contain;
            margin-bottom: 10px;
        }

       
        .products-section {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .products-section h4 {
            margin-bottom: 15px;
            color: var(--text-color);
        }
        .products-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .product-item {
            background-color: rgba(255, 255, 255, 0.85);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-color);
            font-size: 0.9em;
            white-space: nowrap;
        }
        .product-item .delete-btn {
            font-size: 1em;
            padding: 3px 6px;
            background-color: rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            line-height: 1;
            color: var(--text-color);
            transition: background-color 0.2s ease;
        }
        .product-item .delete-btn:hover {
            background-color: rgba(255, 0, 0, 0.8);
        }
        #productsList {
            margin-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 15px;
            display: none;
        }

        /* Client Card Vertical (for view-clients tab) */
        .clients-grid {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }
        .form-row {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background-color: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 5px rgba(79, 195, 247, 0.3);
        }

        .client-card-vertical {
            background-color: #000000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
        }

        .client-card-vertical:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .client-card-top {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .delete-btn-card {
            background-color: rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            color: var(--text-color);
            font-size: 18px;
        }

        .delete-btn-card:hover {
            background-color: rgba(255, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .client-logo-vertical {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
            margin-left: 70px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .logo-preview-vertical {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .add-logo-text {
            font-size: 0.8em;
            color: rgba(var(--text-color-rgb), 0.6);
            margin-bottom: 10px;
        }

        .client-name-vertical {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-color);
            word-break: break-word;
        }

        .client-status-text {
            font-size: 0.9em;
            color: var(--success-color);
            margin-bottom: 15px;
        }

        .products-info-vertical {
            width: 100%;
            text-align: left;
            margin-bottom: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 15px;
        }

        .btn-vertical {
            padding: 10px 20px;
            background-color:#29b6f6;
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 90%;
            margin-bottom: 10px;
        }

        .btn-vertical:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        .btn-vertical.edit {
            background-color:#29b6f6;
            color: var(--text-color);
        }

        .btn-vertical.edit:hover {
            background-color:#29b6f6;
        }

      
        .dashboard-card {
            padding: 25px;
            background-color: #000000;
            text-align: center;
            justify-content: flex-start;
        }

        .dashboard-card .client-logo-vertical {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px auto;
        }

        .dashboard-card h3 {
            font-size: 1.6em;
            margin-bottom: 15px;
            color: #000000;
        }

        .btn-bi {
            background-color: #29b6f6;
            color: var(--text-color);
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: auto;
        }

        .btn-bi:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

       
        @media (max-width: 992px) {
            .sidebar {
                width: 200px;
            }
            .main-content {
                margin-left: 200px;
                padding: 20px;
            }
            .header h1 {
                font-size: 1.8em;
            }
            .nav-item a, .nav-item button {
                font-size: 1em;
                padding: 10px 15px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: static;
                width: 100%;
                height: auto;
                flex-direction: row;
                justify-content: center;
                padding: 15px;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }
            .logo-container {
                display: block;
                width: auto;
                text-align: center;
                margin-bottom: 15px;
            }
            .sidebar h2 {
                display: none;
            }
            .nav-list {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            .nav-item {
                margin: 5px;
                width: auto;
            }
            .nav-item a, .nav-item button {
                font-size: 0.9em;
                padding: 8px 12px;
            }
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
            .header {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }
            .header h1 {
                margin-bottom: 10px;
            }
            .form-row {
                flex-direction: column;
            }
            .documents-grid, .clients-grid, .dashboards-grid {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            .client-tabs {
                flex-direction: column;
            }
            .client-tab-button {
                margin-bottom: 10px;
                margin-right: 0;
                text-align: center;
            }
        }

     
        #homologacao,
        #homologacao .form-group,
        #homologacao .upload-area,
        #homologacao .tab-content,
        #homologacao .header,
        #homologacao .filters-section,
        #homologacao .form-row {
            background-color:#b3e5fc;
            color: var(--text-color);
            border-radius: 8px;
            padding: 10px;
        }

        #homologacao input,
        #homologacao select,
        #homologacao textarea {
            background-color: #ffffff;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 10px;
        }

        #homologacao input::placeholder,
        #homologacao textarea::placeholder {
            color: rgba(0, 0, 0, 0.85);
        }

        #homologacao .upload-area:hover {
            background-color: rgba(0, 0, 0, 0.85);
        }

        #homologacao .tab-button {
            background: none;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 6px;
            margin-right: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #homologacao .tab-button.active,
        #homologacao .tab-button:hover {
            background-color: rgba(0, 0, 0, 0.85);
        }

      
        #homologacoesGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .homologacao-card {
            background-color: #000000;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .homologacao-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .homologacao-card h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }

        .homologacao-card p {
            font-size: 0.95em;
            margin-bottom: 6px;
            color: rgba(0, 0, 0, 0.85);
        }

        .homologacao-card .btn-exportar {
            background-color: var(--accent-color);
            color: var(--text-color);
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .homologacao-card .btn-exportar:hover {
            background-color: var(--hover-color);
        }

        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #000000;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
            width: 90%;
            color: var(--text-color);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.visible .modal-content {
            transform: translateY(0);
        }

        .modal-content h3 {
            margin-bottom: 20px;
            font-size: 1.5em;
            color: var(--accent-color);
        }

        .modal-content p {
            margin-bottom: 25px;
            font-size: 1.1em;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-button {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .modal-button.confirm {
            background-color: var(--error-color);
            color: var(--text-color);
        }

        .modal-button.confirm:hover {
            background-color: #d32f2f;
        }

        .modal-button.cancel {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .modal-button.cancel:hover {
            background-color: var(--hover-color);
        }

        .modal-button.ok {
            background-color: var(--success-color);
            color: var(--text-color);
        }

        .modal-button.ok:hover {
            background-color: #45a049;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background-color: rgba(0, 0, 0, 0.85);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-name {
            font-weight: bold;
        }

        .file-size {
            font-size: 0.85em;
            color: rgba(0, 0, 0, 0.85);
        }

        .remove-file {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            font-size: 1.1em;
            transition: color 0.2s ease;
        }

        .remove-file:hover {
            color: #d32f2f;
        }

    
.form-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}
.form-row .form-group {
  flex: 1 1 200px;
}

.input-padrao {
  background-color: #ffffff;
  color: white;
  border: 1px solid #1a4f91;
  border-radius: 6px;
  padding: 8px;
  width: 100%;
}
.input-padrao::placeholder {
  color: #aab8c2;
}

.btn-ver-ata {
  font-size: 0.75rem;
  padding: 4px 8px;
  border-radius: 4px;
  background-color: #007bff;
  color: white;
  text-decoration: none;
}
#documentsList .document-card,
#releaseList .document-card,
#clientDocumentsList .document-card,
#listaReunioes .reuniao-card,
#listaReunioes .reuniao-item {
  background-color: #b3e5fc !important;
  color: #000000 !important;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  padding: 16px;
  margin-bottom: 12px;
}

.document-title,
.document-author,
.document-type,
.file-name,
.file-size,
.reuniao-card *,
.reuniao-item * {
  color: #000000 !important;
}

/* CSS */
@media (max-width: 1200px) {
    #inicio .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    #inicio div[style*="grid-template-columns: 2fr 1fr"] {
        grid-template-columns: 1fr !important;
    }
    
    #inicio .charts-section {
        grid-template-columns: 1fr !important;
    }
}

@media (max-width: 768px) {
    #inicio .metrics-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    #inicio .welcome-header {
        padding: 20px !important;
        margin-bottom: 20px !important;
    }
    
    #inicio .welcome-header h2 {
        font-size: 1.8em !important;
    }
    
    #inicio .welcome-header p {
        font-size: 1em !important;
    }
    
    #inicio .main-layout {
        grid-template-columns: 1fr 1fr !important;
        gap: 20px !important;
    }
    
    #inicio .activities-section,
    #inicio .clients-highlight,
    #inicio .quick-access,
    #inicio .notifications {
        margin-bottom: 20px !important;
        padding: 20px !important;
    }
    
    #inicio .quick-access div[style*="grid-template-columns"] {
        grid-template-columns: 1fr 1fr !important;
        gap: 10px !important;
    }
    
    #inicio .quick-access button {
        padding: 12px !important;
        font-size: 0.8em !important;
    }
    
    #inicio .quick-access button i {
        font-size: 1.2em !important;
    }
    
    #inicio .client-highlight-card {
        min-width: 150px !important;
        padding: 15px !important;
    }
    
    #inicio .metric-card {
        padding: 20px !important;
    }
    
    #inicio .metric-card h3 {
        font-size: 1em !important;
    }
    
    #inicio .metric-card p {
        font-size: 2em !important;
    }
    
    #inicio .metric-card div[style*="font-size: 3em"] {
        font-size: 2.5em !important;
    }
}

@media (max-width: 480px) {
    #inicio .quick-access div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
    }
    
    
    #inicio .main-layout {
        grid-template-columns: 1fr !important;
        gap: 15px !important;
    }
    
    #inicio .metric-card {
        padding: 15px !important;
    }
    
    #inicio .metric-card p {
        font-size: 1.8em !important;
    }
    
    #inicio .welcome-header h2 {
        font-size: 1.5em !important;
    }
    
    #inicio .client-highlight-card {
        min-width: 120px !important;
        padding: 12px !important;
    }
    
    #inicio .activities-section div[style*="max-height"] {
        max-height: 300px !important;
    }
}


@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

#inicio.active .welcome-header {
    animation: fadeInUp 0.6s ease-out;
}

#inicio.active .metric-card {
    animation: fadeInUp 0.6s ease-out;
}

#inicio.active .metric-card:nth-child(1) { animation-delay: 0.1s; }
#inicio.active .metric-card:nth-child(2) { animation-delay: 0.2s; }
#inicio.active .metric-card:nth-child(3) { animation-delay: 0.3s; }
#inicio.active .metric-card:nth-child(4) { animation-delay: 0.4s; }

#inicio.active .activities-section,
#inicio.active .clients-highlight {
    animation: fadeInUp 0.6s ease-out 0.5s both;
}

#inicio.active .quick-access,
#inicio.active .notifications {
    animation: fadeInUp 0.6s ease-out 0.6s both;
}

#inicio.active .charts-section {
    animation: fadeInUp 0.6s ease-out 0.7s both;
}


#inicio .charts-section > div {
    height: 300px !important;
    position: relative;
}

#inicio #homologacoesChart,
#inicio #releasesChart {
    max-height: 250px !important;
    height: 250px !important;
}


#inicio .main-layout {
    max-width: 100%;
    overflow: hidden;
}

#inicio .quick-access,
#inicio .notifications {
    max-width: 100%;
    box-sizing: border-box;
    overflow: hidden;
}

#inicio .quick-access div[style*="grid-template-columns"] {
    max-width: 100%;
}

#inicio .quick-access button {
    min-width: 0;
    word-wrap: break-word;
    overflow: hidden;
}


@media (max-width: 768px) {
    #inicio .charts-section {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
    }
    
    #inicio .charts-section > div {
        height: 250px !important;
    }
    
    #inicio #homologacoesChart,
    #inicio #releasesChart {
        max-height: 200px !important;
        height: 200px !important;
    }
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="text/javascript">
   (function(){
      emailjs.init("4DvVlBCto4HMC88CF");
   })();
   // Configura√ß√£o do servidor de armazenamento de PDF
const PDF_SERVER_URL = 'https://servis-pdf.onrender.com';
</script>
</head>
<body><script>
const RELEASE_SUPABASE_URL = 'https://mzjdmhgkrroajmsfwryu.supabase.co';
const RELEASE_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16amRtaGdrcnJvYWptc2Z3cnl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyMzMwMzUsImV4cCI6MjA2MzgwOTAzNX0.tQCwUfFCV7sD-IexQviU0XEPcbn9j5uK9NSUbH-OeBc';
const releaseClient = supabase.createClient(RELEASE_SUPABASE_URL, RELEASE_SUPABASE_KEY);
</script>
<div class="modal-overlay" id="customModal">
<div class="modal-content">
<h3 id="modalTitle"></h3>
<p id="modalMessage"></p>
<div class="modal-buttons" id="modalButtons">
</div>
</div>
</div>

<!-- Modal para Envio por E-mail -->
<div class="modal-overlay" id="emailModal">
<div class="modal-content" style="max-width: 500px;">
<h3 style="color: #4fc3f7; margin-bottom: 20px;">
<i class="fas fa-envelope" style="margin-right: 10px;"></i>
Enviar Relat√≥rio por E-mail
</h3>
<div class="form-group">
<label for="emailRecipients">E-mails dos Destinat√°rios</label>
<textarea id="emailRecipients" placeholder="Digite os e-mails separados por v√≠rgula ou quebra de linha&#10;exemplo@empresa.com, outro@empresa.com" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
<small style="color: #666; font-size: 0.9em;">Separe m√∫ltiplos e-mails por v√≠rgula ou quebra de linha</small>
</div>
<div class="form-group">
<label for="emailSubject">Assunto</label>
<input type="text" id="emailSubject" placeholder="Assunto do e-mail" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
</div>
<div class="form-group">
<label for="emailMessage">Mensagem (opcional)</label>
<textarea id="emailMessage" placeholder="Digite uma mensagem personalizada..." rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
</div>
<div class="modal-buttons">
<button class="modal-button cancel" onclick="closeEmailModal()">Cancelar</button>
<button class="modal-button confirm" onclick="enviarRelatorioPorEmail()">
<i class="fas fa-paper-plane" style="margin-right: 8px;"></i>
Enviar
</button>
</div>
</div>
</div>

<!-- Modal para Envio por WhatsApp -->
<div class="modal-overlay" id="whatsappModal">
<div class="modal-content" style="max-width: 500px;">
<h3 style="color: #25d366; margin-bottom: 20px;">
<i class="fab fa-whatsapp" style="margin-right: 10px;"></i>
Enviar Relat√≥rio por WhatsApp
</h3>
<div class="form-group">
<label for="whatsappNumber">N√∫mero do WhatsApp</label>
<input type="tel" id="whatsappNumber" placeholder="(11) 99999-9999 ou +5511999999999" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
<small style="color: #666; font-size: 0.9em;">Digite o n√∫mero com DDD. Ex: (11) 99999-9999</small>
</div>
<div class="form-group">
<label for="whatsappMessage">Mensagem</label>
<textarea id="whatsappMessage" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
</div>
<div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #25d366;">
<p style="margin: 0; font-size: 0.9em; color: #333;">
<i class="fas fa-info-circle" style="color: #25d366; margin-right: 8px;"></i>
<strong>Importante:</strong> O WhatsApp ser√° aberto com a mensagem pr√©-preenchida. Voc√™ precisar√° anexar o PDF manualmente ap√≥s o envio da mensagem.
</p>
</div>
<div class="modal-buttons">
<button class="modal-button cancel" onclick="closeWhatsappModal()">Cancelar</button>
<button class="modal-button confirm" style="background-color: #25d366;" onclick="enviarRelatorioPorWhatsapp()">
<i class="fab fa-whatsapp" style="margin-right: 8px;"></i>
Abrir WhatsApp
</button>
</div>
</div>
</div>
<div class="sidebar">
<div class="logo-container">
<img alt="Sua Logo" class="your-custom-logo" src="logo1.png"/>
</div>
<ul class="nav-list">
<li class="nav-item">
<button onclick="showTab('inicio')"><i class="fas fa-home"></i> In√≠cio</button>
</li>
<li class="nav-item">
<button onclick="showTab('painel-setor')"><i class="fas fa-chart-pie"></i> Painel do Setor</button>
</li>
<li class="nav-item">
<button onclick="showTab('dashboard')"><i class="fas fa-chart-line"></i> Dashboards</button>
</li>
<li class="nav-item">
<button onclick="showTab('clients')"><i class="fas fa-users"></i> Clientes</button>
</li>
<li class="nav-item">
<button onclick="window.location.href='https://tryvia.github.io/TryviaBI/mapa_visitas.html'"><i class="fas fa-calendar-check"></i> Visitas</button>
</li>
<li class="nav-item">
<button onclick="showTab('relatorioVisita')">
<i class="fas fa-file-signature"></i> Relat√≥rio de Visita
  </button>
<li class="nav-item"><button onclick="showTab('homologacao')"><i class="fas fa-clipboard-check"></i> Homologa√ß√£o</button></li>
<li class="nav-item">
  <button onclick="showTab('release')"><i class="fas fa-rocket"></i> Release</button>
</li>
<li class="nav-item">
  <button onclick="showTab('reunioes')"><i class="fas fa-users"></i> Reuni√µes</button>
</li>
<li class="nav-item">
  <button onclick="showTab('documents')"><i class="fas fa-file-alt"></i> Time de Implanta√ß√£o</button>
</li>
<li class="nav-item">
<button onclick="window.location.href='https://tryvia.github.io/TryviaBI/calendario.html'"><i class="fas fa-calendar"></i> Calend√°rio</button>
</li>
<li class="nav-item">
<button onclick="window.location.href='https://tryvia.github.io/TryviaBI/linha%20do%20tempo.html'"><i class="fas fa-clock"></i> MVP</button>
</li>
<li class="nav-item">
<button onclick="window.location.href='https://tryvia.github.io/TryviaBI/implanta%C3%A7%C3%A3o.html'"><i class="fas fa-cogs"></i> Implanta√ß√µes</button>
</li>
<li class="nav-item">
<button onclick="showTab('gestao')"><i class="fas fa-users-cog"></i> Gest√£o</button>
</li>
<li class="nav-item">
<a href="#"><i class="fas fa-cog"></i> Configura√ß√µes</a>
</li>
<li class="nav-item">
<a href="https://tryvia.github.io/TryviaBI/tryvia_bi_login%20(1).html"><i class="fas fa-sign-out-alt"></i> Sair</a>
<li class="nav-item">
</li>
</li></li><li class="nav-item">
</li></ul>
</div>
<div class="main-content">
<header class="header">

<style>
button, a.button, .btn {
    font-weight: 500;
}

button:contains('Ver Ata'),
a:contains('Ver Ata'),
.ver-ata,
.ver-ata-btn {
    background-color: #0288d1 !important;
    color: white !important;
}

.reuniao-item,
.ata-box,
.ata-list,
.card,
.card-body,
.reuniao-card {
    background-color: rgba(179, 229, 252, 0.95) !important;
    color: #000000 !important;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
</style>


<style>
.reuniao-item,
.ata-box,
.ata-list,
.card,
.card-body,
.reuniao-card {
    background-color: rgba(179, 229, 252, 0.95) !important;
    color: #000000 !important;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
</style>


<style>
.dashboard-card button,
.dashboard-card a.btn,
.dashboard-card a {
    background-color: #0288d1 !important; 
    color: #ffffff !important;
    font-weight: bold;
    border-radius: 6px;
    padding: 8px 16px;
    border: none;
    transition: background-color 0.3s ease;
}
.dashboard-card button:hover,
.dashboard-card a.btn:hover,
.dashboard-card a:hover {
    background-color: #0277bd !important;
}
</style>


<style>
.dashboard-card button,
.dashboard-card .btn,
.dashboard-card .acessar-btn {
    background-color: #4fc3f7 !important; 
    color: #ffffff !important;
    font-weight: bold;
    border: none;
    transition: background-color 0.3s ease;
}
.dashboard-card button:hover,
.dashboard-card .btn:hover,
.dashboard-card .acessar-btn:hover {
    background-color: #29b6f6 !important;
}
</style>


<style>
.profile-info span {
    color: #ffffff !important;
}
</style>


<style>
header h1, .top-bar h1, .top-bar-title, .header-title {
    color: #ffffff !important;
}
</style>


<style>
.content-section,
.form-container,
.documents-grid,
.dashboards-grid,
.clients-grid,
#homologacao,
#release,
#reunioes,
#documents,
#relatorio-visita,
#relatorioVisita,
#cadastro-release,
#cadastroReuniao,
#cadastro-documento,
#cadastroHomologacao,
.homologacao-card,
.modal-content,
.dashboard-card,
.client-card,
.client-card-vertical{
    background-color: #b3e5fc !important;
    color: #000000 !important;
    border-radius: 10px;
    box-shadow: 0 4px 8px #78bfea;
}

input,
textarea,
select {
    background-color: #ffffff !important;
    color: #000000 !important;
    border-color: #999 !important;
}
</style>

<h1>Portal - Time de Implanta√ß√£o</h1>
<div class="profile-info">
<img alt="Profile Picture" src="tryvia.png"/>
<span><span id="nomeUsuario">Usu√°rio</span></span>
</div>
</header>

<!-- Aba In√≠cio -->
<div class="content-section active" id="inicio">
    <!-- Cabe√ßalho de Boas-vindas -->
    <div class="welcome-header" style="background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; color: white; box-shadow: 0 8px 25px rgba(41, 182, 246, 0.3);">
        <h2 style="margin: 0; font-size: 2.5em; margin-bottom: 10px;">
            <i class="fas fa-home" style="margin-right: 15px;"></i>
            Bem-vindo ao Portal Tryvia
        </h2>
        <p style="margin: 0; font-size: 1.2em; opacity: 0.9;" id="welcomeMessage">
            Hoje √© <span id="currentDate"></span> | √öltima atualiza√ß√£o: <span id="lastUpdate"></span>
        </p>
    </div>

    <!-- M√©tricas Principais -->
    <div class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px;">
        <div class="metric-card" style="background: linear-gradient(135deg, #b3e5fc 0%, #81d4fa 100%); border-radius: 12px; padding: 24px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;" onclick="showTab('clients')">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="margin: 0; color: #000; font-size: 1.1em; margin-bottom: 8px;">Total de Clientes</h3>
                    <p style="margin: 0; font-size: 2.5em; font-weight: bold; color: #0277bd;" id="totalClients">-</p>
                </div>
                <div style="font-size: 3em; color: #0277bd; opacity: 0.7;">üë•</div>
            </div>
        </div>

        <div class="metric-card" style="background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%); border-radius: 12px; padding: 24px; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;" onclick="showTab('homologacao')">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="margin: 0; color: #000; font-size: 1.1em; margin-bottom: 8px;">Homologa√ß√µes</h3>
                    <p style="margin: 0; font-size: 2.5em; font-weight: bold; color: #2e7d32;" id="totalHomologacoes">-</p>
                </div>
                <div style="font-size: 3em; color: #2e7d32; opacity: 0.7;">‚úÖ</div>
            </div>
        </div>

        <div class="metric-card" style="background: linear-gradient(135deg, #ffcc80 0%, #ffb74d 100%); border-radius: 12px; padding: 24px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;" onclick="showTab('release')">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="margin: 0; color: #000; font-size: 1.1em; margin-bottom: 8px;">Releases</h3>
                    <p style="margin: 0; font-size: 2.5em; font-weight: bold; color: #ef6c00;" id="totalReleases">-</p>
                </div>
                <div style="font-size: 3em; color: #ef6c00; opacity: 0.7;">üöÄ</div>
            </div>
        </div>

        <div class="metric-card" style="background: linear-gradient(135deg, #d1c4e9 0%, #b39ddb 100%); border-radius: 12px; padding: 24px; box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;" onclick="showTab('reunioes')">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="margin: 0; color: #000; font-size: 1.1em; margin-bottom: 8px;">Reuni√µes</h3>
                    <p style="margin: 0; font-size: 2.5em; font-weight: bold; color: #7b1fa2;" id="totalReunioes">-</p>
                </div>
                <div style="font-size: 3em; color: #7b1fa2; opacity: 0.7;">üìÖ</div>
            </div>
        </div>
    </div>

    <!-- Se√ß√µes de Acesso R√°pido e Notifica√ß√µes -->
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-bottom: 30px;">
        <!-- Acesso R√°pido -->
        <div class="quick-access" style="background: rgba(179, 229, 252, 0.95); border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.2);">
            <h3 style="margin: 0 0 20px 0; color: #000; font-size: 1.4em;">
                <i class="fas fa-bolt" style="margin-right: 10px; color: #ff9800;"></i>
                Acesso R√°pido
            </h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <button onclick="showTab('clients')" style="background: #4fc3f7; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; font-size: 0.9em;">
                    <i class="fas fa-user-plus" style="display: block; font-size: 1.5em; margin-bottom: 5px;"></i>
                    Novo Cliente
                </button>
                <button onclick="showTab('homologacao')" style="background: #66bb6a; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; font-size: 0.9em;">
                    <i class="fas fa-clipboard-check" style="display: block; font-size: 1.5em; margin-bottom: 5px;"></i>
                    Homologa√ß√£o
                </button>
                <button onclick="showTab('release')" style="background: #ff7043; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; font-size: 0.9em;">
                    <i class="fas fa-rocket" style="display: block; font-size: 1.5em; margin-bottom: 5px;"></i>
                    Novo Release
                </button>
                <button onclick="showTab('reunioes')" style="background: #ab47bc; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; font-size: 0.9em;">
                    <i class="fas fa-users" style="display: block; font-size: 1.5em; margin-bottom: 5px;"></i>
                    Nova Reuni√£o
                </button>
                <button onclick="showTab('documents')" style="background: #5c6bc0; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; font-size: 0.9em;">
                    <i class="fas fa-file-alt" style="display: block; font-size: 1.5em; margin-bottom: 5px;"></i>
                    Documentos
                </button>
                <button onclick="showTab('relatorioVisita')" style="background: #26a69a; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; font-size: 0.9em;">
                    <i class="fas fa-file-signature" style="display: block; font-size: 1.5em; margin-bottom: 5px;"></i>
                    Relat√≥rio
                </button>
            </div>
        </div>

        <!-- Notifica√ß√µes -->
        <div class="notifications" style="background: rgba(179, 229, 252, 0.95); border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.2);">
            <h3 style="margin: 0 0 20px 0; color: #000; font-size: 1.4em;">
                <i class="fas fa-bell" style="margin-right: 10px; color: #f44336;"></i>
                Notifica√ß√µes
            </h3>
            <div id="notificationsList">
                <div style="text-align: center; padding: 20px; color: #666;">
                    <i class="fas fa-check-circle" style="font-size: 2em; margin-bottom: 10px; color: #4caf50;"></i>
                    <p style="margin: 0;">Tudo em dia!</p>
                    <p style="margin: 5px 0 0 0; font-size: 0.9em;">Nenhuma notifica√ß√£o pendente</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Layout Principal -->
    <div class="main-layout" style="display: block; margin-bottom: 40px;">
        
        <!-- Atividades Recentes e Clientes em Destaque -->
        <div>
            <!-- Atividades Recentes -->
            <div class="activities-section" style="background: rgba(179, 229, 252, 0.95); border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #000; font-size: 1.4em;">
                        <i class="fas fa-clock" style="margin-right: 10px; color: #29b6f6;"></i>
                        Atividades Recentes
                    </h3>
                    <button onclick="refreshActivities()" style="background: #29b6f6; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div id="activitiesList" style="max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2em; margin-bottom: 15px;"></i>
                        <p>Carregando atividades...</p>
                    </div>
                </div>
            </div>

            <!-- Clientes em Destaque -->
            <div class="clients-highlight" style="background: rgba(179, 229, 252, 0.95); border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.2);">
                <h3 style="margin: 0 0 20px 0; color: #000; font-size: 1.4em;">
                    <i class="fas fa-star" style="margin-right: 10px; color: #ffc107;"></i>
                    Clientes em Destaque
                </h3>
                <div id="clientsCarousel" style="display: flex; overflow-x: auto; gap: 20px; padding: 10px 0; scroll-behavior: smooth;">
                    <div style="text-align: center; padding: 40px; color: #666; min-width: 100%;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2em; margin-bottom: 15px;"></i>
                        <p>Carregando clientes...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resumo -->
    <div class="charts-section" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
        <div style="background: rgba(179, 229, 252, 0.95); border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.2);">
            <h3 style="margin: 0 0 20px 0; color: #000; font-size: 1.4em;">
                <i class="fas fa-chart-bar" style="margin-right: 10px; color: #29b6f6;"></i>
                Homologa√ß√µes por M√™s
            </h3>
            <canvas id="homologacoesChart" width="400" height="200"></canvas>
        </div>
        
        <div style="background: rgba(179, 229, 252, 0.95); border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.2);">
            <h3 style="margin: 0 0 20px 0; color: #000; font-size: 1.4em;">
                <i class="fas fa-chart-pie" style="margin-right: 10px; color: #29b6f6;"></i>
                Releases por Tipo
            </h3>
            <canvas id="releasesChart" width="400" height="200"></canvas>
        </div>
    </div>
</div>

<div class="content-section" id="gestao">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Adicionar Funcion√°rio</h3>
<div class="form-row">
<div class="form-group">
<label for="funcionarioNome">Nome</label>
<input id="funcionarioNome" placeholder="Nome completo do funcion√°rio..." type="text"/>
</div>
<div class="form-group">
<label for="funcionarioCargo">Cargo</label>
<input id="funcionarioCargo" placeholder="Cargo/Fun√ß√£o do funcion√°rio..." type="text"/>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="funcionarioLink">Link</label>
<input id="funcionarioLink" placeholder="https://..." type="url"/>
</div>
<div class="form-group" style="flex: 1;">
<label for="funcionarioFoto">Foto</label>
<div class="upload-area" onclick="document.getElementById('funcionarioFoto').click()">
<div class="upload-icon">üì∑</div>
<p>Arraste e solte ou clique para selecionar uma foto</p>
<input id="funcionarioFoto" style="display: none;" type="file" accept="image/*"/>
</div>
</div>
</div>
<button class="btn-primary" onclick="adicionarFuncionario()">Adicionar Funcion√°rio</button>
</div>
<h3 style="margin-top: 40px; margin-bottom: 20px;">Funcion√°rios</h3>
<div class="documents-grid" id="funcionariosList">
<div class="empty-state">
<div class="empty-state-icon">üë•</div>
<p>Nenhum funcion√°rio encontrado</p>
<p>Adicione funcion√°rios para come√ßar</p>
</div>
</div>
</div>
<div class="content-section" id="documents">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Adicionar Novo Documento de Implanta√ß√£o</h3>
<div class="form-row">
<div class="form-group">
<label for="documentTitle">T√≠tulo</label>
<input id="documentTitle" placeholder="T√≠tulo do documento..." type="text"/>
</div>
                <div class="form-group">
                <label for="documentAuthor">Autor</label>
                <select id="documentAuthor">
                    <option value="">Selecione o autor</option>
                    <option value="Marlos">Marlos</option>
                    <option value="Renata">Renata</option>
                    <option value="Larissa">Larissa</option>
                </select>
                </div>
</div>
<div class="form-row">
<div class="form-group">
<label for="documentType">Tipo</label>
<select id="documentType">
<option value="">Selecione o tipo</option>
<option value="manual">Manual</option>
<option value="guia">Guia</option>
<option value="checklist">Checklist</option>
<option value="template">Template</option>
<option value="outro">Outro</option>
</select>
</div>
<div class="form-group" style="flex: 1;">
<label for="documentFile">Arquivo</label>
<div class="upload-area" onclick="document.getElementById('documentFile').click()">
<div class="upload-icon">üìÑ</div>
<p>Arraste e solte ou clique para selecionar um arquivo</p>
<input id="documentFile" style="display: none;" type="file"/>
</div>
</div>
</div>
<button class="btn-primary" onclick="addDocument()">Adicionar Documento</button>
</div>
<h3 style="margin-top: 40px; margin-bottom: 20px;">Documentos Existentes</h3>
<div class="documents-grid" id="documentsList">
<div class="empty-state">
<div class="empty-state-icon">üìÅ</div>
<p>Nenhum documento encontrado</p>
<p>Adicione documentos para come√ßar</p>
</div>
</div>
</div>
<div class="content-section" id="clients">
<div class="client-tabs">
<button class="client-tab-button active" onclick="showClientTab('view-clients')">Visualizar Clientes</button>
<button class="client-tab-button" onclick="showClientTab('add-client')">Adicionar Cliente</button>
<button class="client-tab-button" id="editClientTabButton" onclick="showClientTab('edit-client-tab')" style="display:none;">Editar Cliente</button>
</div>
<div class="client-tab-content" id="view-clients" style="display: block;">
<h3 style="margin-bottom: 20px;">Lista de Clientes</h3>
<div style="background-color: rgba(179, 229, 252, 0.95); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
    <div class="form-row">
        <div class="form-group">
            <label for="filterClientGroup">Filtrar por Grupo</label>
            <select id="filterClientGroup" onchange="filterClientsByGroup()">
                <option value="">Todos os grupos</option>
                <option value="JCA">JCA</option>
                <option value="Guanabara">Guanabara</option>
                <option value="√Åguia Branca">√Åguia Branca</option>
                <option value="Nenhum">Nenhum</option>
            </select>
        </div>
        <div class="form-group">
            <label for="filterClientSubgroup">Filtrar por Subgrupo</label>
            <select id="filterClientSubgroup" onchange="filterClientsByGroup()">
                <option value="">Todos os subgrupos</option>
                <option value="Carga">Carga</option>
                <option value="Urbano">Urbano</option>
                <option value="Rodovi√°rio">Rodovi√°rio</option>
                <option value="Nenhum">Nenhum</option>
            </select>
        </div>
        <div class="form-group">
            <label for="filterClientName">Filtrar por Nome</label>
            <input type="text" id="filterClientName" placeholder="Digite o nome do cliente..." oninput="filterClientsByGroup()">
        </div>
        <div class="form-group" style="display: flex; align-items: flex-end;">
            <button class="btn-secondary" onclick="clearClientFilters()">Limpar Filtros</button>
        </div>
    </div>
</div>
<div class="clients-grid" id="clientsList">
<div class="empty-state">
<div class="empty-state-icon">üë•</div>
<p>Nenhum cliente encontrado</p>
<p>Adicione clientes para come√ßar</p>
</div>
</div>
</div>
<div class="client-tab-content" id="add-client" style="display: none;">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Adicionar Novo Cliente</h3>
<div class="form-row">
<div class="form-group" style="flex: 0 0 150px; text-align: center;">
<label>Logo do Cliente</label>
<div class="upload-area" id="logoPreview" onclick="document.getElementById('clientLogo').click()">
<div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
<p>Clique para adicionar logo</p>
</div>
<input id="clientLogo" onchange="previewLogo(this)" style="display: none;" type="file"/>
</div>
<div class="form-group" style="flex: 2;">
<label for="clientName">Nome do Cliente</label>
<input id="clientName" placeholder="Nome completo ou da empresa..." type="text"/>
<label for="clientEmail" style="margin-top: 15px;">Email</label>
<input id="clientEmail" placeholder="email@exemplo.com" type="email"/>
                <label for="clientPhone" style="margin-top: 15px;">Telefone</label>
                <input id="clientPhone" placeholder="(XX) XXXXX-XXXX" type="tel"/>
                <label for="clientStatus" style="margin-top: 15px;">Status do Cliente</label>
                <select id="clientStatus">
                    <option value="Cliente Ativo">Cliente Ativo</option>
                    <option value="Cliente Inativo">Cliente Inativo</option>
                </select>
                <label for="clientGroup" style="margin-top: 15px;">Grupo</label>
                <select id="clientGroup">
                    <option value="Nenhum">Nenhum</option>
                    <option value="JCA">JCA</option>
                    <option value="Guanabara">Guanabara</option>
                    <option value="√Åguia Branca">√Åguia Branca</option>
                </select>
                <label for="clientSubgroup" style="margin-top: 15px;">Subgrupo</label>
                <select id="clientSubgroup">
                    <option value="Nenhum">Nenhum</option>
                    <option value="Carga">Carga</option>
                    <option value="Urbano">Urbano</option>
                    <option value="Rodovi√°rio">Rodovi√°rio</option>
                </select>
                <label for="clientBiLink" style="margin-top: 15px;">Link do Dashboard BI</label>
                <input id="clientBiLink" placeholder="https://app.powerbi.com/dashboard/..." type="url"/>
</div>
</div>
<div class="products-section">
<div class="integration-section">
  <h4>Integra√ß√£o</h4>
  <div class="form-row">
    <div class="form-group">
      <label for="integrationType">Tipo</label>
      <select id="integrationType">
        <option value="servicos">Servi√ßos</option>
        <option value="servicos-bilhetes">Servi√ßos/Bilhetes</option>
        <option value="escala">Escala</option>
        <option value="api">API</option>
      </select>
    </div>
    <div class="form-group">
      <label for="integrationSystem">Sistemas</label>
      <select id="integrationSystem">
        <option value="proprio">Sistema Pr√≥prio</option>
        <option value="totalbus">Totalbus</option>
        <option value="smartbus">Smartbus</option>
        <option value="optz">Opt+z</option>
      </select>
    </div>
    <div class="form-group" style="flex: 0 0 120px; display: flex; align-items: flex-end;">
      <button class="btn-secondary" onclick="addIntegration()">Adicionar</button>
    </div>
  </div>
  <div id="integrationList">
    <div class="products-grid" id="integrationContainer">
      <p style="color: rgba(0, 0, 0, 0.85);">Nenhuma integra√ß√£o adicionada ainda.</p>
    </div>
  </div>
</div>
<h4>Produtos / Servi√ßos Associados</h4>
<div class="form-row">
<div class="form-group">
<label for="productName">Nome do Produto/Servi√ßo</label>
<input id="productName" placeholder="Ex: Software SaaS, Consultoria..." type="text"/>
</div>
<div class="form-group" style="flex: 0 0 100px;">
<label for="productQuantity">Quantidade</label>
<input id="productQuantity" min="1" type="number" value="1"/>
</div>
<div class="form-group" style="flex: 0 0 120px; display: flex; align-items: flex-end;">
<button class="btn-secondary" onclick="addProduct()">Adicionar</button>
</div>
</div>
<div id="productsList">
<div class="products-grid" id="productsContainer">
<p style="color: rgba(0, 0, 0, 0.85);">Nenhum produto adicionado ainda.</p>
</div>
</div>
</div>
<button class="btn-primary" onclick="saveClient()" style="margin-top: 30px;">Salvar Cliente</button>
</div>
</div>
<div class="client-tab-content" id="edit-client-tab" style="display: none;">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Editar Cliente</h3>
<input id="editClientId" type="hidden"/>
<div class="form-row">
<div class="form-group" style="flex: 0 0 150px; text-align: center;">
<label>Logo do Cliente</label>
<div class="upload-area" id="editLogoPreview" onclick="document.getElementById('editClientLogo').click()">
<div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
<p>Clique para adicionar logo</p>
</div>
<input id="editClientLogo" onchange="previewEditLogo(this)" style="display: none;" type="file"/>
</div>
<div class="form-group" style="flex: 2;">
<label for="editClientName">Nome do Cliente</label>
<input id="editClientName" placeholder="Nome completo ou da empresa..." type="text"/>
<label for="editClientEmail" style="margin-top: 15px;">Email</label>
<input id="editClientEmail" placeholder="email@exemplo.com" type="email"/>
                <label for="editClientPhone" style="margin-top: 15px;">Telefone</label>
                <input id="editClientPhone" placeholder="(XX) XXXXX-XXXX" type="tel"/>
                <label for="editClientStatus" style="margin-top: 15px;">Status do Cliente</label>
                <select id="editClientStatus">
                    <option value="Cliente Ativo">Cliente Ativo</option>
                    <option value="Cliente Inativo">Cliente Inativo</option>
                </select>
                <label for="editClientGroup" style="margin-top: 15px;">Grupo</label>
                <select id="editClientGroup">
                    <option value="Nenhum">Nenhum</option>
                    <option value="JCA">JCA</option>
                    <option value="Guanabara">Guanabara</option>
                    <option value="√Åguia Branca">√Åguia Branca</option>
                </select>
                <label for="editClientSubgroup" style="margin-top: 15px;">Subgrupo</label>
                <select id="editClientSubgroup">
                    <option value="Nenhum">Nenhum</option>
                    <option value="Carga">Carga</option>
                    <option value="Urbano">Urbano</option>
                    <option value="Rodovi√°rio">Rodovi√°rio</option>
                </select>
                <label for="editClientBiLink" style="margin-top: 15px;">Link do Dashboard BI</label>
                <input id="editClientBiLink" placeholder="https://app.powerbi.com/dashboard/..." type="url"/>
</div>
</div>
<div class="products-section">
<div class="integration-section">
  <h4>Integra√ß√£o</h4>
  <div class="form-row">
    <div class="form-group">
      <label for="editIntegrationType">Tipo</label>
      <select id="editIntegrationType">
        <option value="servicos">Servi√ßos</option>
        <option value="servicos-bilhetes">Servi√ßos/Bilhetes</option>
        <option value="escala">Escala</option>
        <option value="api">API</option>
      </select>
    </div>
    <div class="form-group">
      <label for="editIntegrationSystem">Sistemas</label>
      <select id="editIntegrationSystem">
        <option value="proprio">Sistema Pr√≥prio</option>
        <option value="totalbus">Totalbus</option>
        <option value="smartbus">Smartbus</option>
        <option value="optz">Opt+z</option>
      </select>
    </div>
    <div class="form-group" style="flex: 0 0 120px; display: flex; align-items: flex-end;">
      <button class="btn-secondary" onclick="addEditIntegration()">Adicionar</button>
    </div>
  </div>
  <div id="editIntegrationList">
    <div class="products-grid" id="editIntegrationContainer">
      <p style="color: rgba(0, 0, 0, 0.85);">Nenhuma integra√ß√£o adicionada ainda.</p>
    </div>
  </div>
</div>
<h4>Produtos / Servi√ßos Associados</h4>
<div class="form-row">
<div class="form-group">
<label for="editProductName">Nome do Produto/Servi√ßo</label>
<input id="editProductName" placeholder="Ex: Software SaaS, Consultoria..." type="text"/>
</div>
<div class="form-group" style="flex: 0 0 100px;">
<label for="editProductQuantity">Quantidade</label>
<input id="editProductQuantity" min="1" type="number" value="1"/>
</div>
<div class="form-group" style="flex: 0 0 120px; display: flex; align-items: flex-end;">
<button class="btn-secondary" onclick="addEditProduct()">Adicionar</button>
</div>
</div>
<div id="editProductsList">
<div class="products-grid" id="editProductsContainer">
<p style="color: rgba(0, 0, 0, 0.85);">Nenhum produto adicionado ainda.</p>
</div>
</div>
</div>
<button class="btn-primary" onclick="updateClient()" style="margin-top: 30px;">Atualizar Cliente</button>
<button class="btn-secondary" onclick="showClientTab('view-clients')" style="margin-top: 30px; margin-left: 10px;">Cancelar</button>
</div>
</div>
<div class="client-tab-content" id="view-client-documents" style="display:none;">
</div>
</div>
<div class="content-section" id="dashboard">
<h3 style="margin-bottom: 20px;">Dashboards de Clientes</h3>
<div class="dashboards-grid" id="dashboardsList">
<div class="empty-state">
<div class="empty-state-icon">üìä</div>
<p>Nenhum Dashboard de cliente encontrado.</p>
<p>Adicione clientes com links de BI para visualiz√°-los aqui.</p>
</div>
</div>
</div>
<div class="content-section" id="homologacao">
<div class="main-container">
<div class="header">
<h1>Gerenciador de Homologa√ß√µes</h1>
</div>
<div class="tabs">
<button class="tab-button active" onclick="openHomologacaoTab(event, 'formularioHomologacao')">
                        üìù Formul√°rio de Registro
                    </button>
<button class="tab-button" onclick="openHomologacaoTab(event, 'listaHomologacoes')">
                        üìö Homologa√ß√µes Registradas
                    </button>
</div>
<div class="tab-content active" id="formularioHomologacao">
<form id="homologacaoForm">
<div class="form-row">
<div class="form-group">
<label for="especialista">üë®‚Äçüíª Especialista Respons√°vel</label>
<select id="especialista" name="especialista" required="">
<option value="">Selecione o especialista</option>
<option value="Marlos">Marlos</option>
<option value="Renata">Renata</option>
<option value="Larissa">Larissa</option>
</select>
</div>
<div class="form-group">
<label for="versao">üìã Vers√£o</label>
<input id="versao" name="versao" placeholder="Ex: v1.2.3" required="" type="text"/>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="dataLiberacao">üìÖ Data de Libera√ß√£o</label>
<input id="dataLiberacao" name="dataLiberacao" required="" type="date"/>
</div>
<div class="form-group">
<label for="dataHomologacao">‚úÖ Data de Homologa√ß√£o</label>
<input id="dataHomologacao" name="dataHomologacao" type="date"/>
</div>
</div>
<div class="form-group">
<label for="sistema">üñ•Ô∏è Sistema</label>
<select id="sistema" name="sistema" required="">
<option value="">Selecione o sistema</option>
<option value="Sistema Web">Sistema Web</option>
<option value="Sistema Mobile">Sistema Mobile</option>
<option value="API Rest">API Rest</option>
<option value="Sistema Desktop">Sistema Desktop</option>
<option value="Microservi√ßo">Microservi√ßo</option>
<option value="Outro">Outro</option>
</select>
</div>
<div class="form-group">
<label for="observacao">üìù Observa√ß√µes</label>
<textarea id="observacao" name="observacao" placeholder="Descreva detalhes da homologa√ß√£o, testes realizados, bugs encontrados, etc."></textarea>
</div>
<div class="form-group">
<label>üìÅ Arquivos de Homologa√ß√£o</label>
<div class="upload-area" id="uploadAreaHomologacao">
<div class="upload-icon">‚òÅÔ∏è</div>
<div class="upload-text">Clique aqui ou arraste arquivos</div>
<div class="upload-subtext">PDF, DOC, XLS, IMG at√© 10MB cada</div>
</div>
<input accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif" id="fileInputHomologacao" multiple="" type="file"/>
<div class="file-list" id="fileListHomologacao"></div>
</div>
<div class="btn-group">
<button class="btn btn-secondary" onclick="limparHomologacaoForm()" type="button">
                                üîÑ Limpar
                            </button>
<button class="btn btn-primary" type="submit">
                                üíæ Salvar Homologa√ß√£o
                            </button>
</div>
</form>
</div>
<div class="tab-content" id="listaHomologacoes">
<div class="filters-section">
<div class="form-row">
<div class="form-group">
<label for="filtroSistema">üîç Filtrar por Sistema</label>
<select id="filtroSistema" onchange="filtrarHomologacoes()">
<option value="">Todos os sistemas</option>
<option value="Sistema Web">Sistema Web</option>
<option value="Sistema Mobile">Sistema Mobile</option>
<option value="API Rest">API API Rest</option>
<option value="Sistema Desktop">Sistema Desktop</option>
<option value="Microservi√ßo">Microservi√ßo</option>
<option value="Outro">Outro</option>
</select>
</div>
<div class="form-group">
<label for="filtroEspecialista">üë®‚Äçüíª Filtrar por Especialista</label>
<input id="filtroEspecialista" onkeyup="filtrarHomologacoes()" placeholder="Nome do especialista" type="text"/>
</div>
</div>
</div>
<div class="homologacoes-grid" id="homologacoesGrid">
</div>
<div class="empty-state" id="emptyStateHomologacao" style="display: none;">
<div>üìã</div>
<h3>Nenhuma homologa√ß√£o encontrada</h3>
<p>Registre sua primeira homologa√ß√£o usando o formul√°rio na aba "Formul√°rio de Registro".</p>
</div>
</div>
</div>
</div>
<div class="content-section" id="release">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Cadastro de Release</h3>
<div class="form-row">
<div class="form-group"><label for="releaseDate">üìÖ Data de Libera√ß√£o</label><input class="input-padrao" id="releaseDate" placeholder="Selecione a data" type="date" readonly/></div>
<div class="form-group"><label for="releaseStatus">üìå Status</label><input id="releaseStatus" type="text"/></div>
</div>
<div class="form-row">
<div class="form-group"><label for="releaseSystem">üñ•Ô∏è Sistema</label><input id="releaseSystem" type="text"/></div>
<div class="form-group"><label for="releaseVersion">üßæ Vers√£o</label><input id="releaseVersion" type="text"/></div>
</div>
<div class="form-row">
<div class="form-group"><label for="releaseAnalyst">üë§ Analista</label><input id="releaseAnalyst" type="text"/></div>
<div class="form-group"><label for="releaseHomologDate">‚úÖ Data de Homologa√ß√£o</label><input class="input-padrao" id="releaseHomologDate" placeholder="Selecione a data" type="date"/></div>
</div>
<div class="form-group"><label for="releaseType">üìÇ Tipo</label>
<select id="releaseType">
<option value="">Selecione o tipo</option>
<option value="bug">Bug</option>
<option value="melhoria">Melhoria</option>
<option value="nova funcionalidade">Nova Funcionalidade</option>
<option value="outro">Outro</option>
</select>
</div>
<div class="form-group"><label>üìé Anexar Documento</label>
<div class="upload-area" onclick="document.getElementById('releaseFile').click()">
<div class="upload-icon">üìÑ</div>
<p>Arraste e solte ou clique para selecionar um arquivo</p>
<input id="releaseFile" style="display: none;" type="file"/>
</div>
</div>
<button class="btn-primary" onclick="salvarRelease()">Salvar Release</button>
</div>
<div class="form-row" style="margin-top: 40px; align-items: flex-end;">
<div class="form-group"><label for="filtroSistema">üîç Sistema</label><input id="filtroSistema" type="text"/></div>
<div class="form-group"><label for="filtroTipo">üìÇ Tipo</label>
<select id="filtroTipo">
<option value="">Todos</option>
<option value="bug">Bug</option>
<option value="melhoria">Melhoria</option>
<option value="nova funcionalidade">Nova Funcionalidade</option>
<option value="outro">Outro</option>
</select>
</div>
<div class="form-group"><button class="btn-secondary" onclick="limparFiltros()">Limpar</button></div>
</div>
<h3 style="margin-top: 20px;">Releases Salvos</h3>
<div class="documents-grid" id="releaseList">
<div class="empty-state"><div class="empty-state-icon">üöÄ</div><p>Nenhum release salvo</p></div>
</div>
</div>
<div class="content-section" id="reunioes">
<h2>Reuni√µes</h2>
<div class="form-row">
<div class="form-group"><label for="reuniaoCliente">Cliente</label><input id="reuniaoCliente" type="text"/></div>
<div class="form-group"><label for="reuniaoData">Data</label><input class="input-padrao" id="reuniaoData" type="date"/></div>
<div class="form-group"><label for="reuniaoTipo">Tipo</label><input id="reuniaoTipo" type="text"/></div>
</div>
<div class="form-group"><label for="reuniaoParticipantes">Participantes</label><input id="reuniaoParticipantes" type="text"/></div>
<div class="form-group"><label for="reuniaoFile">üìé Anexar Ata (opcional)</label>
<input class="input-padrao" id="reuniaoFile" type="file"/>
</div>
<button class="btn-primary" onclick="salvarReuniao()">Salvar Reuni√£o</button>
<h3 style="margin-top: 30px;">Filtrar por Cliente</h3>
<input class="input-padrao" id="filtroReuniaoCliente" oninput="filtrarReunioes()" placeholder="Filtrar por cliente..." type="text"/>
<div class="documents-grid" id="listaReunioes" style="margin-top: 20px;"></div>
</div>
<!-- Se√ß√£o: Painel do Setor -->
<div class="content-section" id="painel-setor">
    <div style="background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; color: white; box-shadow: 0 8px 25px rgba(41, 182, 246, 0.3);">
        <h2 style="margin: 0; font-size: 2.5em; margin-bottom: 10px;">
            <i class="fas fa-chart-pie" style="margin-right: 15px;"></i>
            Painel do Setor
        </h2>
        <p style="margin: 0; font-size: 1.2em; opacity: 0.9;">
            Gest√£o completa de tarefas, projetos, time e visitas
        </p>
    </div>

    <!-- Layout Principal -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        
        <!--  Esquerda: Tarefas -->
        <div style="background-color: rgba(179, 229, 252, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3);">
            <h3 style="color: #4fc3f7; margin-bottom: 20px; font-size: 1.5em; text-align: center;">
                <i class="fas fa-tasks" style="margin-right: 10px;"></i>TAREFAS
            </h3>
            
            <!-- Tarefas -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-graduation-cap" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Treinamentos</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('treinamentos', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="treinamentos-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('treinamentos', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-exchange-alt" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Migra√ß√µes</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('migracoes', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="migracoes-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('migracoes', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-users" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Reuni√µes</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('reunioes', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="reunioes-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('reunioes', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-trophy" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">MVP</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('mvp', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="mvp-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('mvp', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-check-circle" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Homologa√ß√µes</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('homologacoes', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="homologacoes-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('homologacoes', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-handshake" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Acompanhamentos</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('acompanhamentos', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="acompanhamentos-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('acompanhamentos', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-cogs" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Implanta√ß√µes</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('implantacoes', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="implantacoes-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('implantacoes', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-star" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Projetos em andamento</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('projetos', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="projetos-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('projetos', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                        <i class="fas fa-ticket-alt" style="color: #4fc3f7; font-size: 1.5em; margin-right: 8px;"></i>
                        <span style="color: #4fc3f7; font-weight: bold;">Tickets</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <button onclick="alterarQuantidade('tickets', -1)" style="background: #f44336; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">-</button>
                        <div id="tickets-count" style="font-size: 2em; font-weight: bold; color: #000;">00</div>
                        <button onclick="alterarQuantidade('tickets', 1)" style="background: #4caf50; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">+</button>
                    </div>
                </div>
            </div>
            
            <!-- Bot√£o para adicionar tarefa -->
            <button class="btn-primary" onclick="showAddTaskModal()" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-plus" style="margin-right: 8px;"></i>Adicionar Tarefa
            </button>
            <button class="btn-primary" id="save-tasks-btn" onclick="saveTasks()" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-save" style="margin-right: 8px;"></i>Salvar Tarefas
            </button>
        </div>

        <!-- Coluna Direita: Time -->
        <div style="background-color: rgba(179, 229, 252, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3);">
            <h3 style="color: #4fc3f7; margin-bottom: 20px; font-size: 1.5em; text-align: center;">
                <i class="fas fa-users" style="margin-right: 10px;"></i>TIME
            </h3>
            
            <!-- Lista do Time -->
            <div id="timeList" style="max-height: 400px; overflow-y: auto;">
               
            </div>
            
            <!-- Bot√£o para adicionar membro -->
            <button class="btn-primary" onclick="showAddTeamMemberModal()" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-user-plus" style="margin-right: 8px;"></i>Adicionar Membro
            </button>
        </div>
    </div>

    <!-- Projetos em Andamento -->
    <div style="background-color: rgba(179, 229, 252, 0.95); border-radius: 15px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3);">
        <h3 style="color: #4fc3f7; margin-bottom: 20px; font-size: 1.5em; text-align: center;">
            <i class="fas fa-project-diagram" style="margin-right: 10px;"></i>PROJETOS EM ANDAMENTO
        </h3>
        
        <!-- Tabela de Projetos -->
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <thead style="background: #4fc3f7; color: white;">
                    <tr>
                        <th style="padding: 15px; text-align: left; font-weight: bold;">Projeto</th>
                        <th style="padding: 15px; text-align: left; font-weight: bold;">Empresa</th>
                        <th style="padding: 15px; text-align: left; font-weight: bold;">Especialista</th>
                        <th style="padding: 15px; text-align: center; font-weight: bold;">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="projetosTableBody">
                    
                </tbody>
            </table>
        </div>
        
        <!-- Bot√£o para adicionar projeto -->
        <button class="btn-primary" onclick="showAddProjectModal()" style="margin-top: 15px;">
            <i class="fas fa-plus" style="margin-right: 8px;"></i>Adicionar Projeto
        </button>
    </div>

    <!-- Layout Inferior: Visitas e Entregas -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        
        <!-- Visitas com Mapa -->
        <div style="background-color: rgba(179, 229, 252, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3);">
            <h3 style="color: #4fc3f7; margin-bottom: 20px; font-size: 1.5em; text-align: center;">
                <i class="fas fa-map-marker-alt" style="margin-right: 10px;"></i>VISITAS
            </h3>
            
            <!-- Mapa -->
            <div id="mapContainer" style="height: 300px; border-radius: 10px; margin-bottom: 20px; z-index: 1;">
              
            </div>
            
            <!-- Contador de empresas -->
            <div style="text-align: center; margin-bottom: 15px;">
                <span style="font-size: 1.2em; font-weight: bold; color: #4fc3f7;">
                    <i class="fas fa-building" style="margin-right: 8px;"></i>
                    <span id="empresasCount">05</span> Empresas
                </span>
            </div>
            
            <!-- Bot√£o para adicionar visita -->
            <button class="btn-primary" onclick="showAddVisitModal()" style="width: 100%;">
                <i class="fas fa-plus" style="margin-right: 8px;"></i>Adicionar Visita
            </button>
        </div>

        <!-- Entregas -->
        <div style="background-color: rgba(179, 229, 252, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(41, 182, 246, 0.3);">
            <h3 style="color: #4fc3f7; margin-bottom: 20px; font-size: 1.5em; text-align: center;">
                <i class="fas fa-truck" style="margin-right: 10px;"></i>ENTREGAS
            </h3>
            
            <!-- Tabela de Entregas por M√™s -->
            <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="background: #4fc3f7; color: white; padding: 15px; text-align: center; font-weight: bold;">
                    Time Implanta√ß√£o & Projetos
                </div>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #e3f2fd;">
                        <tr>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">M√™s</th>
                            <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Marlos</th>
                            <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Larissa</th>
                            <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Renata</th>
                            <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Victor</th>
                            <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">% SETOR</th>
                        </tr>
                    </thead>
                    <tbody id="entregasTableBody">
                       
                    </tbody>
                </table>
            </div>
            
            <!-- Bot√£o para adicionar entrega -->
            <button class="btn-primary" onclick="showAddEntregaModal()" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-plus" style="margin-right: 8px;"></i>Adicionar Entrega
            </button>
        </div>
    </div>

    <!-- Rodap√© com Tags -->
    <div style="text-align: center; margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%); border-radius: 15px; color: white;">
        <div style="display: flex; justify-content: center; align-items: center; gap: 30px; font-size: 1.2em; font-weight: bold;">
            <span><i class="fas fa-shield-alt" style="margin-right: 8px;"></i>+ seguran√ßa</span>
            <span><i class="fas fa-chart-line" style="margin-right: 8px;"></i>+ efici√™ncia</span>
            <span><i class="fas fa-coins" style="margin-right: 8px;"></i>+ economia</span>
        </div>
    </div>
</div></div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
        
        let resolveModalPromise;

       
        function showAlert(title, message) {
            const modal = document.getElementById('customModal');
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            const buttonsContainer = document.getElementById('modalButtons');
            buttonsContainer.innerHTML = `<button class="modal-button ok">OK</button>`;
            
            const okButton = buttonsContainer.querySelector('.ok');
            okButton.onclick = () => {
                modal.classList.remove('visible');
            };
            modal.classList.add('visible');
        }

        
        function showConfirm(title, message) {
            return new Promise((resolve) => {
                resolveModalPromise = resolve;
                const modal = document.getElementById('customModal');
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalMessage').textContent = message;
                const buttonsContainer = document.getElementById('modalButtons');
                buttonsContainer.innerHTML = `
                    <button class="modal-button confirm">Confirmar</button>
                    <button class="modal-button cancel">Cancelar</button>
                `;

                const confirmButton = buttonsContainer.querySelector('.confirm');
                const cancelButton = buttonsContainer.querySelector('.cancel');

                confirmButton.onclick = () => {
                    modal.classList.remove('visible');
                    resolveModalPromise(true);
                };
                cancelButton.onclick = () => {
                    modal.classList.remove('visible');
                    resolveModalPromise(false);
                };
                modal.classList.add('visible');
            });
        }

       
        const SUPABASE_URL = 'https://mzjdmhgkrroajmsfwryu.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16amRtaGdrcnJvYWptc2Z3cnl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyMzMwMzUsImV4cCI6MjA2MzgwOTAzNX0.tQCwUfFCV7sD-IexQviU0XEPcbn9j5uK9NSUbH-OeBc'; 
        
       
        if (!window.supabaseClient) {
            window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        }
        const supabase = window.supabaseClient;

        
        const tipoMap = {
            'suprimentos': 'suprimentos',
            'projetos': 'projetos',
            'tickets': 'tickets',
            'treinamentos': 'treinamento',
            'migracoes': 'migracao',
            'reunioes': 'reuniao',
            'mvp': 'mvp',
            'homologacoes': 'homologacao',
            'acompanhamentos': 'acompanhamento',
            'implantacoes': 'implantacao'
        };

        //  alterar quantidade de tarefas
        async function alterarQuantidade(tipoHtml, incremento) {
            const elemento = document.getElementById(tipoHtml + '-count');
            if (!elemento) {
                console.error('Elemento n√£o encontrado:', tipoHtml + '-count');
                return;
            }

            let valorAtual = parseInt(elemento.textContent) || 0;
            let novoValor = Math.max(0, valorAtual + incremento);

            elemento.textContent = novoValor.toString().padStart(2, '0');

         
            const tipoDb = tipoMap[tipoHtml];
            if (!tipoDb) {
                console.error('Tipo n√£o encontrado no mapeamento:', tipoHtml);
                return;
            }

            try {
                const { error } = await supabase
                    .from('tarefas')
                    .upsert([
                        { tipo: tipoDb, quantidade: novoValor }
                    ], { onConflict: ['tipo'] });

                if (error) throw error;
                console.log('Quantidade salva com sucesso:', tipoDb, novoValor);
            } catch (err) {
                console.error('Erro ao salvar quantidade:', err);
                showAlert('Erro', 'Erro ao salvar quantidade: ' + err.message);
            }
        }

        // Fun√ß√£o para carregar contadores de tarefas
        async function carregarContadoresDeTarefas() {
            try {
                const { data, error } = await supabase
                    .from('tarefas')
                    .select('*');

                if (error) throw error;

                data.forEach(item => {
                    
                    const tipoHtml = Object.keys(tipoMap).find(key => tipoMap[key] === item.tipo);
                    if (tipoHtml) {
                        const elemento = document.getElementById(tipoHtml + '-count');
                        if (elemento) {
                            elemento.textContent = item.quantidade.toString().padStart(2, '0');
                        }
                    }
                });

            } catch (error) {
                console.error('Erro ao carregar contadores de tarefas:', error);
            }
        }

        // Fun√ß√£o para salvar tarefas
        async function saveTasks() {
            try {
                const updates = [];
                for (const tipoHtml in tipoMap) {
                    const element = document.getElementById(tipoHtml + '-count');
                    if (element) {
                        updates.push({
                            tipo: tipoMap[tipoHtml],
                            quantidade: parseInt(element.textContent) || 0
                        });
                    } else {
                        console.warn('Elemento n√£o encontrado para salvar:', tipoHtml + '-count');
                    }
                }

                if (updates.length === 0) {
                    showAlert('Aviso', 'Nenhum contador de tarefa encontrado para salvar.');
                    return;
                }

                for (const update of updates) {
                    const { error } = await supabase
                        .from('tarefas')
                        .upsert([update], { onConflict: ['tipo'] });

                    if (error) throw error;
                }

                showAlert('Sucesso', 'Quantidades das tarefas salvas com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar quantidades:', error);
                showAlert('Erro', 'Erro ao salvar as quantidades das tarefas.');
            }
        }

        
        let documents = [];
        let clients = [];
        let currentProducts = []; 
        let editingProducts = []; 
        let arquivosHomologacaoSelecionados = []; 
        let currentIntegrations = []; 
let editingIntegrations = []; 

function addIntegration() {
  const type = document.getElementById('integrationType').value;
  const system = document.getElementById('integrationSystem').value;
  currentIntegrations.push({ type, system });
  renderIntegrations('currentIntegrations', 'integrationContainer', 'integrationList');
}

function addEditIntegration() {
  const type = document.getElementById('editIntegrationType').value;
  const system = document.getElementById('editIntegrationSystem').value;
  editingIntegrations.push({ type, system });
  renderIntegrations('editingIntegrations', 'editIntegrationContainer', 'editIntegrationList');
}

function renderIntegrations(listName, containerId, listDivId) {
  const list = listName === 'currentIntegrations' ? currentIntegrations : editingIntegrations;
  const container = document.getElementById(containerId);
  const listDiv = document.getElementById(listDivId);

  if (list.length === 0) {
    container.innerHTML = '<p style="color: rgba(0, 0, 0, 0.85);">Nenhuma integra√ß√£o adicionada ainda.</p>';
    listDiv.style.display = 'none';
    return;
  }
  listDiv.style.display = 'block';
  container.innerHTML = list.map((item, idx) => `
    <div class="product-item">
      <span>Tipo: ${item.type}, Sistema: ${item.system}</span>
      <button class="delete-btn" onclick="removeIntegration(${idx}, '${listName}')">X</button>
    </div>
  `).join('');
}

function removeIntegration(idx, listName) {
  if (listName === 'currentIntegrations') {
    currentIntegrations.splice(idx, 1);
    renderIntegrations('currentIntegrations', 'integrationContainer', 'integrationList');
  } else {
    editingIntegrations.splice(idx, 1);
    renderIntegrations('editingIntegrations', 'editIntegrationContainer', 'editIntegrationList');
  }
}
        
        function hexToRgb(hex) {
            var bigint = parseInt(hex.slice(1), 16);
            var r = (bigint >> 16) & 255;
            var g = (bigint >> 8) & 255;
            var b = bigint & 255;
            return `${r}, ${g}, ${b}`;
        }

        
        document.documentElement.style.setProperty('--primary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--primary-color')));
        document.documentElement.style.setProperty('--text-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--text-color')));

       
        function showTab(tabId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            const el = document.getElementById(tabId);
            if (el) { el.classList.add('active'); }

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const navItemToActivate = document.querySelector(`.nav-item button[onclick="showTab('${tabId}')"]`);
            if (navItemToActivate) {
                 navItemToActivate.parentElement.classList.add('active');
            }

          
            if (tabId === 'inicio') {
                setTimeout(() => {
                    initializeInicio();
                }, 100);
            } else if (tabId === 'documents') {
                fetchAndRenderDocuments();
            } else if (tabId === 'clients') {
                document.getElementById('editClientTabButton').style.display = 'none';
                showClientTab('view-clients');
                fetchAndRenderClients();
            } else if (tabId === 'homologacao') {
                openHomologacaoTab(null, 'formularioHomologacao'); 
                fetchAndRenderHomologacoes(); 
            } else if (tabId === 'dashboard') {
                fetchAndRenderDashboards(); 
            } else if (tabId === 'gestao') {
                fetchAndRenderFuncionarios();
            }
        }

      
        function showClientTab(tabId) {
            document.querySelectorAll('.client-tab-content').forEach(section => {
                section.style.display = 'none';
            });
            const el = document.getElementById(tabId);
            if (el) { el.style.display = 'block'; }

            document.querySelectorAll('.client-tab-button').forEach(button => {
                button.classList.remove('active');
            });
            const activeClientButton = document.querySelector(`.client-tab-button[onclick="showClientTab('${tabId}')"]`);
            if (activeClientButton) {
                activeClientButton.classList.add('active');
            }

            const editButton = document.getElementById('editClientTabButton');
            if (tabId === 'edit-client-tab') {
                editButton.style.display = 'block';
                editButton.classList.add('active');
            } else {
                editButton.style.display = 'none';
                editButton.classList.remove('active');
            }

            if (tabId === 'view-clients') {
                fetchAndRenderClients();
            }
        }

       
        function previewLogo(input) {
            const logoPreview = document.getElementById('logoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.innerHTML = `<img src="${e.target.result}" class="logo-preview" alt="Logo preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                logoPreview.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                    <p>Clique para adicionar logo</p>
                `;
            }
        }

        
        function previewEditLogo(input) {
            const logoPreview = document.getElementById('editLogoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.innerHTML = `<img src="${e.target.result}" class="logo-preview" alt="Logo preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                const clientId = document.getElementById('editClientId').value;
                const client = clients.find(c => c.id == clientId);
                if (client && client.logo_url) {
                    logoPreview.innerHTML = `<img src="${client.logo_url}" class="logo-preview" alt="Logo preview">`;
                } else {
                     logoPreview.innerHTML = `
                        <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                        <p>Clique para adicionar logo</p>
                    `;
                }
            }
        }

        
        function addProduct() {
            const productName = document.getElementById('productName').value;
            const productQuantity = document.getElementById('productQuantity').value;

            if (productName && productQuantity > 0) {
                currentProducts.push({ name: productName, quantity: parseInt(productQuantity) });
                updateProductsList('currentProducts', 'productsContainer');
                document.getElementById('productName').value = '';
                document.getElementById('productQuantity').value = '1';
                document.getElementById('productsList').style.display = 'block';
            } else {
                showAlert('Erro', 'Por favor, insira um nome e uma quantidade v√°lida para o produto.');
            }
        }

        
        function removeProduct(index, listType) {
            if (listType === 'currentProducts') {
                currentProducts.splice(index, 1);
                updateProductsList('currentProducts', 'productsContainer');
            } else if (listType === 'editingProducts') {
                editingProducts.splice(index, 1);
                updateProductsList('editingProducts', 'editProductsContainer');
            }
        }

       
        function addEditProduct() {
            const productName = document.getElementById('editProductName').value;
            const productQuantity = document.getElementById('editProductQuantity').value;

            if (productName && productQuantity > 0) {
                editingProducts.push({ name: productName, quantity: parseInt(productQuantity) });
                updateProductsList('editingProducts', 'editProductsContainer');
                document.getElementById('editProductName').value = '';
                document.getElementById('editProductQuantity').value = '1';
                document.getElementById('editProductsList').style.display = 'block';
            } else {
                showAlert('Erro', 'Por favor, insira um nome e uma quantidade v√°lida para o produto.');
            }
        }

        function updateProductsList(listName, containerId) {
            const productsToRender = listName === 'currentProducts' ? currentProducts : editingProducts;
            const productsContainer = document.getElementById(containerId);
            const productsListDiv = document.getElementById(containerId === 'productsContainer' ? 'productsList' : 'editProductsList');

            if (productsToRender.length === 0) {
                productsContainer.innerHTML = '<p style="color: rgba(0, 0, 0, 0.85);">Nenhum produto adicionado ainda.</p>';
                productsListDiv.style.display = 'none';
                return;
            }
            
            productsListDiv.style.display = 'block'; 
            productsContainer.innerHTML = productsToRender.map((product, index) => `
                <div class="product-item">
                    <span>${product.name} (x${product.quantity})</span>
                    <button class="delete-btn" onclick="removeProduct(${index}, '${listName}')">X</button>
                </div>
            `).join('');
        }

        
        async function viewClientDocuments(clientId) {
            const clientName = clients.find(c => c.id === clientId)?.name || `Cliente ID: ${clientId}`;
            
            let clientDocumentsSection = document.getElementById('view-client-documents');
            if (!clientDocumentsSection) {
                const clientsDiv = document.getElementById('clients');
                clientsDiv.insertAdjacentHTML('beforeend', `<div id="view-client-documents" class="client-tab-content" style="display:none;"></div>`);
                clientDocumentsSection = document.getElementById('view-client-documents');
            }
            
            clientDocumentsSection.innerHTML = `
                <div class="form-container">
                    <h3 style="margin-bottom: 20px;">Documentos de: ${clientName}</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientDocumentTitle">T√≠tulo</label>
                            <input type="text" id="clientDocumentTitle" placeholder="T√≠tulo do documento...">
                        </div>
                        <div class="form-group">
                            <label for="clientDocumentType">Tipo</label>
                            <select id="clientDocumentType">
                                <option value="">Selecione o tipo</option>
                                <option value="apresentacao">Apresenta√ß√£o</option>
                                <option value="relatorio">Relat√≥rio</option>
                                <option value="atas">Atas</option>
                                <option value="planilha">Planilha</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="clientDocumentFile">Arquivo</label>
                            <div class="upload-area" onclick="document.getElementById('clientDocumentFile').click()">
                                <div class="upload-icon">üìÑ</div>
                                <p>Arraste e solte ou clique para selecionar um arquivo</p>
                                <input type="file" id="clientDocumentFile" style="display: none;">
                            </div>
                        </div>
                    </div>
                    <button class="btn-secondary" onclick="addClientDocument(${clientId})">Adicionar Documento ao Cliente</button>
                    <button class="btn-secondary" onclick="showClientTab('view-clients')" style="margin-left: 10px;">Voltar aos Clientes</button>
                </div>

                <h3 style="margin-top: 40px; margin-bottom: 20px;">Documentos Existentes</h3>
                <div id="clientDocumentsList" class="documents-grid">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÅ</div>
                        <p>Nenhum documento para este cliente.</p>
                    </div>
                </div>
            `;
            
            showClientTab('view-client-documents');
            await fetchAndRenderClientDocuments(clientId);
        }

        // --- Funcionarios Functions ---
        async function adicionarFuncionario() {
            const nome = document.getElementById('funcionarioNome').value;
            const funcao = document.getElementById('funcionarioCargo').value;
            const link = document.getElementById('funcionarioLink').value;
            const fotoInput = document.getElementById('funcionarioFoto');
            const foto = fotoInput.files[0];

            if (nome && funcao && link && foto) {
                const fotoPath = `funcionarios/${Date.now()}_${foto.name}`;
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('funcionariofotos')
                    .upload(fotoPath, foto);

                if (uploadError) {
                    console.error('Erro ao fazer upload da foto:', uploadError.message);
                    showAlert('Erro', 'Erro ao fazer upload da foto.');
                    return;
                }

                const fotoUrl = `${SUPABASE_URL}/storage/v1/object/public/funcionariofotos/${fotoPath}`;

                const { data, error } = await supabase
                    .from('especialistas')
                    .insert([
                        { nome, funcao, foto_url: fotoUrl, foto_path: fotoPath, link }
                    ]);

                if (error) {
                    console.error('Erro ao adicionar funcion√°rio no banco de dados:', error.message);
                    showAlert('Erro', 'Erro ao adicionar funcion√°rio.');
                } else {
                    showAlert('Sucesso', 'Funcion√°rio adicionado com sucesso!');
                    document.getElementById('funcionarioNome').value = '';
                    document.getElementById('funcionarioCargo').value = '';
                    document.getElementById('funcionarioLink').value = '';
                    fotoInput.value = '';
                    fetchAndRenderFuncionarios();
                }
            } else {
                showAlert('Aten√ß√£o', 'Por favor, preencha todos os campos e selecione uma foto.');
            }
        }

        async function fetchAndRenderFuncionarios() {
            const { data, error } = await supabase
                .from('especialistas')
                .select('*');

            const container = document.getElementById('funcionariosList');

            if (error) {
                console.error('Erro ao buscar funcion√°rios:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Erro ao carregar funcion√°rios.</p></div>`;
                return;
            }

            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <p>Nenhum funcion√°rio encontrado</p>
                        <p>Adicione funcion√°rios para come√ßar</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.map(funcionario => `
                <div class="document-card" style="cursor: pointer;" onclick="redirecionarFuncionario('${funcionario.link}')">
                    <div class="document-header">
                        <span class="document-type">${funcionario.funcao}</span>
                        <button class="delete-btn" onclick="event.stopPropagation(); deleteFuncionario(${funcionario.id}, '${funcionario.foto_path}')">X</button>
                    </div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <img src="${funcionario.foto_url}" alt="Foto de ${funcionario.nome}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-color);">
                    </div>
                    <div class="document-title">${funcionario.nome}</div>
                    <div class="document-author">${funcionario.funcao}</div>
                    <div style="margin-top: 15px; text-align: center;">
                        <small style="color: #666;">Clique para acessar o link</small>
                    </div>
                </div>
            `).join('');
        }

        function redirecionarFuncionario(link) {
            if (link) {
                window.open(link, '_blank');
            }
        }

        async function deleteFuncionario(id, fotoPath) {
            const confirmed = await showConfirm('Confirma√ß√£o', 'Tem certeza que deseja deletar este funcion√°rio?');
            if (!confirmed) {
                return;
            }

            if (fotoPath) {
                const { error: storageError } = await supabase.storage
                    .from('funcionariofotos')
                    .remove([fotoPath]);

                if (storageError) {
                    console.warn('Aviso: Erro ao deletar foto do Storage:', storageError.message);
                }
            }

            const { error: dbError } = await supabase
                .from('especialistas')
                .delete()
                .eq('id', id);

            if (dbError) {
                console.error('Erro ao deletar funcion√°rio do banco de dados:', dbError.message);
                showAlert('Erro', 'Erro ao deletar funcion√°rio do banco de dados.');
            } else {
                showAlert('Sucesso', 'Funcion√°rio deletado com sucesso!');
                fetchAndRenderFuncionarios();
            }
        }

        // Fun√ß√£o para filtrar clientes por grupo, subgrupo e nome
        function filterClientsByGroup() {
            const selectedGroup = document.getElementById('filterClientGroup').value.toLowerCase();
            const selectedSubgroup = document.getElementById('filterClientSubgroup').value.toLowerCase();
            const searchName = document.getElementById('filterClientName').value.toLowerCase();
            const clientCards = document.querySelectorAll('#clientsList .client-card-vertical');
            
            let visibleCount = 0;
                      clientCards.forEach(card => {
                const clientId = card.dataset.clientId;
                const client = clients.find(c => c.id == clientId);
                if (!client) return;

                const clientName = client.name.toLowerCase();
                const clientGroup = client.group ? client.group.toLowerCase() : "";
                const clientSubgroup = client.subgroup ? client.subgroup.toLowerCase() : "";                
                const matchesGroup = selectedGroup === '' || clientGroup === selectedGroup;
                const matchesSubgroup = selectedSubgroup === '' || clientSubgroup === selectedSubgroup;
                const matchesName = searchName === '' || clientName.includes(searchName);
                
                if (matchesGroup && matchesSubgroup && matchesName) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Mostrar/esconder estado vazio
            const emptyState = document.querySelector('#clientsList .empty-state');
            if (emptyState) {
                if (visibleCount === 0 && clientCards.length > 0) {
                    emptyState.style.display = 'block';
                    emptyState.innerHTML = `
                        <div class="empty-state-icon">üîç</div>
                        <p>Nenhum cliente encontrado</p>
                        <p>Tente ajustar os filtros</p>
                    `;
                } else if (clientCards.length === 0) {
                    emptyState.style.display = 'block';
                    emptyState.innerHTML = `
                        <div class="empty-state-icon">üë•</div>
                        <p>Nenhum cliente encontrado</p>
                        <p>Adicione clientes para come√ßar</p>
                    `;
                } else {
                    emptyState.style.display = 'none';
                }
            }
        }
        
        // Fun√ß√£o para limpar filtros
        function clearClientFilters() {
            document.getElementById('filterClientGroup').value = '';
            document.getElementById('filterClientSubgroup').value = '';
            document.getElementById('filterClientName').value = '';
            filterClientsByGroup();
        }

        // --- Document  ---
        async function addDocument() {
            const title = document.getElementById('documentTitle').value;
            const author = document.getElementById('documentAuthor').value;
            const type = document.getElementById('documentType').value;
            const fileInput = document.getElementById('documentFile');
            const file = fileInput.files[0];

            if (title && author && type && file) {
                const filePath = `${Date.now()}_${file.name}`;
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('documentfiles')
                    .upload(filePath, file);

                if (uploadError) {
                    console.error('Erro ao fazer upload do arquivo:', uploadError.message);
                    showAlert('Erro', 'Erro ao fazer upload do documento.');
                    return;
                }

                const publicURL = `${SUPABASE_URL}/storage/v1/object/public/documentfiles/${filePath}`;

                const { data, error } = await supabase
                    .from('documents')
                    .insert([
                        { title, author, type, file_url: publicURL, file_path: filePath }
                    ]);

                if (error) {
                    console.error('Erro ao adicionar documento no banco de dados:', error.message);
                    showAlert('Erro', 'Erro ao adicionar documento.');
                } else {
                    showAlert('Sucesso', 'Documento adicionado com sucesso!');
                    document.getElementById('documentTitle').value = '';
                    document.getElementById('documentAuthor').value = '';
                    document.getElementById('documentType').value = '';
                    fileInput.value = '';
                    fetchAndRenderDocuments();
                }
            } else {
                showAlert('Aten√ß√£o', 'Por favor, preencha todos os campos e selecione um arquivo.');
            }
        }

        async function fetchAndRenderDocuments() {
            const { data, error } = await supabase
                .from('documents')
                .select('*');

            const container = document.getElementById('documentsList');

            if (error) {
                console.error('Erro ao buscar documentos:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Erro ao carregar documentos.</p></div>`;
                return;
            }

            documents = data;

            if (documents.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÅ</div>
                        <p>Nenhum documento encontrado</p>
                        <p>Adicione documentos para come√ßar</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = documents.map(doc => `
                <div class="document-card">
                    <div class="document-header">
                        <span class="document-type">${doc.type}</span>
                        <button class="delete-btn" onclick="deleteDocument(${doc.id}, '${doc.file_path}')">X</button>
                    </div>
                    <div class="document-title">${doc.title}</div>
                    <div class="document-author">${doc.author}</div>
                    <a href="${doc.file_url}" download="${doc.title}.${doc.file_url.split('.').pop()}" target="_blank" class="btn-secondary" style="margin-top: 15px; display: block; text-align: center;">Download</a>
                </div>
            `).join('');
        }

        async function deleteDocument(id, filePath) {
            const confirmed = await showConfirm('Confirma√ß√£o', 'Tem certeza que deseja deletar este documento?');
            if (!confirmed) {
                return;
            }

            const { error: storageError } = await supabase.storage
                .from('documentfiles')
                .remove([filePath]);

            if (storageError) {
                console.error('Erro ao deletar arquivo do Storage:', storageError.message);
                showAlert('Erro', 'Erro ao deletar arquivo do Storage. Verifique as permiss√µes do bucket.');
                return;
            }

            const { error: dbError } = await supabase
                .from('documents')
                .delete()
                .eq('id', id);

            if (dbError) {
                console.error('Erro ao deletar documento do banco de dados:', dbError.message);
                showAlert('Erro', 'Erro ao deletar documento do banco de dados. Verifique as permiss√µes da tabela.');
            } else {
                showAlert('Sucesso', 'Documento deletado com sucesso!');
                fetchAndRenderDocuments();
            }
        }

        // --- Client  ---
        async function saveClient() {
            const name = document.getElementById('clientName').value;
            const email = document.getElementById('clientEmail').value;
            const phone = document.getElementById('clientPhone').value;
            const status = document.getElementById('clientStatus').value;
            const group = document.getElementById('clientGroup').value;
            const subgroup = document.getElementById('clientSubgroup').value;
            const biLink = document.getElementById('clientBiLink').value;
            
            let logoUrl = null;
            let logoPath = null;

            if (name && email && phone) {
                const logoFileInput = document.getElementById('clientLogo'); 
                
                if (logoFileInput && logoFileInput.files && logoFileInput.files[0]) {
                    const logoFile = logoFileInput.files[0]; 
                    const logoFilePath = `logos/${Date.now()}_${logoFile.name}`;
                    
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('clientlogos') 
                        .upload(logoFilePath, logoFile);

                    if (uploadError) {
                        console.error('Erro ao fazer upload do logo:', uploadError.message);
                        showAlert('Erro', 'Erro ao fazer upload do logo. Verifique as permiss√µes do bucket e o console.');
                        return;
                    }
                    
                    logoUrl = `${SUPABASE_URL}/storage/v1/object/public/clientlogos/${logoFilePath}`;
                    logoPath = logoFilePath;
                }

                const { data: clientData, error: clientError } = await supabase
                    .from('clients') 
                    .insert([
                        { name, email, phone, status, group, subgroup, logo_url: logoUrl, logo_path: logoPath, bi_link: biLink }
                    ])
                    .select(); 

                if (clientError) {
                    console.error('Erro ao salvar cliente no banco de dados:', clientError.message);
                    showAlert('Erro', 'Erro ao salvar cliente. Verifique as permiss√µes da tabela e o console.');
                    return;
                }

                const clientId = clientData[0].id;
                
                if (currentIntegrations.length > 0) {
  const integrationsToInsert = currentIntegrations.map(i => ({
    client_id: clientId,
    type: i.type,
    system: i.system
  }));
  await supabase.from('integrations').insert(integrationsToInsert);
}

                if (currentProducts.length > 0) {
                    const productsToInsert = currentProducts.map(p => ({
                        client_id: clientId,
                        name: p.name,
                        quantity: p.quantity
                    }));
                    const { error: productsError } = await supabase
                        .from('products') 
                        .insert(productsToInsert);

                    if (productsError) {
                        console.error('Erro ao salvar produtos:', productsError.message);
                        showAlert('Erro', 'Cliente salvo, mas erro ao salvar produtos. Verifique as permiss√µes da tabela de produtos.');
                    }
                }
                
                showAlert('Sucesso', 'Cliente salvo com sucesso!');
                document.getElementById('clientName').value = '';
                document.getElementById('clientEmail').value = '';
                document.getElementById('clientPhone').value = '';
                document.getElementById('clientStatus').value = 'Cliente Ativo';
                document.getElementById('clientGroup').value = 'Nenhum';
                document.getElementById('clientSubgroup').value = 'Nenhum';
                document.getElementById('clientBiLink').value = '';
                if (logoFileInput) { 
                    logoFileInput.value = ''; 
                }
                document.getElementById('logoPreview').innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                    <p>Clique para adicionar logo</p>
                `;
                currentProducts = [];
                updateProductsList('currentProducts', 'productsContainer');
                fetchAndRenderClients(); 
                showClientTab('view-clients'); 
                
            } else {
                showAlert('Aten√ß√£o', 'Por favor, preencha todos os campos obrigat√≥rios do cliente.');
            }
        }

        async function fetchAndRenderClients() {
           const { data, error } = await supabase
    .from('clients')
    .select(`
        *,
        products (
            id, name, quantity
        ),
        integrations (
            id, type, system
        )
    `);
            const container = document.getElementById('clientsList');

            if (error) {
                console.error('Erro ao buscar clientes:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Erro ao carregar clientes.</p></div>`;
                return;
            }

            clients = data;

            if (clients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <p>Nenhum cliente encontrado</p>
                        <p>Adicione clientes para come√ßar</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = clients.map(client => `

  <div class="client-card-vertical" data-client-id="${client.id}">
    <div class="client-card-top">
      <button class="delete-btn-card" onclick="deleteClient(${client.id}, '${client.logo_path || ''}')"><span style="font-size: 16px;">üóëÔ∏è</span></button>
    </div>

    <div class="client-logo-vertical">
      ${client.logo_url ? `<img src="${client.logo_url}" alt="Logo" class="logo-preview-vertical">` : client.name.charAt(0).toUpperCase()}
    </div>

    <p class="add-logo-text">${client.logo_url ? '' : 'Adicionar Logo'}</p>
    <h3 class="client-name-vertical">${client.name}</h3>
    <p class="client-status-text ${client.status === 'Cliente Inativo' ? 'inactive' : ''}">${client.status || 'Cliente Ativo'}</p>


    <!-- Produtos -->
    <div class="info-section">
      <div class="section-title">
        <span style="font-size: 18px;">üì¶</span>
        <span style="font-weight: bold;">Produtos</span> (<span id="productCount-${client.id}">${client.products ? client.products.length : 0}</span>)
      </div>
      ${
        client.products && client.products.length > 0
          ? client.products.map(p => `<p class="section-item">‚Ä¢ ${p.name} (x${p.quantity})</p>`).join('')
          : '<p class="section-item muted">Nenhum produto</p>'
      }
    </div>

    <!-- Integra√ß√µes -->
    <div class="info-section">
      <div class="section-title">
        <span style="font-size: 18px;">üîó</span>
        <span style="font-weight: bold;">Integra√ß√µes</span>
      </div>
      ${
        client.integrations && client.integrations.length > 0
          ? client.integrations.map(i => `<p class="section-item">‚Ä¢ ${i.type} (${i.system})</p>`).join('')
          : '<p class="section-item muted">Nenhuma integra√ß√£o</p>'
      }
    </div>

    <button class="btn-vertical" onclick="viewClientDocuments(${client.id})">Ver Documentos</button>
    <button class="btn-vertical edit" onclick="editClient(${client.id})">Editar Cliente</button>
  </div>

`).join('');

            // Aplicar filtros ap√≥s renderizar
            setTimeout(() => {
                filterClientsByGroup();
            }, 100);

            
        }
        async function deleteClient(id, logoPath) {
            const confirmed = await showConfirm('Confirma√ß√£o', 'Tem certeza que deseja deletar este cliente e todos os seus produtos e documentos? Esta a√ß√£o √© irrevers√≠vel.');
            if (!confirmed) {
                return;
            }

            if (logoPath) {
                const { error: storageError } = await supabase.storage
                    .from('clientlogos') 
                    .remove([logoPath]);

                if (storageError) {
                    console.warn('Aviso: Erro ao deletar logo do Storage (pode n√£o existir ou caminho incorreto). Continuando com a exclus√£o do cliente no DB:', storageError.message);
                }
            }

            const { error: dbError } = await supabase
                .from('clients') 
                .delete()
                .eq('id', id);

            if (dbError) {
                console.error('Erro ao deletar cliente do banco de dados:', dbError.message);
                showAlert('Erro', 'Erro ao deletar cliente do banco de dados. Verifique as permiss√µes da tabela ou as regras ON DELETE CASCADE.');
            } else {
                showAlert('Sucesso', 'Cliente deletado com sucesso!');
                fetchAndRenderClients(); 
            }
        }

        async function editClient(clientId) {
            const clientToEdit = clients.find(c => c.id === clientId);

            if (!clientToEdit) {
                showAlert('Erro', 'Cliente n√£o encontrado para edi√ß√£o.');
                return;
            }

            document.getElementById('editClientId').value = clientToEdit.id;
            document.getElementById('editClientName').value = clientToEdit.name;
            document.getElementById('editClientEmail').value = clientToEdit.email;
            document.getElementById('editClientPhone').value = clientToEdit.phone;
            document.getElementById('editClientStatus').value = clientToEdit.status || 'Cliente Ativo';
            document.getElementById('editClientGroup').value = clientToEdit.group || 'Nenhum';
            document.getElementById('editClientSubgroup').value = clientToEdit.subgroup || 'Nenhum';
            document.getElementById('editClientBiLink').value = clientToEdit.bi_link || '';

            const editLogoPreview = document.getElementById('editLogoPreview');
            if (clientToEdit.logo_url) {
                editLogoPreview.innerHTML = `<img src="${clientToEdit.logo_url}" class="logo-preview" alt="Logo preview">`;
            } else {
                editLogoPreview.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                    <p>Clique para adicionar logo</p>
                `;
            }

            editingProducts = clientToEdit.products ? [...clientToEdit.products] : [];
            updateProductsList('editingProducts', 'editProductsContainer');

            showClientTab('edit-client-tab');
        }

        async function updateClient() {
            const clientId = document.getElementById('editClientId').value;
            const name = document.getElementById('editClientName').value;
            const email = document.getElementById('editClientEmail').value;
            const phone = document.getElementById('editClientPhone').value;
            const status = document.getElementById('editClientStatus').value;
            const group = document.getElementById('editClientGroup').value;
            const subgroup = document.getElementById('editClientSubgroup').value;
            const biLink = document.getElementById('editClientBiLink').value;
            const logoFileInput = document.getElementById('editClientLogo');
            const newLogoFile = logoFileInput.files[0];

            if (!name || !email || !phone) {
                showAlert('Aten√ß√£o', 'Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }

            let logoUrl = null;
            let logoPath = null;
            const currentClient = clients.find(c => c.id == clientId);

            if (newLogoFile) {
                const newLogoPath = `logos/${Date.now()}_${newLogoFile.name}`;
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('clientlogos') 
                    .upload(newLogoPath, newLogoFile);

                if (uploadError) {
                    console.error('Erro ao fazer upload do novo logo:', uploadError.message);
                    showAlert('Erro', 'Erro ao fazer upload do novo logo.');
                    return;
                }
                logoUrl = `${SUPABASE_URL}/storage/v1/object/public/clientlogos/${newLogoPath}`;
                logoPath = newLogoPath;

                if (currentClient && currentClient.logo_path) {
                    const { error: deleteOldLogoError } = await supabase.storage
                        .from('clientlogos')
                        .remove([currentClient.logo_path]);
                    if (deleteOldLogoError) {
                        console.warn('Aviso: Erro ao deletar logo antigo do Storage:', deleteOldLogoError.message);
                    }
                }
            } else {
                if (currentClient) {
                    logoUrl = currentClient.logo_url;
                    logoPath = currentClient.logo_path;
                }
            }

            const { error: clientError } = await supabase
                .from('clients')
                .update({ name, email, phone, status, group, subgroup, logo_url: logoUrl, logo_path: logoPath, bi_link: biLink })
                .eq('id', clientId);

            if (clientError) {
                console.error('Erro ao atualizar cliente no banco de dados:', clientError.message);
                showAlert('Erro', 'Erro ao atualizar cliente.');
                return;
            }
            await supabase.from('integrations').delete().eq('client_id', clientId);
if (editingIntegrations.length > 0) {
  const integrationsToInsert = editingIntegrations.map(i => ({
    client_id: parseInt(clientId),
    type: i.type,
    system: i.system
  }));
  await supabase.from('integrations').insert(integrationsToInsert);
}

            const { error: deleteProductsError } = await supabase
                .from('products')
                .delete()
                .eq('client_id', clientId);

            if (deleteProductsError) {
                console.error('Erro ao deletar produtos antigos:', deleteProductsError.message);
                showAlert('Erro', 'Cliente atualizado, mas erro ao limpar produtos antigos.');
            }

            if (editingProducts.length > 0) {
                const productsToInsert = editingProducts.map(p => ({
                    client_id: parseInt(clientId),
                    name: p.name,
                    quantity: p.quantity
                }));
                const { error: insertProductsError } = await supabase
                    .from('products')
                    .insert(productsToInsert);

                if (insertProductsError) {
                    console.error('Erro ao inserir novos produtos:', insertProductsError.message);
                    showAlert('Erro', 'Cliente atualizado, mas erro ao adicionar novos produtos.');
                }
            }

            showAlert('Sucesso', 'Cliente atualizado com sucesso!');
            logoFileInput.value = ''; 
            editingProducts = [];
            fetchAndRenderClients();
            showClientTab('view-clients');
        }

        async function addClientDocument(clientId) {
            const title = document.getElementById('clientDocumentTitle').value;
            const type = document.getElementById('clientDocumentType').value;
            const fileInput = document.getElementById('clientDocumentFile');
            const file = fileInput.files[0];

            if (title && type && file) {
                const filePath = `client_documents/${clientId}/${Date.now()}_${file.name}`;
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('clientdocumentfiles') 
                    .upload(filePath, file);

                if (uploadError) {
                    console.error('Erro ao fazer upload do arquivo do cliente:', uploadError.message);
                    showAlert('Erro', 'Erro ao fazer upload do documento do cliente. Verifique as permiss√µes do bucket.');
                    return;
                }

                const publicURL = `${SUPABASE_URL}/storage/v1/object/public/clientdocumentfiles/${filePath}`;

                const { data, error } = await supabase
                    .from('client_documents') 
                    .insert([
                        { client_id: clientId, title, type, file_url: publicURL, file_path: filePath }
                    ]);

                if (error) {
                    console.error('Erro ao adicionar documento do cliente no banco de dados:', error.message);
                    showAlert('Erro', 'Erro ao adicionar documento do cliente. Verifique as permiss√µes da tabela.');
                } else {
                    showAlert('Sucesso', 'Documento do cliente adicionado com sucesso!');
                    document.getElementById('clientDocumentTitle').value = '';
                    document.getElementById('clientDocumentType').value = '';
                    fileInput.value = '';
                    fetchAndRenderClientDocuments(clientId); 
                }
            } else {
                showAlert('Aten√ß√£o', 'Por favor, preencha todos os campos e selecione um arquivo para o documento do cliente.');
            }
        }

        async function fetchAndRenderClientDocuments(clientId) {
            const { data, error } = await supabase
                .from('client_documents') 
                .select('*')
                .eq('client_id', clientId);

            const container = document.getElementById('clientDocumentsList');

            if (error) {
                console.error('Erro ao buscar documentos do cliente:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Erro ao carregar documentos do cliente.</p></div>`;
                return;
            }

            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÅ</div>
                        <p>Nenhum documento para este cliente.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.map(doc => `
                <div class="document-card">
                    <div class="document-header">
                        <span class="document-type">${doc.type}</span>
                        <button class="delete-btn" onclick="deleteClientDocument(${doc.id}, '${doc.file_path}', ${clientId})">X</button>
                    </div>
                    <div class="document-title">${doc.title}</div>
                    <div class="document-author">ID do Cliente: ${doc.client_id}</div>
                    <a href="${doc.file_url}" download="${doc.title}.${doc.file_url.split('.').pop()}" target="_blank" class="btn-secondary" style="margin-top: 15px; display: block; text-align: center;">Download</a>
                </div>
            `).join('');
        }

        async function deleteClientDocument(documentId, filePath, clientId) {
            const confirmed = await showConfirm('Confirma√ß√£o', 'Tem certeza que deseja deletar este documento do cliente?');
            if (!confirmed) {
                return;
            }

            const { error: storageError } = await supabase.storage
                .from('clientdocumentfiles') 
                .remove([filePath]);

            if (storageError) {
                console.error('Erro ao deletar arquivo do Storage do cliente:', storageError.message);
                showAlert('Erro', 'Erro ao deletar arquivo do Storage do cliente. Verifique as permiss√µes do bucket.');
                return;
            }

            const { error: dbError } = await supabase
                .from('client_documents') 
                .delete()
                .eq('id', documentId);

            if (dbError) {
                console.error('Erro ao deletar documento do cliente do banco de dados:', dbError.message);
                showAlert('Erro', 'Erro ao deletar documento do cliente do banco de dados. Verifique as permiss√µes da tabela.');
            } else {
                showAlert('Sucesso', 'Documento do cliente deletado com sucesso!');
                fetchAndRenderClientDocuments(clientId); 
            }
        }

        // --- Dashboard  ---
        async function fetchAndRenderDashboards() {
            const { data, error } = await supabase
                .from('clients')
                .select('id, name, logo_url, bi_link')
                .not('bi_link', 'is', null)
                .not('bi_link', 'eq', '');

            const container = document.getElementById('dashboardsList');

            if (error) {
                console.error('Erro ao buscar dashboards:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Erro ao carregar dashboards.</p></div>`;
                return;
            }

            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>Nenhum Dashboard de cliente encontrado.</p>
                        <p>Adicione clientes com links de BI para visualiz√°-los aqui.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.map(client => `
                <div class="dashboard-card">
                    <div class="client-logo-vertical">
                        ${client.logo_url ? `<img src="${client.logo_url}" alt="Logo" class="logo-preview-vertical">` : client.name.charAt(0).toUpperCase()}
                    </div>
                    <h3>${client.name}</h3>
                    <a href="${client.bi_link}" target="_blank" class="btn-bi">
                        <i class="fas fa-external-link-alt"></i> Acessar
                    </a>
                </div>
            `).join('');
        }

        // --- Homologation  ---
       
        function openHomologacaoTab(evt, tabName) {
            document.querySelectorAll('#homologacao .tab-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            document.querySelectorAll('#homologacao .tab-button').forEach(button => {
                button.classList.remove('active');
            });

            const tab = document.getElementById(tabName);
            if (tab) {
                tab.style.display = 'block';
                tab.classList.add('active');
            }
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('active');
            }

            if (tabName === 'listaHomologacoes') {
                fetchAndRenderHomologacoes();
            }
        }

        
        const uploadAreaHomologacao = document.getElementById('uploadAreaHomologacao');
        const fileInputHomologacao = document.getElementById('fileInputHomologacao');
        const fileListHomologacao = document.getElementById('fileListHomologacao');

        uploadAreaHomologacao.addEventListener('click', () => fileInputHomologacao.click());

        uploadAreaHomologacao.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadAreaHomologacao.classList.add('dragover');
        });

        uploadAreaHomologacao.addEventListener('dragleave', () => {
            uploadAreaHomologacao.classList.remove('dragover');
        });

        uploadAreaHomologacao.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadAreaHomologacao.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            adicionarArquivosHomologacao(files);
        });

        fileInputHomologacao.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            adicionarArquivosHomologacao(files);
        });

        
        function adicionarArquivosHomologacao(files) {
            files.forEach(file => {
                if (file.size > 10 * 1024 * 1024) {
                    showAlert('Aten√ß√£o', `Arquivo ${file.name} √© muito grande. Limite: 10MB`);
                    return;
                }
                
                if (!arquivosHomologacaoSelecionados.find(f => f.name === file.name)) {
                    arquivosHomologacaoSelecionados.push(file);
                    criarItemArquivoHomologacao(file);
                }
            });
        }

        
        function criarItemArquivoHomologacao(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-info">
                    <span class="file-name">üìÑ ${file.name}</span>
                    <span class="file-size">(${formatarTamanho(file.size)})</span>
                </div>
                <button type="button" class="remove-file" onclick="removerArquivoHomologacao('${file.name}')">
                    ‚ùå Remover
                </button>
            `;
            fileListHomologacao.appendChild(fileItem);
        }

        
        function removerArquivoHomologacao(nomeArquivo) {
            arquivosHomologacaoSelecionados = arquivosHomologacaoSelecionados.filter(f => f.name !== nomeArquivo);
            const fileItems = fileListHomologacao.children;
            for (let item of fileItems) {
                if (item.querySelector('.file-name').textContent.includes(nomeArquivo)) {
                    fileListHomologacao.removeChild(item);
                    break;
                }
            }
        }

       
        function formatarTamanho(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Homologation
        document.getElementById('homologacaoForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const especialista = document.getElementById('especialista').value;
            const versao = document.getElementById('versao').value;
            const dataLiberacao = document.getElementById('dataLiberacao').value;
            const dataHomologacao = document.getElementById('dataHomologacao').value;
            const sistema = document.getElementById('sistema').value;
            const observacao = document.getElementById('observacao').value;

            const btn = document.querySelector('#homologacaoForm .btn-primary');
            const textoOriginal = btn.innerHTML;
            btn.innerHTML = '‚è≥ Enviando...';
            btn.disabled = true;

            let arquivosParaSalvar = [];

            for (let file of arquivosHomologacaoSelecionados) {
                const path = `homologacoes/${Date.now()}_${file.name}`;
                const { data, error } = await supabase.storage.from('homologacaoarquivos').upload(path, file);
                if (error) {
                    showAlert('Erro', `Erro ao enviar o arquivo ${file.name}: ${error.message}`);
                    btn.innerHTML = textoOriginal;
                    btn.disabled = false;
                    return;
                }
                
                const { data: publicData } = supabase.storage.from('homologacaoarquivos').getPublicUrl(path);
                arquivosParaSalvar.push({ nome: file.name, path: path, url: publicData.publicUrl });
            }

            const { error: insertError } = await supabase.from('homologacoes').insert([{
                especialista,
                versao,
                data_liberacao: dataLiberacao,
                data_homologacao: dataHomologacao || null,
                sistema,
                observacao,
                arquivos: arquivosParaSalvar 
            }]);

            btn.innerHTML = textoOriginal;
            btn.disabled = false;

            if (insertError) {
                showAlert('Erro', 'Erro ao salvar homologa√ß√£o: ' + insertError.message);
                console.error(insertError);
            } else {
                showAlert('Sucesso', 'Homologa√ß√£o salva com sucesso!');
                limparHomologacaoForm();
                fetchAndRenderHomologacoes();
                openHomologacaoTab(null, 'listaHomologacoes'); 
            }
        });

        
        function limparHomologacaoForm() {
            document.getElementById('homologacaoForm').reset();
            arquivosHomologacaoSelecionados = [];
            fileListHomologacao.innerHTML = '';
            document.getElementById('fileInputHomologacao').value = '';
        }

        
        document.getElementById('dataLiberacao').valueAsDate = new Date();

        
        async function fetchAndRenderHomologacoes() {
            const { data, error } = await supabase
                .from('homologacoes')
                .select('*')
                .order('data_liberacao', { ascending: false });

            const grid = document.getElementById('homologacoesGrid');
            const empty = document.getElementById('emptyStateHomologacao');

            if (error || !data || data.length === 0) {
                grid.innerHTML = '';
                empty.style.display = 'flex';
                return;
            }

            empty.style.display = 'none';
            grid.innerHTML = data.map(h => {
               
                const arquivosData = encodeURIComponent(JSON.stringify(h.arquivos || []));
                
                let html = "";
                html += '<div class="homologacao-card">';
                html += '<h4>Vers√£o: ' + h.versao + '</h4>';
                html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
                html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
                html += '<p><strong>Libera√ß√£o:</strong> ' + h.data_liberacao + '</p>';
                html += '<p><strong>Homologa√ß√£o:</strong> ' + (h.data_homologacao || '-') + '</p>';
                html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
                if (h.arquivos && h.arquivos.length) {
                    html += '<p><strong>Arquivos:</strong><br>' +
                        h.arquivos.map((file, i) =>
                            `<span>üìÑ ${file.nome}</span>`
                        ).join('<br>') +
                    '</p>';
                   
                    html += `<button class="btn-exportar" data-arquivos="${arquivosData}" onclick="baixarArquivosHomologacaoFromButton(this)">üì• Baixar Todos</button>`;
                }
                
                html += `<button class="btn-exportar" style="background-color: var(--error-color); margin-left: 10px;" data-arquivos="${arquivosData}" onclick="deleteHomologacaoFromButton(this, ${h.id})">üóëÔ∏è Excluir</button>`;
                html += '</div>';
                return html;
            }).join('');
        }

        
        async function filtrarHomologacoes() {
            const sistemaFiltro = document.getElementById('filtroSistema').value.toLowerCase();
            const especialistaFiltro = document.getElementById('filtroEspecialista').value.toLowerCase();

            const { data, error } = await supabase
                .from('homologacoes')
                .select('*')
                .order('data_liberacao', { ascending: false });

            if (error || !data) {
                console.error("Erro ao filtrar homologa√ß√µes:", error);
                return;
            }

            const filtradas = data.filter(h =>
                (!sistemaFiltro || h.sistema.toLowerCase().includes(sistemaFiltro)) &&
                (!especialistaFiltro || h.especialista.toLowerCase().includes(especialistaFiltro))
            );

            const grid = document.getElementById('homologacoesGrid');
            const empty = document.getElementById('emptyStateHomologacao');

            if (filtradas.length === 0) {
                grid.innerHTML = '';
                empty.style.display = 'flex';
            } else {
                empty.style.display = 'none';
                grid.innerHTML = filtradas.map(h => {
                    const arquivosData = encodeURIComponent(JSON.stringify(h.arquivos || []));
                    let html = '';
                    html += '<div class="homologacao-card">';
                    html += '<h4>Vers√£o: ' + h.versao + '</h4>';
                    html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
                    html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
                    html += '<p><strong>Libera√ß√£o:</strong> ' + h.data_liberacao + '</p>';
                    html += '<p><strong>Homologa√ß√£o:</strong> ' + (h.data_homologacao || '-') + '</p>';
                    html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
                    if (h.arquivos && h.arquivos.length) {
                        html += '<p><strong>Arquivos:</strong><br>' +
                            h.arquivos.map((file, i) =>
                                `<span>üìÑ ${file.nome}</span>`
                            ).join('<br>') +
                        '</p>';
                        html += `<button class="btn-exportar" data-arquivos="${arquivosData}" onclick="baixarArquivosHomologacaoFromButton(this)">üì• Baixar Todos</button>`;
                    }
                    html += `<button class="btn-exportar" style="background-color: var(--error-color); margin-left: 10px;" data-arquivos="${arquivosData}" onclick="deleteHomologacaoFromButton(this, ${h.id})">üóëÔ∏è Excluir</button>`;
                    html += '</div>';
                    return html;
                }).join('');
            }
        }

     
        async function baixarArquivosHomologacao(arquivosJsonString) {
            const arquivos = JSON.parse(arquivosJsonString);

            if (!arquivos || arquivos.length === 0) {
                showAlert("Informa√ß√£o", "Nenhum arquivo para baixar.");
                return;
            }

            for (const arquivo of arquivos) {
                try {
                    
                    const { data, error } = await supabase
                        .storage
                        .from('homologacaoarquivos')
                        .createSignedUrl(arquivo.path, 60, { download: true }); 

                    if (error) {
                        console.error("Erro ao gerar URL assinada para", arquivo.nome, error);
                        showAlert("Erro", `Erro ao baixar o arquivo ${arquivo.nome}.`);
                        continue;
                    }

                    if (data?.signedUrl) {
                        const response = await fetch(data.signedUrl);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const blob = await response.blob();
                        const link = document.createElement("a");
                        link.href = URL.createObjectURL(blob);
                        link.download = arquivo.nome; 
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(link.href); 
                    } else {
                        showAlert("Erro", `URL assinada n√£o gerada para o arquivo ${arquivo.nome}.`);
                    }
                } catch (error) {
                    console.error("Erro ao baixar arquivo:", arquivo.nome, error);
                    showAlert("Erro", `Falha ao baixar o arquivo ${arquivo.nome}.`);
                }
            }
        }

       
        async function deleteHomologacao(id, arquivosJsonString) {
            const confirmed = await showConfirm('Confirma√ß√£o', 'Tem certeza que deseja excluir esta homologa√ß√£o e seus arquivos?');
            if (!confirmed) {
                return;
            }

            const arquivos = JSON.parse(arquivosJsonString);
            
            if (arquivos && arquivos.length > 0) {
                const pathsToDelete = arquivos.map(a => a.path);
                const { error: storageError } = await supabase.storage
                    .from('homologacaoarquivos')
                    .remove(pathsToDelete);

                if (storageError) {
                    console.warn('Aviso: Erro ao deletar arquivos do Storage (podem n√£o existir ou caminho incorreto):', storageError.message);
                   
                }
            }

            
            const { error: dbError } = await supabase
                .from('homologacoes')
                .delete()
                .eq('id', id);

            if (dbError) {
                console.error('Erro ao deletar homologa√ß√£o do banco de dados:', dbError.message);
                showAlert('Erro', 'Erro ao deletar homologa√ß√£o do banco de dados. Verifique as permiss√µes da tabela.');
            } else {
                showAlert('Sucesso', 'Homologa√ß√£o exclu√≠da com sucesso!');
                fetchAndRenderHomologacoes(); 
            }
        }

       
        function baixarArquivosHomologacaoFromButton(button) {
            const arquivosJsonString = decodeURIComponent(button.dataset.arquivos);
            baixarArquivosHomologacao(arquivosJsonString);
        }

       
        async function deleteHomologacaoFromButton(button, homologacaoId) {
            const arquivosJsonString = decodeURIComponent(button.dataset.arquivos);
            await deleteHomologacao(homologacaoId, arquivosJsonString);
        }

        
        document.addEventListener('DOMContentLoaded', () => {
            showTab('dashboard'); 
        });
    </script>
<!-- In√≠cio do Relat√≥rio de Visita -->
<!-- Bot√£o na barra lateral -->
<li class="nav-item">
</li>
<!-- Nova Se√ß√£o: Relat√≥rio de Visita -->
<div class="content-section" id="relatorioVisita">
<div class="form-container">
<h3 style="margin-bottom: 20px; color: var(--accent-color);">Relat√≥rio de Visita</h3>
<div class="form-row">
<div class="form-group">
<label>Empresa</label>
<input id="rvEmpresa" type="text"/>
</div>
<div class="form-group">
<label>Data</label>
<input class="input-padrao" id="rvData" type="date" readonly/>
</div>
<div class="form-group">
<label>Gestor</label>
<input id="rvGestor" type="text"/>
</div>
<div class="form-group">
<label>Analista Respons√°vel</label>
<select id="rvAnalista">
<option value="Marlos">Marlos</option>
<option value="Renata">Renata</option>
<option value="Larissa">Larissa</option>
<option value="AdrielCS">Adriel CS</option>
<option value="GabrielCS">Gabriel CS</option>
</select>
</div>
</div>
<div class="form-group">
<label>Servi√ßos Contratados</label>
<textarea id="rvServicos" rows="2"></textarea>
</div>
<div class="form-group">
<label>Resumo da Visita</label>
<textarea id="rvResumo" rows="4"></textarea>
</div>
<div class="form-group">
<label>Chamados Urgentes</label>
<textarea id="rvChamados" rows="3"></textarea>
</div>
<div class="form-group">
<label>Local</label>
<input id="rvLocal" type="text"/>
</div>
<div class="form-group">
<div style="margin-bottom: 1rem;">
<label>Sem Report:</label>
<input id="inputSemReport" min="0" style="width: 80px; margin-right: 1rem;" type="number" value="0"/>
<label>Reportando:</label>
<input id="inputReportando" min="0" style="width: 80px; margin-right: 1rem;" type="number" value="0"/>
<label>Manuten√ß√£o:</label>
<input id="inputManutencao" min="0" style="width: 80px;" type="number" value="0"/>
<button onclick="atualizarGraficoStatus()" style="margin-left: 1rem;">Atualizar Gr√°fico</button>
</div>
<label>Report de Ve√≠culos</label>
<canvas id="chartVeiculos"></canvas>
</div>
<button class="btn-secondary" onclick="gerarPDFVisita()">Gerar PDF</button>
<button class="btn-primary" onclick="enviarPorEmail()" style="margin-left: 10px;">Enviar por Email</button>
<button class="btn-primary" onclick="enviarPorWhatsapp()" style="margin-left: 10px;">Enviar por WhatsApp</button>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Fim do Relat√≥rio de Visita -->
<!--Gr√°ficos  -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
let chartStatusVeiculos = null;
let chartComparativo = null;

function atualizarGraficoStatus() {
    const valores = {
        'Sem Report': parseInt(document.getElementById('inputSemReport').value || 0),
        'Reportando': parseInt(document.getElementById('inputReportando').value || 0),
        'Manuten√ß√£o': parseInt(document.getElementById('inputManutencao').value || 0)
    };

    if (chartStatusVeiculos) {
        chartStatusVeiculos.destroy();
    }

    chartStatusVeiculos = new Chart(document.getElementById('chartVeiculos'), {
        type: 'bar',
        data: {
            labels: Object.keys(valores),
            datasets: [{
                label: 'Status dos Ve√≠culos',
                data: Object.values(valores),
                backgroundColor: ['#4caf50', '#ff9800', '#f44336']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            }
        }
    });
}

async function carregarGraficoComparativo() {
    const { data: visitas, error } = await supabase.from('visitas').select('*');
    if (error) {
        console.error('Erro ao buscar visitas:', error.message);
        return;
    }

    const empresaSelecionada = document.getElementById('filtroEmpresa')?.value || 'todas';
    const visitasFiltradas = empresaSelecionada === 'todas' ? visitas : visitas.filter(v => v.empresa === empresaSelecionada);

    const visitasPorMes = {};
    visitasFiltradas.forEach(v => {
        visitasPorMes[v.mes] = (visitasPorMes[v.mes] || 0) + v.quantidade;
    });

    if (chartComparativo) {
        chartComparativo.destroy();
    }

    chartComparativo = new Chart(document.getElementById('chartComparativo'), {
        type: 'line',
        data: {
            labels: Object.keys(visitasPorMes),
            datasets: [{
                label: 'Visitas por M√™s',
                data: Object.values(visitasPorMes),
                borderColor: '#007bff',
                fill: false
            }]
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById('chartVeiculos')) {
        atualizarGraficoStatus();
    }
    if (document.getElementById('chartComparativo')) {
        carregarGraficoComparativo();
    }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
<script>
async function gerarPDFVisita() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const img = new Image();
  img.src = "data:image/png;base64,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";
  await new Promise(resolve => {
    img.onload = () => resolve();
  });
  doc.addImage(img, 'PNG', 10, 10, 60, 20); 

 
  doc.setTextColor(0, 230, 253);
  doc.setFontSize(22);
  doc.setFont(undefined, 'bold');
  doc.text('Relat√≥rio de Visita', 80, 30); 

  let y = 45;
  doc.setDrawColor(0, 230, 253);
  doc.line(10, y - 5, 200, y - 5); 

  const campos = [
    ['Empresa', 'rvEmpresa'],
    ['Data', 'rvData'],
    ['Gestor', 'rvGestor'],
    ['Analista', 'rvAnalista'],
    ['Servi√ßos Contratados', 'rvServicos'],
    ['Chamados Urgentes', 'rvChamados'],
    ['Local', 'rvLocal']
  ];

  doc.setFontSize(12);
  doc.setTextColor(0);
  campos.forEach(([label, id]) => {
    const el = document.getElementById(id);
    const valor = el ? el.value : '';
    const texto = doc.splitTextToSize(`${label}: ${valor}`, 180);
    doc.text(texto, 10, y);
    y += texto.length * 8;
    if (y > 270) {
      doc.addPage();
      y = 20;
    }
  });

  // Resumo em tabela
  const resumo = document.getElementById('rvResumo')?.value || '';
  const linhasResumo = resumo.split('\n').map(linha => [linha.trim()]);
  if (linhasResumo.length > 0) {
    doc.addPage();
    doc.setFontSize(14);
    doc.setTextColor(0, 230, 253);
    doc.text('Resumo da Visita (Tabela)', 10, 20);
    doc.autoTable({
      startY: 30,
      head: [['Conte√∫do']],
      body: linhasResumo,
      styles: { fontSize: 10, halign: 'left' },
      headStyles: { fillColor: [0, 230, 253], textColor: 20, fontStyle: 'bold' },
      alternateRowStyles: { fillColor: [245, 245, 245] },
      tableLineColor: [200, 200, 200],
      tableLineWidth: 0.1
    });
  }

  // Gr√°fico
  const canvas1 = document.getElementById('chartVeiculos');
  if (canvas1) {
    const imgData1 = canvas1.toDataURL('image/png');
    doc.addPage();
    doc.setFontSize(14);
    doc.setTextColor(0, 230, 253);
    doc.text('Gr√°fico: Report de Ve√≠culos', 10, 20);
    doc.addImage(imgData1, 'PNG', 10, 30, 180, 90);
  }

  // Gr√°fico: Comparativo
  const canvas2 = document.getElementById('chartComparativo');
  if (canvas2) {
    const imgData2 = canvas2.toDataURL('image/png');
    doc.addPage();
    doc.setFontSize(14);
    doc.setTextColor(0, 230, 253);
    doc.text('Gr√°fico: Comparativo de Visitas por Empresa', 10, 20);
    doc.addImage(imgData2, 'PNG', 10, 30, 180, 90);
  }

  doc.save('relatorio_visita_completo.pdf');
}
</script>
<script>
function exibirRelease(d, url) {
  const c = document.createElement("div");
  c.className = "document-card";
  c.setAttribute("data-release-id", d.id);
  const arquivoJson = JSON.stringify([{ path: d.file_path }]).replace(/"/g, '&quot;');

  c.innerHTML = `
    <div class="document-header"><span class="document-type">${d.tipo}</span></div>
    <div class="document-title">${d.sistema} - ${d.versao}</div>
    <div class="document-author">${d.analista}</div>
    <p>Status: ${d.status}</p>
    <p>Data Libera√ß√£o: ${d.data_liberacao}</p>
    <p>Data Homologa√ß√£o: ${d.data_homologacao}</p>
    <div style="display:flex; justify-content:space-between; margin-top:10px;">
      <a href="${url}" class="btn-secondary" target="_blank">Ver Arquivo</a>
      <button class="btn-secondary" style="background-color:#dc3545;" onclick="deleteRelease(${d.id}, '${arquivoJson}')">Excluir</button>
    </div>`;
  document.getElementById("releaseList").appendChild(c);
}
</script><script>
async function deleteRelease(id, arquivosJsonString) {
    const confirmed = await showConfirm('Confirma√ß√£o', 'Tem certeza que deseja excluir este release e seu arquivo?');
    if (!confirmed) return;

    const arquivos = JSON.parse(arquivosJsonString);

    if (arquivos && arquivos.length > 0) {
        const pathsToDelete = arquivos.map(a => a.path);
        const { error: storageError } = await releaseClient.storage
            .from('releasefiles')
            .remove(pathsToDelete);

        if (storageError) {
            console.warn('Erro ao deletar arquivo do Storage:', storageError.message);
        }
    }

    const { error: dbError } = await releaseClient
        .from('releases')
        .delete()
        .eq('id', id);

    if (dbError) {
        console.error('Erro ao deletar release do banco:', dbError.message);
        showAlert('Erro', 'Erro ao deletar release.');
    } else {
        showAlert('Sucesso', 'Release exclu√≠do com sucesso!');
        document.querySelector(`[data-release-id="\${id}"]`)?.remove();
    }
}
</script><script>
async function salvarRelease() {
  const d = {
    data_liberacao: document.getElementById('releaseDate').value,
    status: document.getElementById('releaseStatus').value,
    sistema: document.getElementById('releaseSystem').value,
    versao: document.getElementById('releaseVersion').value,
    analista: document.getElementById('releaseAnalyst').value,
    data_homologacao: document.getElementById('releaseHomologDate').value,
    tipo: document.getElementById('releaseType').value,
    arquivo: document.getElementById('releaseFile').files[0]
  };
  if (!d.arquivo) return alert('Selecione um arquivo.');
  const nome = Date.now() + '_' + d.arquivo.name.replace(/\s+/g, "_");
  const { error: e1 } = await releaseClient.storage.from('releasefiles').upload(nome, d.arquivo);
  if (e1) return alert("Erro upload");
  const file_url = `${RELEASE_SUPABASE_URL}/storage/v1/object/public/releasefiles/${nome}`;
  const { arquivo, ...dadosParaInsert } = d;
  const { data, error: e2 } = await releaseClient.from("releases").insert([{ ...dadosParaInsert, file_url, file_path: nome }]).select();
  if (e2) return alert("Erro insert");
  exibirRelease(data[0], file_url);
}
</script><script>
async function salvarReuniao() {
  const cliente = document.getElementById("reuniaoCliente").value;
  const data = document.getElementById("reuniaoData").value;
  const tipo = document.getElementById("reuniaoTipo").value;
  const participantes = document.getElementById("reuniaoParticipantes").value;
  const file = document.getElementById("reuniaoFile").files[0];

  let file_url = "", file_path = "";

  if (file) {
    file_path = Date.now() + '_' + file.name.replace(/\s+/g, "_");
    const { error } = await releaseClient.storage.from("reuniaofiles").upload(file_path, file);
    if (error) return alert("Erro ao fazer upload da ata");
    file_url = `${RELEASE_SUPABASE_URL}/storage/v1/object/public/reuniaofiles/${file_path}`;
  }

  const { error: insertError } = await releaseClient.from("reunioes").insert([{ cliente, data, tipo, participantes, file_url, file_path }]);
  if (insertError) return alert("Erro ao salvar reuni√£o.");
  carregarReunioes();
}

async function carregarReunioes() {
  const { data, error } = await releaseClient.from("reunioes").select("*").order("data", { ascending: false });
  if (error) return console.error("Erro ao carregar reuni√µes", error);

  const container = document.getElementById("listaReunioes")
  container.innerHTML = "";

  const agrupado = {};
  data.forEach(r => {
    const cli = r.cliente.toLowerCase();
    if (!agrupado[cli]) agrupado[cli] = [];
    agrupado[cli].push(r);
  });

  Object.keys(agrupado).forEach(cli => {
    const blocos = agrupado[cli];
    const card = document.createElement("div");
    card.className = "document-card";
    card.setAttribute("data-cliente", cli);
    card.innerHTML = `
      <div class="document-title">${blocos[0].cliente}</div>
      <div class="document-author">Total de reuni√µes: ${blocos.length}</div>
      <div style="margin-top: 10px;">
        ${blocos.map(r => `
          <div style="margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px dashed #336699;">
            <p><strong>Data:</strong> ${r.data}</p>
            <p><strong>Tipo:</strong> ${r.tipo}</p>
            <p><strong>Participantes:</strong> ${r.participantes}</p>
            ${r.file_url ? `<a class="btn-ver-ata" href="${r.file_url}" target="_blank">Ver Ata</a>` : "<em>Sem ata</em>"}
          </div>
        `).join("")}
      </div>
    `;
    container.appendChild(card);
  });
}

function filtrarReunioes() {
  const filtro = document.getElementById("filtroReuniaoCliente").value.toLowerCase();
  document.querySelectorAll("#listaReunioes .document-card").forEach(c => {
    const cli = c.getAttribute("data-cliente") || "";
    c.style.display = cli.includes(filtro) ? "block" : "none";
  });
}

document.addEventListener("DOMContentLoaded", carregarReunioes);
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const nome = localStorage.getItem('username') || 'TRYVIA';
    document.getElementById('nomeUsuario').innerText = nome;
  });
</script>

<!-- Chart.js para gr√°ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// ===== FUN√á√ïES DA ABA IN√çCIO =====

let dashboardData = {
    totalClients: 0,
    totalHomologacoes: 0,
    totalReleases: 0,
    totalReunioes: 0,
    recentActivities: [],
    highlightClients: [],
    notifications: []
};

// Inicializar aba In√≠cio
async function initializeInicio() {
    updateDateTime();
    await loadDashboardMetrics();
    await loadRecentActivities();
    await loadHighlightClients();
    loadNotifications();
    createCharts();
    
    // Auto-refresh a cada 5 minutos
    setInterval(async () => {
        await loadDashboardMetrics();
        await loadRecentActivities();
        updateDateTime();
    }, 300000);
}

// Atualizar data e hora
function updateDateTime() {
    const now = new Date();
    const dateStr = now.toLocaleDateString('pt-BR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    const timeStr = now.toLocaleTimeString('pt-BR');
    
    document.getElementById('currentDate').textContent = dateStr;
    document.getElementById('lastUpdate').textContent = timeStr;
}

// Carregar m√©tricas 
async function loadDashboardMetrics() {
    try {
        // Carregar contadores de cada tabela
        const [clientsResult, homologacoesResult, releasesResult, reunioesResult] = await Promise.all([
            supabase.from('clients').select('id', { count: 'exact', head: true }),
            supabase.from('homologacoes').select('id', { count: 'exact', head: true }),
            releaseClient.from('releases').select('id', { count: 'exact', head: true }),
            releaseClient.from('reunioes').select('id', { count: 'exact', head: true })
        ]);

        dashboardData.totalClients = clientsResult.count || 0;
        dashboardData.totalHomologacoes = homologacoesResult.count || 0;
        dashboardData.totalReleases = releasesResult.count || 0;
        dashboardData.totalReunioes = reunioesResult.count || 0;

        // Atualizar UI
        document.getElementById('totalClients').textContent = dashboardData.totalClients;
        document.getElementById('totalHomologacoes').textContent = dashboardData.totalHomologacoes;
        document.getElementById('totalReleases').textContent = dashboardData.totalReleases;
        document.getElementById('totalReunioes').textContent = dashboardData.totalReunioes;

        // Adicionar anima√ß√£o aos cards
        document.querySelectorAll('.metric-card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-5px)';
                card.style.boxShadow = '0 8px 25px rgba(41, 182, 246, 0.4)';
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = '0 4px 15px rgba(41, 182, 246, 0.3)';
            });
        });

    } catch (error) {
        console.error('Erro ao carregar m√©tricas:', error);
    }
}

// Carregar atividades recentes
async function loadRecentActivities() {
    try {
        const activitiesList = document.getElementById('activitiesList');
        activitiesList.innerHTML = '<div style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> Carregando...</div>';

        // Buscar atividades recentes de diferentes tabelas
        const [clientsData, homologacoesData, releasesData, reunioesData] = await Promise.all([
            supabase.from('clients').select('id, name, created_at').order('created_at', { ascending: false }).limit(3),
            supabase.from('homologacoes').select('id, especialista, versao, data_liberacao').order('data_liberacao', { ascending: false }).limit(3),
            releaseClient.from('releases').select('id, sistema, versao, data_liberacao').order('data_liberacao', { ascending: false }).limit(3),
            releaseClient.from('reunioes').select('id, cliente, data, tipo').order('data', { ascending: false }).limit(3)
        ]);

        let activities = [];

        // Processar clientes
        if (clientsData.data) {
            clientsData.data.forEach(client => {
                activities.push({
                    type: 'cliente',
                    icon: 'üë•',
                    color: '#4fc3f7',
                    title: 'Novo Cliente',
                    description: client.name,
                    date: new Date(client.created_at),
                    action: () => showTab('clients')
                });
            });
        }

        // Processar homologa√ß√µes
        if (homologacoesData.data) {
            homologacoesData.data.forEach(homol => {
                activities.push({
                    type: 'homologacao',
                    icon: '‚úÖ',
                    color: '#66bb6a',
                    title: 'Homologa√ß√£o',
                    description: `${homol.versao} - ${homol.especialista}`,
                    date: new Date(homol.data_liberacao),
                    action: () => showTab('homologacao')
                });
            });
        }

        // Processar releases
        if (releasesData.data) {
            releasesData.data.forEach(release => {
                activities.push({
                    type: 'release',
                    icon: 'üöÄ',
                    color: '#ff7043',
                    title: 'Release',
                    description: `${release.sistema} ${release.versao}`,
                    date: new Date(release.data_liberacao),
                    action: () => showTab('release')
                });
            });
        }

        // Processar reuni√µes
        if (reunioesData.data) {
            reunioesData.data.forEach(reuniao => {
                activities.push({
                    type: 'reuniao',
                    icon: 'üìÖ',
                    color: '#ab47bc',
                    title: 'Reuni√£o',
                    description: `${reuniao.tipo} - ${reuniao.cliente}`,
                    date: new Date(reuniao.data),
                    action: () => showTab('reunioes')
                });
            });
        }

        // Ordenar 
        activities.sort((a, b) => b.date - a.date);
        activities = activities.slice(0, 10); 

        // Renderizar atividades
        if (activities.length === 0) {
            activitiesList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-inbox" style="font-size: 2em; margin-bottom: 15px;"></i>
                    <p>Nenhuma atividade recente</p>
                </div>
            `;
        } else {
            activitiesList.innerHTML = activities.map(activity => `
                <div class="activity-item" style="background: rgba(179, 229, 252, 0.95); border-left: 4px solid ${activity.color}; padding: 16px; margin-bottom: 12px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease;" onclick="(${activity.action.toString()})()">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 1.5em;">${activity.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: #000; margin-bottom: 4px;">${activity.title}</div>
                            <div style="color: #333; margin-bottom: 4px;">${activity.description}</div>
                            <div style="font-size: 0.85em; color: #666;">${activity.date.toLocaleDateString('pt-BR')} √†s ${activity.date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

    } catch (error) {
        console.error('Erro ao carregar atividades:', error);
        document.getElementById('activitiesList').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #f44336;">
                <i class="fas fa-exclamation-triangle" style="font-size: 2em; margin-bottom: 15px;"></i>
                <p>Erro ao carregar atividades</p>
            </div>
        `;
    }
}

// Carregar clientes em destaque
async function loadHighlightClients() {
    try {
        const carousel = document.getElementById('clientsCarousel');
        carousel.innerHTML = '<div style="text-align: center; padding: 20px; min-width: 100%;"><i class="fas fa-spinner fa-spin"></i> Carregando...</div>';

        const { data: clients, error } = await supabase
            .from('clients')
            .select('id, name, logo_url, bi_link')
            .not('bi_link', 'is', null)
            .not('bi_link', 'eq', '')
            .limit(5);

        if (error) throw error;

        if (clients.length === 0) {
            carousel.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666; min-width: 100%;">
                    <i class="fas fa-users" style="font-size: 2em; margin-bottom: 15px;"></i>
                    <p>Nenhum cliente com BI configurado</p>
                </div>
            `;
        } else {
            carousel.innerHTML = clients.map(client => `
                <div class="client-highlight-card" style="min-width: 200px; background: #ffffff; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transition: transform 0.3s ease; cursor: pointer;" onclick="window.open('${client.bi_link}', '_blank')">
                    <div style="width: 80px; height: 80px; margin: 0 auto 15px; border-radius: 50%; background: #f5f5f5; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                        ${client.logo_url ? 
                            `<img src="${client.logo_url}" alt="${client.name}" style="width: 100%; height: 100%; object-fit: cover;">` :
                            `<span style="font-size: 2em; color: #29b6f6;">${client.name.charAt(0).toUpperCase()}</span>`
                        }
                    </div>
                    <h4 style="margin: 0 0 10px 0; color: #333; font-size: 1.1em;">${client.name}</h4>
                    <p style="margin: 0; color: #666; font-size: 0.9em;">Dashboard BI</p>
                    <div style="margin-top: 15px;">
                        <span style="background: #4fc3f7; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8em;">Ativo</span>
                    </div>
                </div>
            `).join('');

            // Adicionar hover effects
            document.querySelectorAll('.client-highlight-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'scale(1.05)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'scale(1)';
                });
            });
        }

    } catch (error) {
        console.error('Erro ao carregar clientes em destaque:', error);
        document.getElementById('clientsCarousel').innerHTML = `
            <div style="text-align: center; padding: 40px; color: #f44336; min-width: 100%;">
                <i class="fas fa-exclamation-triangle" style="font-size: 2em; margin-bottom: 15px;"></i>
                <p>Erro ao carregar clientes</p>
            </div>
        `;
    }
}

// Carregar notifica√ß√µes
function loadNotifications() {
    
    // Futuramente pode incluir l√≥gica para verificar homologa√ß√µes vencendo, etc.
    const notificationsList = document.getElementById('notificationsList');
    notificationsList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #666;">
            <i class="fas fa-check-circle" style="font-size: 2em; margin-bottom: 10px; color: #4caf50;"></i>
            <p>Tudo em dia!</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Nenhuma notifica√ß√£o pendente</p>
        </div>
    `;
}

// Criar gr√°ficos
async function createCharts() {
    try {
        // Gr√°fico de Homologa√ß√µes por M√™s
        await createHomologacoesChart();
        
        // Gr√°fico de Releases por Tipo
        await createReleasesChart();
        
    } catch (error) {
        console.error('Erro ao criar gr√°ficos:', error);
    }
}

// Gr√°fico de Homologa√ß√µes por M√™s
async function createHomologacoesChart() {
    try {
        const { data, error } = await supabase
            .from('homologacoes')
            .select('data_liberacao');

        if (error) throw error;

        // Processar dados por m√™s
        const monthCounts = {};
        const currentYear = new Date().getFullYear();
        
        // Inicializar √∫ltimos 6 meses
        for (let i = 5; i >= 0; i--) {
            const date = new Date();
            date.setMonth(date.getMonth() - i);
            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            monthCounts[key] = 0;
        }

        // Contar homologa√ß√µes por m√™s
        data.forEach(item => {
            const date = new Date(item.data_liberacao);
            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            if (monthCounts.hasOwnProperty(key)) {
                monthCounts[key]++;
            }
        });

        const labels = Object.keys(monthCounts).map(key => {
            const [year, month] = key.split('-');
            const date = new Date(year, month - 1);
            return date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
        });

        const values = Object.values(monthCounts);

        const ctx = document.getElementById('homologacoesChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Homologa√ß√µes',
                    data: values,
                    backgroundColor: 'rgba(41, 182, 246, 0.8)',
                    borderColor: 'rgba(41, 182, 246, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });

    } catch (error) {
        console.error('Erro ao criar gr√°fico de homologa√ß√µes:', error);
    }
}

// Gr√°fico de Releases por Tipo
async function createReleasesChart() {
    try {
        const { data, error } = await releaseClient
            .from('releases')
            .select('tipo');

        if (error) throw error;

        // Contar por tipo
        const typeCounts = {};
        data.forEach(item => {
            const tipo = item.tipo || 'N√£o especificado';
            typeCounts[tipo] = (typeCounts[tipo] || 0) + 1;
        });

        const labels = Object.keys(typeCounts);
        const values = Object.values(typeCounts);
        const colors = [
            'rgba(255, 99, 132, 0.8)',
            'rgba(54, 162, 235, 0.8)',
            'rgba(255, 205, 86, 0.8)',
            'rgba(75, 192, 192, 0.8)',
            'rgba(153, 102, 255, 0.8)'
        ];

        const ctx = document.getElementById('releasesChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: colors.slice(0, labels.length),
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

    } catch (error) {
        console.error('Erro ao criar gr√°fico de releases:', error);
    }
}

// Fun√ß√£o para refresh manual das atividades
async function refreshActivities() {
    const button = event.target;
    const originalIcon = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    await loadRecentActivities();
    updateDateTime();
    
    setTimeout(() => {
        button.innerHTML = originalIcon;
        button.disabled = false;
    }, 1000);
}

// Inicializar quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
  
    setTimeout(() => {
        showTab('inicio');
    }, 500);
});

</script>
</body>

</html>


<!-- Chat Widget -->
<!-- Bot√£o para mostrar/esconder o chat -->
<div id="chat-toggle-button" style="position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; background-color: #0288d1; color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 1001;">
    üí¨
</div>

<div id="chat-container" style="position: fixed; top: 20px; right: 20px; width: 300px; height: 400px; background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); display: none; flex-direction: column; z-index: 1000; transition: all 0.3s ease;">
    <div id="chat-header" style="background-color: #0288d1; color: white; padding: 10px; border-top-left-radius: 10px; border-top-right-radius: 10px; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
        <span>Assistente do Portal</span>
        <button id="chat-close-button" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 0; width: 20px; height: 20px;">√ó</button>
    </div>
    <div id="chat-messages" style="flex-grow: 1; padding: 10px; overflow-y: auto; border-bottom: 1px solid #eee;"></div>
    <div id="chat-input-container" style="padding: 10px; display: flex;">
        <input type="text" id="chat-input" placeholder="Digite sua mensagem..." style="flex-grow: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin-right: 10px;">
        <button id="chat-send-button" style="background-color: #0288d1; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">Enviar</button>
    </div>
</div>

<script>
    const chatMessages = document.getElementById("chat-messages");
    const chatInput = document.getElementById("chat-input");
    const chatSendButton = document.getElementById("chat-send-button");
    const chatContainer = document.getElementById("chat-container");
    const chatToggleButton = document.getElementById("chat-toggle-button");
    const chatCloseButton = document.getElementById("chat-close-button");

    // Fun√ß√£o para mostrar o chat
    function showChat() {
        chatContainer.style.display = "flex";
        chatToggleButton.style.display = "none";
    }

    // Fun√ß√£o para esconder o chat
    function hideChat() {
        chatContainer.style.display = "none";
        chatToggleButton.style.display = "flex";
    }

    // Event listeners para mostrar/esconder o chat
    chatToggleButton.addEventListener("click", showChat);
    chatCloseButton.addEventListener("click", hideChat);

    function appendMessage(sender, message) {
        const messageElement = document.createElement("div");
        messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    chatSendButton.addEventListener("click", async () => {
        const message = chatInput.value.trim();
        if (message) {
            appendMessage("Voc√™", message);
            chatInput.value = "";

            try {
                const response = await fetch("https://5000-i15r3x8k3k10fog7u69rk-619fe7be.manusvm.computer/api/supabase/query", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ query: message })
                });
                const data = await response.json();
                appendMessage("Assistente", data.response || `O n√∫mero √©: ${data.count}`);
            } catch (error) {
                console.error("Erro ao comunicar com o backend:", error);
                appendMessage("Assistente", "Desculpe, n√£o consegui processar sua solicita√ß√£o no momento.");
            }
         }
    });
    chatInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
            chatSendButton.click();
        }
    });
    // Inicializar a mensagem de boas-vindas apenas quando o chat for aberto pela primeira vez
    let chatInitialized = false;
    chatToggleButton.addEventListener("click", () => {
        if (!chatInitialized) {
            appendMessage("Assistente", "Ol√°! Como posso ajudar hoje?");
            chatInitialized = true;
        }
    });
</script>

<!-- Modais para Painel do Setor -->
<!-- Modal para Adicionar Tarefa -->
<div id="addTaskModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <h3>Adicionar Nova Tarefa</h3>
        <div class="form-group">
            <label for="taskType">Tipo de Tarefa</label>
            <select id="taskType">
                <option value="treinamento">Treinamento</option>
                <option value="migracao">Migra√ß√£o</option>
                <option value="reuniao">Reuni√£o</option>
                <option value="mvp">MVP</option>
                <option value="homologacao">Homologa√ß√£o</option>
                <option value="acompanhamento">Acompanhamento</option>
                <option value="implantacao">Implanta√ß√£o</option>
                <option value="projeto">Projeto em andamento</option>
                <option value="ticket">Ticket</option>
            </select>
        </div>
        <div class="form-group">
            <label for="taskTitle">T√≠tulo da Tarefa</label>
            <input type="text" id="taskTitle" placeholder="Digite o t√≠tulo da tarefa">
        </div>
        <div class="form-group">
            <label for="taskDescription">Descri√ß√£o</label>
            <textarea id="taskDescription" placeholder="Descreva a tarefa"></textarea>
        </div>
        <div class="form-group">
            <label for="taskResponsible">Respons√°vel</label>
            <input type="text" id="taskResponsible" placeholder="Nome do respons√°vel">
        </div>
        <div class="form-group">
            <label for="taskDeadline">Prazo</label>
            <input type="date" id="taskDeadline">
        </div>
        <div class="modal-buttons">
            <button class="modal-button cancel" onclick="closeModal('addTaskModal')">Cancelar</button>
            <button class="modal-button confirm" onclick="saveTask()">Salvar</button>
        </div>
    </div>
</div>

<!--  Adicionar Membro do Time -->
<div id="addTeamMemberModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <h3>Adicionar Membro do Time</h3>
        <div class="form-group">
            <label for="memberName">Nome</label>
            <input type="text" id="memberName" placeholder="Nome completo">
        </div>
        <div class="form-group">
            <label for="memberRole">Cargo</label>
            <select id="memberRole">
                <option value="Gerente">Gerente</option>
                <option value="Especialista">Especialista</option>
                <option value="Analista">Analista</option>
                <option value="Desenvolvedor">Desenvolvedor</option>
                <option value="Consultor">Consultor</option>
            </select>
        </div>
        <div class="form-group">
            <label for="memberEmail">Email</label>
            <input type="email" id="memberEmail" placeholder="email@exemplo.com">
        </div>
        <div class="form-group">
            <label for="memberPhoto">Foto</label>
            <input type="file" id="memberPhoto" accept="image/*">
        </div>
        <div class="modal-buttons">
            <button class="modal-button cancel" onclick="closeModal('addTeamMemberModal')">Cancelar</button>
            <button class="modal-button confirm" onclick="saveTeamMember()">Salvar</button>
        </div>
    </div>
</div>

<!--  Adicionar Projeto -->
<div id="addProjectModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 600px;">
        <h3>Adicionar Novo Projeto</h3>
        <div class="form-group">
            <label for="projectName">Nome do Projeto</label>
            <input type="text" id="projectName" placeholder="Nome do projeto">
        </div>
        <div class="form-group">
            <label for="projectCompany">Empresa</label>
            <input type="text" id="projectCompany" placeholder="Nome da empresa">
        </div>
        <div class="form-group">
            <label for="projectSpecialist">Especialista Respons√°vel</label>
            <input type="text" id="projectSpecialist" placeholder="Nome do especialista">
        </div>
        <div class="form-group">
            <label for="projectDescription">Descri√ß√£o</label>
            <textarea id="projectDescription" placeholder="Descri√ß√£o do projeto"></textarea>
        </div>
        <div class="form-group">
            <label for="projectStatus">Status</label>
            <select id="projectStatus">
                <option value="Planejamento">Planejamento</option>
                <option value="Em Andamento">Em Andamento</option>
                <option value="Homologa√ß√£o">Homologa√ß√£o</option>
                <option value="Finalizado">Finalizado</option>
            </select>
        </div>
        <div class="modal-buttons">
            <button class="modal-button cancel" onclick="closeModal('addProjectModal')">Cancelar</button>
            <button class="modal-button confirm" onclick="saveProject()">Salvar</button>
        </div>
    </div>
</div>

<!-- Adicionar Visita -->
<div id="addVisitModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <h3>Adicionar Nova Visita</h3>
        <div class="form-group">
            <label for="visitCompany">Empresa</label>
            <input type="text" id="visitCompany" placeholder="Nome da empresa">
        </div>
        <div class="form-group">
            <label for="visitAddress">Endere√ßo</label>
            <input type="text" id="visitAddress" placeholder="Endere√ßo completo">
        </div>
        <div class="form-group">
            <label for="visitCity">Cidade</label>
            <input type="text" id="visitCity" placeholder="Cidade">
        </div>
        <div class="form-group">
            <label for="visitState">Estado</label>
            <input type="text" id="visitState" placeholder="Estado">
        </div>
        <div class="form-group">
            <label for="visitDate">Data da Visita</label>
            <input type="date" id="visitDate">
        </div>
        <div class="form-group">
            <label for="visitPurpose">Objetivo</label>
            <textarea id="visitPurpose" placeholder="Objetivo da visita"></textarea>
        </div>
        <div class="modal-buttons">
            <button class="modal-button cancel" onclick="closeModal('addVisitModal')">Cancelar</button>
            <button class="modal-button confirm" onclick="saveVisit()">Salvar</button>
        </div>
    </div>
</div>

<!-- Adicionar Entrega -->
<div id="addEntregaModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <h3>Adicionar Nova Entrega</h3>
        <div class="form-group">
            <label for="entregaMonth">M√™s</label>
            <select id="entregaMonth">
                <option value="JAN">Janeiro</option>
                <option value="FEV">Fevereiro</option>
                <option value="MAR">Mar√ßo</option>
                <option value="ABR">Abril</option>
                <option value="MAI">Maio</option>
                <option value="JUN">Junho</option>
                <option value="JUL">Julho</option>
                <option value="AGO">Agosto</option>
                <option value="SET">Setembro</option>
                <option value="OUT">Outubro</option>
                <option value="NOV">Novembro</option>
                <option value="DEZ">Dezembro</option>
            </select>
        </div>
        <div class="form-group">
            <label for="entregaMarlos">Marlos (%)</label>
            <input type="number" id="entregaMarlos" min="0" max="100" placeholder="0-100">
        </div>
        <div class="form-group">
            <label for="entregaLarissa">Larissa (%)</label>
            <input type="number" id="entregaLarissa" min="0" max="100" placeholder="0-100">
        </div>
        <div class="form-group">
            <label for="entregaRenata">Renata (%)</label>
            <input type="number" id="entregaRenata" min="0" max="100" placeholder="0-100">
        </div>
        <div class="form-group">
            <label for="entregaVictor">Victor (%)</label>
            <input type="number" id="entregaVictor" min="0" max="100" placeholder="0-100">
        </div>
        <div class="modal-buttons">
            <button class="modal-button cancel" onclick="closeModal('addEntregaModal')">Cancelar</button>
            <button class="modal-button confirm" onclick="saveEntrega()">Salvar</button>
        </div>
    </div>
</div>

<script>

let painelData = {
    tarefas: [],
    time: [],
    projetos: [],
    visitas: [],
    entregas: []
};

// Fun√ß√µes para mostrar modais
function showAddTaskModal() {
    document.getElementById('addTaskModal').classList.add('visible');
}

function showAddTeamMemberModal() {
    document.getElementById('addTeamMemberModal').classList.add('visible');
}

function showAddProjectModal() {
    document.getElementById('addProjectModal').classList.add('visible');
}

function showAddVisitModal() {
    document.getElementById('addVisitModal').classList.add('visible');
}

function showAddEntregaModal() {
    document.getElementById('addEntregaModal').classList.add('visible');
}

// Fun√ß√£o para fechar modais
function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('visible');
}

// Fun√ß√µes para salvar dados
async function saveTask() {
    const taskData = {
        tipo: document.getElementById('taskType').value,
        titulo: document.getElementById('taskTitle').value,
        descricao: document.getElementById('taskDescription').value,
        responsavel: document.getElementById('taskResponsible').value,
        prazo: document.getElementById('taskDeadline').value,
        status: 'pendente',
        created_at: new Date().toISOString()
    };

    try {
        const { data, error } = await supabase
            .from('tarefas')
            .insert([taskData]);

        if (error) throw error;

        showAlert('Sucesso', 'Tarefa adicionada com sucesso!');
        closeModal('addTaskModal');
        clearTaskForm();
        loadPainelData();
    } catch (error) {
        console.error('Erro ao salvar tarefa:', error);
        showAlert('Erro', 'Erro ao salvar tarefa. Tente novamente.');
    }
}

async function saveTeamMember() {
    const memberData = {
        nome: document.getElementById('memberName').value,
        cargo: document.getElementById('memberRole').value,
        email: document.getElementById('memberEmail').value,
        ativo: true,
        created_at: new Date().toISOString()
    };

    // Upload da foto se fornecida
    const photoFile = document.getElementById('memberPhoto').files[0];
    if (photoFile) {
        const photoPath = `team/${Date.now()}_${photoFile.name}`;
        const { data: uploadData, error: uploadError } = await supabase.storage
            .from('team-photos')
            .upload(photoPath, photoFile);

        if (uploadError) {
            console.error('Erro ao fazer upload da foto:', uploadError);
        } else {
            memberData.foto_url = `${SUPABASE_URL}/storage/v1/object/public/team-photos/${photoPath}`;
        }
    }

    try {
        const { data, error } = await supabase
            .from('time')
            .insert([memberData]);

        if (error) throw error;

        showAlert('Sucesso', 'Membro do time adicionado com sucesso!');
        closeModal('addTeamMemberModal');
        clearTeamMemberForm();
        loadPainelData();
    } catch (error) {
        console.error('Erro ao salvar membro do time:', error);
        showAlert('Erro', 'Erro ao salvar membro do time. Tente novamente.');
    }
}

async function saveProject() {
    const projectData = {
        nome: document.getElementById('projectName').value,
        empresa: document.getElementById('projectCompany').value,
        especialista: document.getElementById('projectSpecialist').value,
        descricao: document.getElementById('projectDescription').value,
        status: document.getElementById('projectStatus').value,
        created_at: new Date().toISOString()
    };

    try {
        const { data, error } = await supabase
            .from('projetos')
            .insert([projectData]);

        if (error) throw error;

        showAlert('Sucesso', 'Projeto adicionado com sucesso!');
        closeModal('addProjectModal');
        clearProjectForm();
        loadPainelData();
    } catch (error) {
        console.error('Erro ao salvar projeto:', error);
        showAlert('Erro', 'Erro ao salvar projeto. Tente novamente.');
    }
}

async function saveVisit() {
    const visitData = {
        empresa: document.getElementById('visitCompany').value,
        endereco: document.getElementById('visitAddress').value,
        cidade: document.getElementById('visitCity').value,
        estado: document.getElementById('visitState').value,
        data_visita: document.getElementById('visitDate').value,
        objetivo: document.getElementById('visitPurpose').value,
        created_at: new Date().toISOString()
    };

    try {
        const { data, error } = await supabase
            .from('visitas_setor')
            .insert([visitData]);

        if (error) throw error;

        showAlert('Sucesso', 'Visita adicionada com sucesso!');
        closeModal('addVisitModal');
        clearVisitForm();
        loadPainelData();
    } catch (error) {
        console.error('Erro ao salvar visita:', error);
        showAlert('Erro', 'Erro ao salvar visita. Tente novamente.');
    }
}

async function saveEntrega() {
    // Mapeamento de meses para n√∫meros
    const monthMap = {
        'JAN': 1, 'FEV': 2, 'MAR': 3, 'ABR': 4, 'MAI': 5, 'JUN': 6,
        'JUL': 7, 'AGO': 8, 'SET': 9, 'OUT': 10, 'NOV': 11, 'DEZ': 12
    };

    const selectedMonth = document.getElementById('entregaMonth').value;
    const entregaData = {
        mes: monthMap[selectedMonth],
        marlos: parseInt(document.getElementById('entregaMarlos').value),
        larissa: parseInt(document.getElementById('entregaLarissa').value),
        renata: parseInt(document.getElementById('entregaRenata').value),
        victor: parseInt(document.getElementById('entregaVictor').value),
        ano: new Date().getFullYear(),
        created_at: new Date().toISOString()
    };

    // Calcular porcentagem do setor 
    entregaData.percentual_setor = Math.round((entregaData.marlos + entregaData.larissa + entregaData.renata + entregaData.victor) / 4);

    try {
       
        const { data: existingData, error: selectError } = await supabase
            .from('entregas')
            .select('id')
            .eq('mes', entregaData.mes)
            .eq('ano', entregaData.ano)
            .single();

        if (selectError && selectError.code !== 'PGRST116') {
            
            throw selectError;
        }

        let result;
        if (existingData) {
            
            result = await supabase
                .from('entregas')
                .update(entregaData)
                .eq('id', existingData.id);
        } else {
           
            result = await supabase
                .from('entregas')
                .insert([entregaData]);
        }

        if (result.error) throw result.error;

        showAlert('Sucesso', 'Entrega salva com sucesso!');
        closeModal('addEntregaModal');
        clearEntregaForm();
        loadPainelData();
    } catch (error) {
        console.error('Erro ao salvar entrega:', error);
        showAlert('Erro', 'Erro ao salvar entrega. Tente novamente.');
    }
}

// Fun√ß√µes para limpar formul√°rios
function clearTaskForm() {
    document.getElementById('taskType').value = 'treinamento';
    document.getElementById('taskTitle').value = '';
    document.getElementById('taskDescription').value = '';
    document.getElementById('taskResponsible').value = '';
    document.getElementById('taskDeadline').value = '';
}

function clearTeamMemberForm() {
    document.getElementById('memberName').value = '';
    document.getElementById('memberRole').value = 'Gerente';
    document.getElementById('memberEmail').value = '';
    document.getElementById('memberPhoto').value = '';
}

function clearProjectForm() {
    document.getElementById('projectName').value = '';
    document.getElementById('projectCompany').value = '';
    document.getElementById('projectSpecialist').value = '';
    document.getElementById('projectDescription').value = '';
    document.getElementById('projectStatus').value = 'Planejamento';
}

function clearVisitForm() {
    document.getElementById('visitCompany').value = '';
    document.getElementById('visitAddress').value = '';
    document.getElementById('visitCity').value = '';
    document.getElementById('visitState').value = '';
    document.getElementById('visitDate').value = '';
    document.getElementById('visitPurpose').value = '';
}

function clearEntregaForm() {
    document.getElementById('entregaMonth').value = 'JAN';
    document.getElementById('entregaMarlos').value = '';
    document.getElementById('entregaLarissa').value = '';
    document.getElementById('entregaRenata').value = '';
    document.getElementById('entregaVictor').value = '';
}

// Fun√ß√£o para carregar dados do painel
async function loadPainelData() {
    try {
        // Carregar time
        await loadTimeData();
        
        // Carregar projetos
        await loadProjectsData();
        
        // Carregar entregas
        await loadEntregasData();
        
        // Atualizar contadores de tarefas
        await updateTaskCounters();
        
    } catch (error) {
        console.error('Erro ao carregar dados do painel:', error);
    }
}

// Carregar dados do time
async function loadTimeData() {
    try {
        const { data, error } = await supabase
            .from('time')
            .select('*')
            .eq('ativo', true)
            .order('created_at', { ascending: false });

        if (error) throw error;

        const timeList = document.getElementById('timeList');
        
        if (data.length === 0) {
            timeList.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #666;">
                    <i class="fas fa-users" style="font-size: 2em; margin-bottom: 10px;"></i>
                    <p>Nenhum membro cadastrado</p>
                </div>
            `;
        } else {
            timeList.innerHTML = data.map(member => `
                <div style="display: flex; align-items: center; padding: 15px; background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="width: 50px; height: 50px; border-radius: 50%; background: #4fc3f7; display: flex; align-items: center; justify-content: center; margin-right: 15px; overflow: hidden;">
                        ${member.foto_url ? 
                            `<img src="${member.foto_url}" alt="${member.nome}" style="width: 100%; height: 100%; object-fit: cover;">` :
                            `<span style="color: white; font-weight: bold; font-size: 1.2em;">${member.nome.charAt(0).toUpperCase()}</span>`
                        }
                    </div>
                    <div style="flex: 1;">
                        <h4 style="margin: 0; color: #4fc3f7; font-size: 1.1em;">${member.nome}</h4>
                        <p style="margin: 0; color: #666; font-size: 0.9em;">${member.cargo}</p>
                    </div>
                </div>
            `).join('');
        }
    } catch (error) {
        console.error('Erro ao carregar dados do time:', error);
    }
}

// Carregar dados dos projetos
async function loadProjectsData() {
    try {
        const { data, error } = await supabase
            .from('projetos')
            .select('*')
            .eq('status', 'Em Andamento')
            .order('created_at', { ascending: false });

        if (error) throw error;

        const tableBody = document.getElementById('projetosTableBody');
        
        if (data.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                        Nenhum projeto em andamento
                    </td>
                </tr>
            `;
        } else {
            tableBody.innerHTML = data.map(project => `
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 15px; font-weight: bold; color: #333;">${project.nome}</td>
                    <td style="padding: 15px; color: #666;">${project.empresa}</td>
                    <td style="padding: 15px; color: #666;">${project.especialista}</td>
                    <td style="padding: 15px; text-align: center;">
                        <button onclick="excluirProjeto(${project.id})" style="background: #f44336; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer; font-size: 12px; transition: background 0.3s ease;" onmouseover="this.style.background='#d32f2f'" onmouseout="this.style.background='#f44336'">
                            <i class="fas fa-trash" style="margin-right: 4px;"></i>Excluir
                        </button>
                    </td>
                </tr>
            `).join('');
        }
    } catch (error) {
        console.error('Erro ao carregar dados dos projetos:', error);
    }
}

// Carregar dados das entregas
async function loadEntregasData() {
    try {
        const { data, error } = await supabase
            .from('entregas')
            .select('*')
            .eq('ano', new Date().getFullYear())
            .order('mes', { ascending: true });

        if (error) throw error;

        const tableBody = document.getElementById('entregasTableBody');
        
        // Meses padr√£o e mapeamento de n√∫meros para strings
        const meses = ['JAN', 'FEV', 'MAR', 'ABR', 'MAI', 'JUN', 'JUL', 'AGO', 'SET', 'OUT', 'NOV', 'DEZ'];
        const monthNumberMap = {
            1: 'JAN', 2: 'FEV', 3: 'MAR', 4: 'ABR', 5: 'MAI', 6: 'JUN',
            7: 'JUL', 8: 'AGO', 9: 'SET', 10: 'OUT', 11: 'NOV', 12: 'DEZ'
        };
        
        const entregasMap = {};
        data.forEach(entrega => {
            // Converter n√∫mero do m√™s para string
            const mesString = monthNumberMap[entrega.mes];
            if (mesString) {
                entregasMap[mesString] = entrega;
            }
        });

        tableBody.innerHTML = meses.map(mes => {
            const entrega = entregasMap[mes];
            if (entrega) {
                const percentualColor = entrega.percentual_setor >= 90 ? '#4caf50' : entrega.percentual_setor >= 70 ? '#ff9800' : '#f44336';
                return `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px; font-weight: bold;">${mes}</td>
                        <td style="padding: 10px; text-align: center;">${entrega.marlos}%</td>
                        <td style="padding: 10px; text-align: center;">${entrega.larissa}%</td>
                        <td style="padding: 10px; text-align: center;">${entrega.renata}%</td>
                        <td style="padding: 10px; text-align: center;">${entrega.victor}%</td>
                        <td style="padding: 10px; text-align: center; background: ${percentualColor}; color: white; font-weight: bold;">${entrega.percentual_setor}%</td>
                    </tr>
                `;
            } else {
                return `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px; font-weight: bold;">${mes}</td>
                        <td style="padding: 10px; text-align: center; color: #ccc;">-</td>
                        <td style="padding: 10px; text-align: center; color: #ccc;">-</td>
                        <td style="padding: 10px; text-align: center; color: #ccc;">-</td>
                        <td style="padding: 10px; text-align: center; color: #ccc;">-</td>
                        <td style="padding: 10px; text-align: center; color: #ccc;">-</td>
                    </tr>
                `;
            }
        }).join('');
    } catch (error) {
        console.error('Erro ao carregar dados das entregas:', error);
    }
}

// Atualizar contadores de tarefas
async function updateTaskCounters() {
    try {
        const { data, error } = await supabase
            .from('tarefas')
            .select('tipo');

        if (error) throw error;

        // Contar tarefas por tipo
        const counters = {
            treinamento: 0,
            migracao: 0,
            reuniao: 0,
            mvp: 0,
            homologacao: 0,
            acompanhamento: 0,
            implantacao: 0,
            projeto: 0,
            ticket: 0
        };

        data.forEach(tarefa => {
            if (counters.hasOwnProperty(tarefa.tipo)) {
                counters[tarefa.tipo]++;
            }
        });

       
    } catch (error) {
        console.error('Erro ao atualizar contadores de tarefas:', error);
    }
}



// Fun√ß√£o para inicializar o carregamento de contadores quando a p√°gina carrega
document.addEventListener('DOMContentLoaded', () => {
    carregarContadoresDeTarefas();
});

// Adicionar funcionalidade espec√≠fica para o painel do setor
document.addEventListener('DOMContentLoaded', function() {
    
    const painelButton = document.querySelector('button[onclick="showTab(\'painel-setor\')"]');
    if (painelButton) {
        painelButton.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Mostrar a aba do painel do setor
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            const painelSection = document.getElementById('painel-setor');
            if (painelSection) {
                painelSection.classList.add('active');
            }

            // Atualizar navega√ß√£o ativa
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            painelButton.parentElement.classList.add('active');
            
            // Carregar dados do painel
            setTimeout(() => {
                loadPainelData();
                initializeMap();
            }, 100);
        });
    }
});

// Vari√°vel global para o mapa
let visitasMap = null;

// Fun√ß√£o para inicializar o mapa real
async function initializeMap() {
    try {
        
        if (visitasMap) {
            visitasMap.remove(); 
        }
        
        visitasMap = L.map('mapContainer').setView([-14.2350, -51.9253], 4);

        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(visitasMap);

        
        await loadVisitasOnMap();
        
    } catch (error) {
        console.error('Erro ao inicializar mapa:', error);
        document.getElementById('mapContainer').innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; border-radius: 10px;">
                <div style="text-align: center; color: #666;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2em; margin-bottom: 10px;"></i>
                    <p>Erro ao carregar mapa</p>
                </div>
            </div>
        `;
    }
}

// Fun√ß√£o para carregar visitas no mapa
async function loadVisitasOnMap() {
    try {
        const { data: visitas, error } = await supabase
            .from('visitas_setor')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) throw error;

        // Limpar marcadores existentes
        visitasMap.eachLayer(function (layer) {
            if (layer instanceof L.Marker) {
                visitasMap.removeLayer(layer);
            }
        });

        let empresasCount = 0;

        // Adicionar marcadores para cada visita
        for (const visita of visitas) {
            let lat = visita.latitude;
            let lng = visita.longitude;

            
            if (!lat || !lng) {
                const coords = await geocodeAddress(`${visita.endereco}, ${visita.cidade}, ${visita.estado}, Brasil`);
                if (coords) {
                    lat = coords.lat;
                    lng = coords.lng;
                    
                    // Atualizar coordenadas no banco
                    await supabase
                        .from('visitas_setor')
                        .update({ latitude: lat, longitude: lng })
                        .eq('id', visita.id);
                }
            }

            if (lat && lng) {
                // Criar marcador personalizado
                const marker = L.marker([lat, lng]).addTo(visitasMap);
                
             
                const popupContent = `
                    <div style="min-width: 200px;">
                        <h4 style="margin: 0 0 10px 0; color: #4fc3f7;">${visita.empresa}</h4>
                        <p style="margin: 5px 0;"><strong>Cidade:</strong> ${visita.cidade}, ${visita.estado}</p>
                        <p style="margin: 5px 0;"><strong>Data:</strong> ${visita.data_visita ? new Date(visita.data_visita).toLocaleDateString('pt-BR') : 'N√£o informada'}</p>
                        <p style="margin: 5px 0;"><strong>Objetivo:</strong> ${visita.objetivo || 'N√£o informado'}</p>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                empresasCount++;
            }
        }

        // Atualizar contador de empresas
        const empresasCountElement = document.getElementById('empresasCount');
        if (empresasCountElement) {
            empresasCountElement.textContent = empresasCount.toString().padStart(2, '0');
        }

       
        if (empresasCount > 0) {
            const group = new L.featureGroup();
            visitasMap.eachLayer(function (layer) {
                if (layer instanceof L.Marker) {
                    group.addLayer(layer);
                }
            });
            if (group.getLayers().length > 0) {
                visitasMap.fitBounds(group.getBounds().pad(0.1));
            }
        }

    } catch (error) {
        console.error('Erro ao carregar visitas no mapa:', error);
    }
}


async function geocodeAddress(address) {
    try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`);
        const data = await response.json();
        
        if (data && data.length > 0) {
            return {
                lat: parseFloat(data[0].lat),
                lng: parseFloat(data[0].lon)
            };
        }
        return null;
    } catch (error) {
        console.error('Erro na geocodifica√ß√£o:', error);
        return null;
    }
}

//  fun√ß√£o saveVisit para atualizar o mapa
async function saveVisit() {
    const visitData = {
        empresa: document.getElementById('visitCompany').value,
        endereco: document.getElementById('visitAddress').value,
        cidade: document.getElementById('visitCity').value,
        estado: document.getElementById('visitState').value,
        data_visita: document.getElementById('visitDate').value,
        objetivo: document.getElementById('visitPurpose').value,
        created_at: new Date().toISOString()
    };

    try {
        const { data, error } = await supabase
            .from('visitas_setor')
            .insert([visitData]);

        if (error) throw error;

        showAlert('Sucesso', 'Visita adicionada com sucesso!');
        closeModal('addVisitModal');
        clearVisitForm();
        loadPainelData();

       
        if (visitasMap) {
            await loadVisitasOnMap();
        }

    } catch (error) {
        console.error('Erro ao salvar visita:', error);
        showAlert('Erro', 'Erro ao salvar visita. Tente novamente.');
    }
}

// Fun√ß√£o para excluir projeto
async function excluirProjeto(projetoId) {
    const confirmacao = await showConfirm(
        'Confirmar Exclus√£o',
        'Tem certeza que deseja excluir este projeto? Esta a√ß√£o n√£o pode ser desfeita.'
    );
    
    if (confirmacao) {
        try {
            const { error } = await supabase
                .from('projetos')
                .delete()
                .eq('id', projetoId);

            if (error) throw error;

            showAlert('Sucesso', 'Projeto exclu√≠do com sucesso!');
            
            // Recarregar a lista de projetos
            await loadProjectsData();
            
            // Atualizar contador de projetos em andamento
            const elemento = document.getElementById('projetos-count');
            if (elemento) {
                let valorAtual = parseInt(elemento.textContent);
                let novoValor = Math.max(0, valorAtual - 1);
                elemento.textContent = novoValor.toString().padStart(2, '0');
            }
            
        } catch (error) {
            console.error('Erro ao excluir projeto:', error);
            showAlert('Erro', 'Erro ao excluir projeto. Tente novamente.');
        }
    }
}
</script>

</body>>
    </script>
</body>
</html>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const releaseDateInput = document.getElementById('releaseDate');
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');
    releaseDateInput.value = `${year}-${month}-${day}`;
  });
</script>



<script>
  document.addEventListener("DOMContentLoaded", function() {
    const rvDateInput = document.getElementById("rvData");
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, "0");
    const day = String(today.getDate()).padStart(2, "0");
    rvDateInput.value = `${year}-${month}-${day}`;
  });
</script>



<script>
// Fun√ß√µes para abrir os modais
function enviarPorEmail() {
  // Preencher campos padr√£o do modal
  const empresa = document.getElementById('rvEmpresa').value || 'Empresa n√£o informada';
  document.getElementById('emailSubject').value = `Relat√≥rio de Visita - ${empresa}`;
  
  const defaultMessage = `Prezado(a),

Segue em anexo o Relat√≥rio de Visita da empresa ${empresa}.

Atenciosamente,
Equipe Tryvia`;
  
  document.getElementById('emailMessage').value = defaultMessage;
  
  // Mostrar modal
  document.getElementById('emailModal').classList.add('visible');
}

function enviarPorWhatsapp() {
  // Preencher mensagem padr√£o do modal
  const empresa = document.getElementById('rvEmpresa').value || 'Empresa n√£o informada';
  const data = document.getElementById('rvData').value || 'Data n√£o informada';
  const resumo = document.getElementById('rvResumo').value || 'Resumo n√£o informado';

  const defaultMessage = `*Relat√≥rio de Visita*

*Empresa:* ${empresa}
*Data:* ${data}
*Resumo:* ${resumo}

Gerado via Portal Tryvia.`;

  document.getElementById('whatsappMessage').value = defaultMessage;
  
  // Mostrar modal
  document.getElementById('whatsappModal').classList.add('visible');
}

// Fun√ß√µes para fechar os modais
function closeEmailModal() {
  document.getElementById('emailModal').classList.remove('visible');
}

function closeWhatsappModal() {
  document.getElementById('whatsappModal').classList.remove('visible');
}

// Fun√ß√£o para enviar relat√≥rio por e-mail (executada ap√≥s confirma√ß√£o no modal)
async function enviarRelatorioPorEmail() {
  const emails = document.getElementById('emailRecipients').value.trim();
  const subject = document.getElementById('emailSubject').value.trim();
  const message = document.getElementById('emailMessage').value.trim();
  
  if (!emails) {
    showAlert('Aten√ß√£o', 'Por favor, digite pelo menos um e-mail de destinat√°rio.');
    return;
  }
  
  if (!subject) {
    showAlert('Aten√ß√£o', 'Por favor, digite o assunto do e-mail.');
    return;
  }
  
  try {
    // Gerar PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Adicionar t√≠tulo
    doc.setTextColor(0, 230, 253);
    doc.setFontSize(22);
    doc.setFont(undefined, 'bold');
    doc.text('Relat√≥rio de Visita', 80, 30);

    // Adicionar conte√∫do
    let y = 45;
    doc.setDrawColor(0, 230, 253);
    doc.line(10, y - 5, 200, y - 5);

    const campos = [
      ['Empresa', 'rvEmpresa'],
      ['Data', 'rvData'],
      ['Gestor', 'rvGestor'],
      ['Analista', 'rvAnalista'],
      ['Servi√ßos Contratados', 'rvServicos'],
      ['Chamados Urgentes', 'rvChamados'],
      ['Local', 'rvLocal']
    ];

    doc.setFontSize(12);
    doc.setTextColor(0);
    campos.forEach(([label, id]) => {
      const el = document.getElementById(id);
      const valor = el ? el.value : '';
      const texto = doc.splitTextToSize(`${label}: ${valor}`, 180);
      doc.text(texto, 10, y);
      y += texto.length * 8;
      if (y > 270) {
        doc.addPage();
        y = 20;
      }
    });

    // Adicionar resumo em tabela
    const resumo = document.getElementById('rvResumo')?.value || '';
    const linhasResumo = resumo.split('\n').map(linha => [linha.trim()]);
    if (linhasResumo.length > 0) {
      doc.addPage();
      doc.setFontSize(14);
      doc.setTextColor(0, 230, 253);
      doc.text('Resumo da Visita (Tabela)', 10, 20);
      doc.autoTable({
        startY: 30,
        head: [['Conte√∫do']],
        body: linhasResumo,
        styles: { fontSize: 10, halign: 'left' },
        headStyles: { fillColor: [0, 230, 253], textColor: 20, fontStyle: 'bold' },
        alternateRowStyles: { fillColor: [245, 245, 245] },
        tableLineColor: [200, 200, 200],
        tableLineWidth: 0.1
      });
    }

    // Adicionar gr√°ficos
    const canvas1 = document.getElementById('chartVeiculos');
    if (canvas1) {
      const imgData1 = canvas1.toDataURL('image/png');
      doc.addPage();
      doc.setFontSize(14);
      doc.setTextColor(0, 230, 253);
      doc.text('Gr√°fico: Report de Ve√≠culos', 10, 20);
      doc.addImage(imgData1, 'PNG', 10, 30, 180, 90);
    }

    const canvas2 = document.getElementById('chartComparativo');
    if (canvas2) {
      const imgData2 = canvas2.toDataURL('image/png');
      doc.addPage();
      doc.setFontSize(14);
      doc.setTextColor(0, 230, 253);
      doc.text('Gr√°fico: Comparativo de Visitas por Empresa', 10, 20);
      doc.addImage(imgData2, 'PNG', 10, 30, 180, 90);
    }

 
    const pdfBase64 = doc.output('datauristring').split(',')[1];
    const empresa = document.getElementById('rvEmpresa').value || 'Empresa';
    const data = document.getElementById('rvData').value || new Date().toLocaleDateString('pt-BR');
    const fileName = `Relatorio_Visita_${empresa.replace(/\s+/g, '_')}_${data.replace(/\//g, '-')}.pdf`;
    
    let downloadLink = '';
    
    try {
      // Tentar enviar para o servidor de armazenamento
      const response = await fetch(`${PDF_SERVER_URL}/api/pdf/upload`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          filename: fileName,
          data: pdfBase64
        })
      });
      
      if (response.ok) {
        const result = await response.json();
        downloadLink = `${PDF_SERVER_URL}/api/pdf/download/${result.id}`;
        console.log('PDF enviado para servidor:', downloadLink);
      } else {
        throw new Error('Servidor n√£o dispon√≠vel');
      }
    } catch (error) {
      console.warn('Servidor de PDF n√£o dispon√≠vel, usando fallback local:', error);
      // Fallback: usar blob URL local (funciona apenas na sess√£o atual)
      const pdfBlob = doc.output('blob');
      downloadLink = URL.createObjectURL(pdfBlob);
    }
    
    // Processar lista de e-mails
    const emailList = emails.split(/[,\n]/).map(email => email.trim()).filter(email => email && email.includes('@'));
    
    if (emailList.length === 0) {
      showAlert('Erro', 'Nenhum e-mail v√°lido foi encontrado. Verifique os endere√ßos digitados.');
      return;
    }
    
    // Preparar corpo do e-mail em HTML com link clic√°vel
    const emailBodyHTML = `
    <div style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
      <p>${message || `Prezado(a),<br><br>Segue o Relat√≥rio de Visita gerado pelo portal.`}</p>
      
      <div style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h3 style="color: #00e6fd; margin-top: 0;">üìÑ Relat√≥rio de Visita</h3>
        <p><strong>Empresa:</strong> ${empresa}</p>
        <p><strong>Data:</strong> ${data}</p>
      </div>
      
      <div style="text-align: center; margin: 30px 0;">
        <h3 style="color: #00e6fd;">üîó Download do PDF</h3>
    <a href="${downloadLink}"
   style="display:inline-block;
          background-color:#00e6fd;
          color:white;
          padding:15px 30px;
          text-decoration:none;
          border-radius:5px;
          font-weight:bold;">
  üì• CLIQUE AQUI PARA BAIXAR O PDF
</a></div>
      
      <p style="font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 15px; margin-top: 30px;">
        Gerado automaticamente pelo Portal Tryvia
      </p>
    </div>`;

    // Vers√£o em texto simples como fallback
    const emailBodyText = `${message || `Prezado(a),

Segue o Relat√≥rio de Visita gerado pelo portal.`}

üìÑ Relat√≥rio de Visita
Empresa: ${empresa}
Data: ${data}

üîó Para baixar o PDF, copie e cole o link abaixo no seu navegador:
${downloadLink}

---
Gerado automaticamente pelo Portal Tryvia`;

    // Enviar para cada email individualmente
    let successCount = 0;
    let errorCount = 0;
    
    for (const email of emailList) {
      try {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || email.trim() === '' || !emailRegex.test(email.trim())) {
          console.error(`Email inv√°lido: "${email}"`);
          errorCount++;
          continue;
        }
        
        const cleanEmail = email.trim();
        console.log(`Tentando enviar para: "${cleanEmail}"`);
        
        const templateParams = {
          email: cleanEmail,
          subject: subject,
          message_html: emailBodyHTML,  // Vers√£o HTML com link clic√°vel
          message_text: emailBodyText   // Vers√£o texto como fallback
        };

        const response = await emailjs.send('service_g3ln0jh', 'template_waamyv4', templateParams);
        
        if (response.status === 200) {
          successCount++;
          console.log(`Email enviado com sucesso para: ${cleanEmail}`);
        } else {
          errorCount++;
          console.error(`Erro ao enviar para ${email}:`, response);
        }
      } catch (error) {
        errorCount++;
        console.error(`Erro ao enviar para ${email}:`, error);
      }
    }
    
    closeEmailModal();
    
    if (successCount > 0) {
      if (errorCount === 0) {
        showAlert('Sucesso', `‚úÖ E-mail enviado com sucesso para ${successCount} destinat√°rio(s)! O link para download do PDF est√° clic√°vel no e-mail e funcionar√° permanentemente.`);
      } else {
        showAlert('Parcial', `E-mail enviado para ${successCount} de ${emailList.length} destinat√°rios. ${errorCount} falharam.`);
      }
    } else {
      showAlert('Erro', 'Falha ao enviar e-mail para todos os destinat√°rios. Verifique os endere√ßos e tente novamente.');
    }
    
  } catch (error) {
    console.error('Erro ao enviar por e-mail:', error);
    closeEmailModal();
    showAlert('Erro', 'Erro ao enviar e-mail. Verifique sua conex√£o e tente novamente.');
  }
}
// Fun√ß√£o para enviar relat√≥rio por WhatsApp (executada ap√≥s confirma√ß√£o no modal)
function enviarRelatorioPorWhatsapp() {
  const number = document.getElementById('whatsappNumber').value.trim();
  const message = document.getElementById('whatsappMessage').value.trim();
  
  if (!number) {
    showAlert('Aten√ß√£o', 'Por favor, digite o n√∫mero do WhatsApp.');
    return;
  }
  
  if (!message) {
    showAlert('Aten√ß√£o', 'Por favor, digite a mensagem.');
    return;
  }
  
  try {
    // Limpar e formatar n√∫mero
    const cleanNumber = number.replace(/\D/g, '');
    let formattedNumber = cleanNumber;
    
    // Adicionar c√≥digo do pa√≠s se n√£o tiver
    if (cleanNumber.length === 11 && cleanNumber.startsWith('11')) {
      formattedNumber = '55' + cleanNumber;
    } else if (cleanNumber.length === 10) {
      formattedNumber = '5511' + cleanNumber;
    } else if (!cleanNumber.startsWith('55')) {
      formattedNumber = '55' + cleanNumber;
    }
    
    // Gerar PDF para download
    gerarPDFVisita();
    
    // Abrir WhatsApp
    const whatsappUrl = `https://api.whatsapp.com/send?phone=${formattedNumber}&text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
    
    closeWhatsappModal();
    showAlert('Sucesso', 'WhatsApp aberto com a mensagem. O PDF foi gerado para voc√™ anexar manualmente na conversa.');
    
  } catch (error) {
    console.error('Erro ao enviar por WhatsApp:', error);
    showAlert('Erro', 'Erro ao abrir WhatsApp. Verifique o n√∫mero e tente novamente.');
  }
}

// Fechar modais ao clicar fora deles
document.addEventListener('click', function(event) {
  const emailModal = document.getElementById('emailModal');
  const whatsappModal = document.getElementById('whatsappModal');
  
  if (event.target === emailModal) {
    closeEmailModal();
  }
  
  if (event.target === whatsappModal) {
    closeWhatsappModal();
  }
});

// Fechar modais com a tecla ESC
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeEmailModal();
    closeWhatsappModal();
  }
});
</script>



<style>
.client-status-text.inactive {
    color: #f44336 !important; /* Vermelho */
}
</style>

