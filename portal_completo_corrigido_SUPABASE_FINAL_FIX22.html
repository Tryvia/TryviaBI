<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal</title>
    

    <style>
        /* CSS */
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #1976d2;
            --accent-color: #00b0ff;
            --hover-color: #0091ea;
            --dark-bg: #0a2b59;
            --error-color: #f44336;
            --success-color: #4caf50;
            --text-color: #ffffff;
            --text-dark: #333333;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(145deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-color);
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: rgba(var(--primary-color-rgb), 0.9); /* Using RGB from primary-color */
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo-container {
            margin-bottom: 20px;
            padding-bottom: 0px;
            border-bottom: none;
            width: 100%;
            text-align: center;
        }

        .your-custom-logo {
            width: 180px;
            height: auto;
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }


        .nav-list {
            list-style: none;
            width: 100%;
        }

        .nav-item {
            margin: 10px 0;
            width: 100%;
        }

        .nav-item a, .nav-item button {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(var(--text-color-rgb), 0.8); /* Using RGB from text-color */
            text-decoration: none;
            font-size: 1.1em;
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
            width: 100%;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
        }

        .nav-item a:hover, .nav-item button:hover, .nav-item.active a, .nav-item.active button {
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--text-color);
            transform: translateX(5px);
        }

        .nav-item i {
            margin-right: 15px;
            font-size: 1.3em;
        }

        .main-content {
            margin-left: 250px;
            padding: 30px;
            flex-grow: 1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .header h1 {
            font-size: 2.2em;
            color: var(--text-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .profile-info {
            display: flex;
            align-items: center;
        }

        .profile-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid var(--accent-color);
        }

        .profile-info span {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--text-color);
        }

        .content-section {
            display: none;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            min-height: 70vh;
        }

        .content-section.active {
            display: block;
        }

        /* Forms */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            background-color: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: bold;
            color: rgba(var(--text-color-rgb), 0.9); /* Using RGB from text-color */
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group input[type="url"],
        .form-group select {
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background-color: rgba(0, 0, 0, 0.3);
            color: var(--text-color);
            font-size: 1em;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        .form-group input::placeholder {
            color: #999; /* Existing color */
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--accent-color);
            background-color: rgba(0, 0, 0, 0.4);
            outline: none;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 10px;
        }

        .btn-primary {
            background-color: var(--success-color);
            color: var(--text-color);
            box-shadow: 0 2px 5px rgba(0,128,0,0.5);
        }

        .btn-primary:hover {
            background-color: #45a049; /* Slightly darker green */
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
            box-shadow: 0 2px 5px rgba(0,0,128,0.5);
        }

        .btn-secondary:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s ease, background-color 0.3s ease;
            margin-top: 5px;
        }

        .upload-area:hover {
            border-color: var(--accent-color);
            background-color: rgba(255, 255, 255, 0.05);
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 10px;
            color: rgba(var(--text-color-rgb), 0.8); /* Using RGB from text-color */
        }

        .upload-area p {
            color: rgba(var(--text-color-rgb), 0.7); /* Using RGB from text-color */
            font-size: 1.1em;
        }

        /* Grids and Cards */
        .documents-grid, .clients-grid, .dashboards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            min-height: 200px;
        }

        .document-card, .client-card, .dashboard-card {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .document-card:hover, .client-card:hover, .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .document-header, .client-card-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .document-type, .client-status-card {
            background-color: #FFC107; /* Amber - no direct variable match, keep for now or find alternative */
            color: var(--text-dark);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .client-status-card {
            background-color: var(--success-color);
            color: var(--text-color);
        }

        .delete-btn, .delete-btn-card {
            background: none;
            border: none;
            color: rgba(var(--text-color-rgb), 0.7); /* Using RGB from text-color */
            font-size: 1.2em;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .delete-btn:hover, .delete-btn-card:hover {
            color: var(--error-color);
        }

        .document-title, .client-name {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .document-author, .client-email, .client-phone {
            font-size: 0.95em;
            color: rgba(var(--text-color-rgb), 0.7); /* Using RGB from text-color */
            margin-bottom: 10px;
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px 20px;
            color: rgba(var(--text-color-rgb), 0.6); /* Using RGB from text-color */
            font-size: 1.2em;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: rgba(var(--text-color-rgb), 0.4); /* Using RGB from text-color */
        }

        /* Clientes Tab Specifics */
        .client-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .client-tab-button {
            padding: 15px 25px;
            border: none;
            background: none;
            color: rgba(var(--text-color-rgb), 0.7); /* Using RGB from text-color */
            font-size: 1.1em;
            cursor: pointer;
            transition: color 0.3s ease, border-bottom 0.3s ease;
            margin-right: 15px;
            border-bottom: 2px solid transparent;
        }

        .client-tab-button.active {
            color: var(--text-color);
            border-bottom-color: var(--accent-color);
            font-weight: bold;
        }

        .client-tab-button:hover {
            color: var(--text-color);
        }

        .client-tab-content {
            display: none;
        }
        
        #add-client .upload-area {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 150px;
            cursor: pointer;
        }

        #add-client .upload-area:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        #add-client .logo-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        /* Products List */
        .products-section {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .products-section h4 {
            margin-bottom: 15px;
            color: var(--text-color);
        }
        .products-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .product-item {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-color);
            font-size: 0.9em;
            white-space: nowrap;
        }
        .product-item .delete-btn {
            font-size: 1em;
            padding: 3px 6px;
            background-color: rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            line-height: 1;
            color: var(--text-color);
            transition: background-color 0.2s ease;
        }
        .product-item .delete-btn:hover {
            background-color: rgba(255, 0, 0, 0.8);
        }
        #productsList {
            margin-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 15px;
            display: none;
        }

        /* Client Card Vertical (for view-clients tab) */
        .clients-grid {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }
        .client-card-vertical {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
        }

        .client-card-vertical:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .client-card-top {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .delete-btn-card {
            background-color: rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            color: var(--text-color);
            font-size: 18px;
        }

        .delete-btn-card:hover {
            background-color: rgba(255, 0, 0, 0.8);
            transform: scale(1.1);
        }


        .client-logo-vertical {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .logo-preview-vertical {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .add-logo-text {
            font-size: 0.8em;
            color: rgba(var(--text-color-rgb), 0.6); /* Using RGB from text-color */
            margin-bottom: 10px;
        }

        .client-name-vertical {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-color);
            word-break: break-word;
        }

        .client-status-text {
            font-size: 0.9em;
            color: var(--success-color);
            margin-bottom: 15px;
        }

        .products-info-vertical {
            width: 100%;
            text-align: left;
            margin-bottom: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 15px;
        }

        .btn-vertical {
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 90%;
            margin-bottom: 10px;
        }

        .btn-vertical:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        .btn-vertical.edit {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .btn-vertical.edit:hover {
            background-color: var(--hover-color);
        }

        /* Novas Regras para Dashboard */
        .dashboard-card {
            padding: 25px;
            background-color: rgba(0, 0, 0, 0.4);
            text-align: center;
            justify-content: flex-start;
        }

        .dashboard-card .client-logo-vertical {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px auto;
        }

        .dashboard-card h3 {
            font-size: 1.6em;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .btn-bi {
            background-color: var(--primary-color); /* Adjusted to primary-color as a suitable deep purple alternative */
            color: var(--text-color);
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: auto;
        }

        .btn-bi:hover {
            background-color: var(--secondary-color); /* Adjusted to secondary-color for hover */
            transform: translateY(-2px);
        }


        /* Responsividade */
        @media (max-width: 992px) {
            .sidebar {
                width: 200px;
            }
            .main-content {
                margin-left: 200px;
                padding: 20px;
            }
            .header h1 {
                font-size: 1.8em;
            }
            .nav-item a, .nav-item button {
                font-size: 1em;
                padding: 10px 15px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: static;
                width: 100%;
                height: auto;
                flex-direction: row;
                justify-content: center;
                padding: 15px;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }
            .logo-container {
                display: block;
                width: auto;
                text-align: center;
                margin-bottom: 15px;
            }
            .sidebar h2 {
                display: none;
            }
            .nav-list {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            .nav-item {
                margin: 5px;
                width: auto;
            }
            .nav-item a, .nav-item button {
                font-size: 0.9em;
                padding: 8px 12px;
            }
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
            .header {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }
            .header h1 {
                margin-bottom: 10px;
            }
            .form-row {
                flex-direction: column;
            }
            .documents-grid, .clients-grid, .dashboards-grid {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            .client-tabs {
                flex-direction: column;
            }
            .client-tab-button {
                margin-bottom: 10px;
                margin-right: 0;
                text-align: center;
            }
        }

    </style>
<style>
/* Ajustes para uniformizar fundo da aba Homologacao */
#homologacao,
#homologacao .form-group,
#homologacao .upload-area,
#homologacao .tab-content,
#homologacao .header,
#homologacao .filters-section,
#homologacao .form-row {
    background-color: rgba(0, 0, 0, 0.2);
    color: var(--text-color);
    border-radius: 8px;
    padding: 10px;
}

#homologacao input,
#homologacao select,
#homologacao textarea {
    background-color: rgba(0, 0, 0, 0.3);
    color: var(--text-color);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    padding: 10px;
}

#homologacao input::placeholder,
#homologacao textarea::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

#homologacao .upload-area:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

#homologacao .tab-button {
    background: none;
    color: var(--text-color);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 10px 20px;
    border-radius: 6px;
    margin-right: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#homologacao .tab-button.active,
#homologacao .tab-button:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
</style>


<style>
/* Estilo para os cards de homologações */
#homologacoesGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.homologacao-card {
    background-color: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.homologacao-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.homologacao-card h4 {
    margin-bottom: 10px;
    font-size: 1.2em;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 5px;
}

.homologacao-card p {
    font-size: 0.95em;
    margin-bottom: 6px;
    color: rgba(255, 255, 255, 0.85);
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
<div class="sidebar">
<div class="logo-container">
<img alt="Sua Logo" class="your-custom-logo" src="logo1.png"/>
</div>
<ul class="nav-list">
<li class="nav-item">
<button onclick="showTab('dashboard')"><i class="fas fa-chart-line"></i> Dashboards</button>
</li>
<li class="nav-item">
<button onclick="showTab('clients')"><i class="fas fa-users"></i> Clientes</button>
<li class="nav-item">
<button onclick="window.location.href='https://tryvia.github.io/TryviaBI/mapa.html'"><i class="fas fa-calendar-check"></i> Visitas</button>
<li class="nav-item active">
<button onclick="showTab('documents')"><i class="fas fa-file-alt"></i> Time de Implantação</button>
</li>
<li class="nav-item">
<a href="#"><i class="fas fa-cog"></i> Configurações</a>
</li>
<li class="nav-item">
<a href="https://tryvia.github.io/TryviaBI/tryvia_bi_login%20(1).html"><i class="fas fa-sign-out-alt"></i> Sair</a>
</li>
</li></li><li class="nav-item"><button onclick="showTab('homologacao')"><i class="fas fa-clipboard-check"></i> Homologação</button></li></ul>
</div>
<div class="main-content">
<header class="header">
<h1>Portal - Time de Implantação</h1>
<div class="profile-info">
<img alt="Profile Picture" src="tryvia.png"/>
<span>Usuário TRYVIA</span>
</div>
</header>
<div class="content-section active" id="documents">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Adicionar Novo Documento de Implantação</h3>
<div class="form-row">
<div class="form-group">
<label for="documentTitle">Título</label>
<input id="documentTitle" placeholder="Título do documento..." type="text"/>
</div>
<div class="form-group">
<label for="documentAuthor">Autor</label>
<input id="documentAuthor" placeholder="Nome do autor..." type="text"/>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="documentType">Tipo</label>
<select id="documentType">
<option value="">Selecione o tipo</option>
<option value="manual">Manual</option>
<option value="guia">Guia</option>
<option value="checklist">Checklist</option>
<option value="template">Template</option>
<option value="outro">Outro</option>
</select>
</div>
<div class="form-group" style="flex: 1;">
<label for="documentFile">Arquivo</label>
<div class="upload-area" onclick="document.getElementById('documentFile').click()">
<div class="upload-icon">📄</div>
<p>Arraste e solte ou clique para selecionar um arquivo</p>
<input id="documentFile" style="display: none;" type="file"/>
</div>
</div>
</div>
<button class="btn-primary" onclick="addDocument()">Adicionar Documento</button>
</div>
<h3 style="margin-top: 40px; margin-bottom: 20px;">Documentos Existentes</h3>
<div class="documents-grid" id="documentsList">
<div class="empty-state">
<div class="empty-state-icon">📁</div>
<p>Nenhum documento encontrado</p>
<p>Adicione documentos para começar</p>
</div>
</div>
</div>
<div class="content-section" id="clients">
<div class="client-tabs">
<button class="client-tab-button active" onclick="showClientTab('view-clients')">Visualizar Clientes</button>
<button class="client-tab-button" onclick="showClientTab('add-client')">Adicionar Cliente</button>
<button class="client-tab-button" id="editClientTabButton" onclick="showClientTab('edit-client-tab')" style="display:none;">Editar Cliente</button>
</div>
<div class="client-tab-content" id="view-clients" style="display: block;">
<h3 style="margin-bottom: 20px;">Lista de Clientes</h3>
<div class="clients-grid" id="clientsList">
<div class="empty-state">
<div class="empty-state-icon">👥</div>
<p>Nenhum cliente encontrado</p>
<p>Adicione clientes para começar</p>
</div>
</div>
</div>
<div class="client-tab-content" id="add-client" style="display: none;">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Adicionar Novo Cliente</h3>
<div class="form-row">
<div class="form-group" style="flex: 0 0 150px; text-align: center;">
<label>Logo do Cliente</label>
<div class="upload-area" id="logoPreview" onclick="document.getElementById('clientLogo').click()">
<div style="font-size: 48px; margin-bottom: 10px;">📷</div>
<p>Clique para adicionar logo</p>
</div>
<input id="clientLogo" onchange="previewLogo(this)" style="display: none;" type="file"/>
</div>
<div class="form-group" style="flex: 2;">
<label for="clientName">Nome do Cliente</label>
<input id="clientName" placeholder="Nome completo ou da empresa..." type="text"/>
<label for="clientEmail" style="margin-top: 15px;">Email</label>
<input id="clientEmail" placeholder="email@exemplo.com" type="email"/>
<label for="clientPhone" style="margin-top: 15px;">Telefone</label>
<input id="clientPhone" placeholder="(XX) XXXXX-XXXX" type="tel"/>
<label for="clientBiLink" style="margin-top: 15px;">Link do Dashboard BI</label>
<input id="clientBiLink" placeholder="https://app.powerbi.com/dashboard/..." type="url"/>
</div>
</div>
<div class="products-section">
<h4>Produtos / Serviços Associados</h4>
<div class="form-row">
<div class="form-group">
<label for="productName">Nome do Produto/Serviço</label>
<input id="productName" placeholder="Ex: Software SaaS, Consultoria..." type="text"/>
</div>
<div class="form-group" style="flex: 0 0 100px;">
<label for="productQuantity">Quantidade</label>
<input id="productQuantity" min="1" type="number" value="1"/>
</div>
<div class="form-group" style="flex: 0 0 120px; display: flex; align-items: flex-end;">
<button class="btn-secondary" onclick="addProduct()">Adicionar</button>
</div>
</div>
<div id="productsList">
<div class="products-grid" id="productsContainer">
<p style="color: rgba(255,255,255,0.7);">Nenhum produto adicionado ainda.</p>
</div>
</div>
</div>
<button class="btn-primary" onclick="saveClient()" style="margin-top: 30px;">Salvar Cliente</button>
</div>
</div>
<div class="client-tab-content" id="edit-client-tab" style="display: none;">
<div class="form-container">
<h3 style="margin-bottom: 20px;">Editar Cliente</h3>
<input id="editClientId" type="hidden"/>
<div class="form-row">
<div class="form-group" style="flex: 0 0 150px; text-align: center;">
<label>Logo do Cliente</label>
<div class="upload-area" id="editLogoPreview" onclick="document.getElementById('editClientLogo').click()">
<div style="font-size: 48px; margin-bottom: 10px;">📷</div>
<p>Clique para adicionar logo</p>
</div>
<input id="editClientLogo" onchange="previewEditLogo(this)" style="display: none;" type="file"/>
</div>
<div class="form-group" style="flex: 2;">
<label for="editClientName">Nome do Cliente</label>
<input id="editClientName" placeholder="Nome completo ou da empresa..." type="text"/>
<label for="editClientEmail" style="margin-top: 15px;">Email</label>
<input id="editClientEmail" placeholder="email@exemplo.com" type="email"/>
<label for="editClientPhone" style="margin-top: 15px;">Telefone</label>
<input id="editClientPhone" placeholder="(XX) XXXXX-XXXX" type="tel"/>
<label for="editClientBiLink" style="margin-top: 15px;">Link do Dashboard BI</label>
<input id="editClientBiLink" placeholder="https://app.powerbi.com/dashboard/..." type="url"/>
</div>
</div>
<div class="products-section">
<h4>Produtos / Serviços Associados</h4>
<div class="form-row">
<div class="form-group">
<label for="editProductName">Nome do Produto/Serviço</label>
<input id="editProductName" placeholder="Ex: Software SaaS, Consultoria..." type="text"/>
</div>
<div class="form-group" style="flex: 0 0 100px;">
<label for="editProductQuantity">Quantidade</label>
<input id="editProductQuantity" min="1" type="number" value="1"/>
</div>
<div class="form-group" style="flex: 0 0 120px; display: flex; align-items: flex-end;">
<button class="btn-secondary" onclick="addEditProduct()">Adicionar</button>
</div>
</div>
<div id="editProductsList">
<div class="products-grid" id="editProductsContainer">
<p style="color: rgba(255,255,255,0.7);">Nenhum produto adicionado ainda.</p>
</div>
</div>
</div>
<button class="btn-primary" onclick="updateClient()" style="margin-top: 30px;">Atualizar Cliente</button>
<button class="btn-secondary" onclick="showClientTab('view-clients')" style="margin-top: 30px; margin-left: 10px;">Cancelar</button>
</div>
</div>
<div class="client-tab-content" id="view-client-documents" style="display:none;">
</div>
</div>
<div class="content-section" id="dashboard">
<h3 style="margin-bottom: 20px;">Dashboards de Clientes</h3>
<div class="dashboards-grid" id="dashboardsList">
<div class="empty-state">
<div class="empty-state-icon">📊</div>
<p>Nenhum Dashboard de cliente encontrado.</p>
<p>Adicione clientes com links de BI para visualizá-los aqui.</p>
</div>
</div>
</div>
<div class="content-section" id="homologacao"><div class="main-container">
<div class="header">
<h1>Gerenciador de Homologações</h1>
<p>Organize seus registros de homologação de forma eficiente.</p>
</div>
<div class="tabs">
<button class="tab-button active" onclick="openTab(event, 'formulario')">
                📝 Formulário de Registro
            </button>
<button class="tab-button" onclick="openTab(event, 'listaHomologacoes')">
                📚 Homologações Registradas
            </button>
</div>
<div class="tab-content active" id="formulario">
<form id="homologacaoForm">
<div class="form-row">
<div class="form-group">
<label for="especialista">👨‍💻 Especialista Responsável</label>
<input id="especialista" name="especialista" required="" type="text"/>
</div>
<div class="form-group">
<label for="versao">📋 Versão</label>
<input id="versao" name="versao" placeholder="Ex: v1.2.3" required="" type="text"/>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="dataLiberacao">📅 Data de Liberação</label>
<input id="dataLiberacao" name="dataLiberacao" required="" type="date"/>
</div>
<div class="form-group">
<label for="dataHomologacao">✅ Data de Homologação</label>
<input id="dataHomologacao" name="dataHomologacao" type="date"/>
</div>
</div>
<div class="form-group">
<label for="sistema">🖥️ Sistema</label>
<select id="sistema" name="sistema" required="">
<option value="">Selecione o sistema</option>
<option value="Sistema Web">Sistema Web</option>
<option value="Sistema Mobile">Sistema Mobile</option>
<option value="API Rest">API Rest</option>
<option value="Sistema Desktop">Sistema Desktop</option>
<option value="Microserviço">Microserviço</option>
<option value="Outro">Outro</option>
</select>
</div>
<div class="form-group">
<label for="observacao">📝 Observações</label>
<textarea id="observacao" name="observacao" placeholder="Descreva detalhes da homologação, testes realizados, bugs encontrados, etc."></textarea>
</div>
<div class="form-group">
<label>📁 Arquivos de Homologação</label>
<div class="upload-area" id="uploadArea">
<div class="upload-icon">☁️</div>
<div class="upload-text">Clique aqui ou arraste arquivos</div>
<div class="upload-subtext">PDF, DOC, XLS, IMG até 10MB cada</div>
</div>
<input accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif" id="fileInput" multiple="" type="file"/>
<div class="file-list" id="fileList"></div>
</div>
<div class="btn-group">
<button class="btn btn-secondary" onclick="limparFormulario()" type="button">
                        🔄 Limpar
                    </button>
<button class="btn btn-primary" type="submit">
                        💾 Salvar Homologação
                    </button>
</div>
</form>
</div>
<div class="tab-content" id="listaHomologacoes">
<div class="filters-section">
<div class="form-row">
<div class="form-group">
<label for="filtroSistema">🔍 Filtrar por Sistema</label>
<select id="filtroSistema" onchange="filtrarHomologacoes()">
<option value="">Todos os sistemas</option>
<option value="Sistema Web">Sistema Web</option>
<option value="Sistema Mobile">Sistema Mobile</option>
<option value="API Rest">API Rest</option>
<option value="Sistema Desktop">Sistema Desktop</option>
<option value="Microserviço">Microserviço</option>
<option value="Outro">Outro</option>
</select>
</div>
<div class="form-group">
<label for="filtroEspecialista">👨‍💻 Filtrar por Especialista</label>
<input id="filtroEspecialista" onkeyup="filtrarHomologacoes()" placeholder="Nome do especialista" type="text"/>
</div>
</div>
</div>
<div class="homologacoes-grid" id="homologacoesGrid">
</div>
<div class="empty-state" id="emptyState" style="display: none;">
<div>📋</div>
<h3>Nenhuma homologação encontrada</h3>
<p>Registre sua primeira homologação usando o formulário na aba "Formulário de Registro".</p>
</div>
</div>
</div></div></div>





<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2">

async function filtrarHomologacoes() {
    const sistemaFiltro = document.getElementById('filtroSistema').value.toLowerCase();
    const especialistaFiltro = document.getElementById('filtroEspecialista').value.toLowerCase();

    const { data, error } = await supabase
        .from('homologacoes')
        .select('*')
        .order('data_liberacao', { ascending: false });

    if (error || !data) return;

    const filtradas = data.filter(h =>
        (!sistemaFiltro || h.sistema.toLowerCase().includes(sistemaFiltro)) &&
        (!especialistaFiltro || h.especialista.toLowerCase().includes(especialistaFiltro))
    );

    const grid = document.getElementById('homologacoesGrid');
    const empty = document.getElementById('emptyState');

    if (filtradas.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'flex';
    } else {
        empty.style.display = 'none';
        grid.innerHTML = filtradas.map(h => {
            let html = '';
            html += '<div class="homologacao-card">';
            html += '<h4>Versão: ' + h.versao + '</h4>';
            html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
            html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
            html += '<p><strong>Liberação:</strong> ' + h.data_liberacao + '</p>';
            html += '<p><strong>Homologação:</strong> ' + (h.data_homologacao || '-') + '</p>';
            html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
            if (h.arquivos && h.arquivos.length) {
                html += '<p><strong>Arquivos:</strong><br>' + h.arquivos.map(function(a, i) {
        return '<a href="' + a + '" download target="_blank">📄 Arquivo ' + (i + 1) + '</a>';
    }).join('<br>') + '</p>';
            }
            html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '</div>';
            return html;
        }).join('');
    }
}

</script>
<script>
// --- INTEGRAÇÃO ABA DE HOMOLOGAÇÃO ---
document.getElementById('homologacaoForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const especialista = document.getElementById('especialista').value;
    const versao = document.getElementById('versao').value;
    const dataLiberacao = document.getElementById('dataLiberacao').value;
    const dataHomologacao = document.getElementById('dataHomologacao').value;
    const sistema = document.getElementById('sistema').value;
    const observacao = document.getElementById('observacao').value;
    const arquivosInput = document.getElementById('fileInput');

    let arquivos = [];

    for (let file of arquivosInput.files) {
        const path = `homologacoes/${Date.now()}_${file.name}`;
        const { data, error } = await supabase.storage.from('homologacaoarquivos').upload(path, file);
        if (error) {
            alert(`Erro ao enviar o arquivo ${file.name}`);
            return;
        }
        const { data: publicData } = supabase.storage.from('homologacaoarquivos').getPublicUrl(path);
        arquivos.push(publicData.publicUrl);
    }

    const { error: insertError } = await supabase.from('homologacoes').insert([{
        especialista,
        versao,
        data_liberacao: dataLiberacao,
        data_homologacao: dataHomologacao || null,
        sistema,
        observacao,
        arquivos
    }]);

    if (insertError) {
        alert('Erro ao salvar homologação!');
        console.error(insertError);
    } else {
        alert('Homologação salva com sucesso!');
        document.getElementById('homologacaoForm').reset();
        document.getElementById('fileList').innerHTML = '';
        document.getElementById('fileInput').value = '';
        fetchAndRenderHomologacoes();
    }
});

async function fetchAndRenderHomologacoes() {
    const { data, error } = await supabase.from('homologacoes').select('*').order('data_liberacao', { ascending: false });

    const grid = document.getElementById('homologacoesGrid');
    const empty = document.getElementById('emptyState');

    if (error || !data || data.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'flex';
        return;
    }

    empty.style.display = 'none';
    grid.innerHTML = data.map(h => `
        <div class="homologacao-card">
            <h4>Versão: \${h.versao}</h4>
            <p><strong>Especialista:</strong> \${h.especialista}</p>
            <p><strong>Sistema:</strong> \${h.sistema}</p>
            <p><strong>Liberação:</strong> \${h.data_liberacao}</p>
            <p><strong>Homologação:</strong> \${h.data_homologacao || '-'}</p>
            <p><strong>Obs:</strong> \${h.observacao || '-'}</p>
            \${h.arquivos && h.arquivos.length ? `<p><strong>Arquivos:</strong><br>\${h.arquivos.map(a => `<a href="\${a}" target="_blank">📄</a>`).join(' ')}</p>` : ''}
        </div>
    `).join('');
}



async function filtrarHomologacoes() {
    const sistemaFiltro = document.getElementById('filtroSistema').value.toLowerCase();
    const especialistaFiltro = document.getElementById('filtroEspecialista').value.toLowerCase();

    const { data, error } = await supabase
        .from('homologacoes')
        .select('*')
        .order('data_liberacao', { ascending: false });

    if (error || !data) return;

    const filtradas = data.filter(h =>
        (!sistemaFiltro || h.sistema.toLowerCase().includes(sistemaFiltro)) &&
        (!especialistaFiltro || h.especialista.toLowerCase().includes(especialistaFiltro))
    );

    const grid = document.getElementById('homologacoesGrid');
    const empty = document.getElementById('emptyState');

    if (filtradas.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'flex';
    } else {
        empty.style.display = 'none';
        grid.innerHTML = filtradas.map(h => {
            let html = '';
            html += '<div class="homologacao-card">';
            html += '<h4>Versão: ' + h.versao + '</h4>';
            html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
            html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
            html += '<p><strong>Liberação:</strong> ' + h.data_liberacao + '</p>';
            html += '<p><strong>Homologação:</strong> ' + (h.data_homologacao || '-') + '</p>';
            html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
            if (h.arquivos && h.arquivos.length) {
                html += '<p><strong>Arquivos:</strong><br>' + h.arquivos.map(function(a, i) {
        return '<a href="' + a + '" download target="_blank">📄 Arquivo ' + (i + 1) + '</a>';
    }).join('<br>') + '</p>';
            }
            html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '</div>';
            return html;
        }).join('');
    }
}

</script>
<script>
        // Inicialize o Supabase Client globalmente
        const SUPABASE_URL = 'https://mzjdmhgkrroajmsfwryu.supabase.co';
        // ATENÇÃO: SUBSTITUA ESTA CHAVE PELA SUA CHAVE ANON/PUBLIC KEY DO SUPABASE REAL!
        // NÃO COLOQUE A CHAVE SERVICE_ROLE AQUI, POIS ELA É SENSÍVEL!
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16amRtaGdrcnJvYWptc2Z3cnl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyMzMwMzUsImV4cCI6MjA2MzgwOTAzNX0.tQCwUfFCV7sD-IexQviU0XEPcbn9j5uK9NSUbH-OeBc'; 
        
        // Acessa a função createClient do objeto global 'supabase' fornecido pela CDN
        if (!window.supabaseClient) {
  window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
}
const supabase = window.supabaseClient;

        // Armazenamento de dados (serão substituídos pelos dados do Supabase)
        let documents = [];
        let clients = [];
        let currentProducts = []; // Para adicionar novos clientes
        let editingProducts = []; // Para edição de clientes existentes

        // Funções que são chamadas diretamente de atributos onclick no HTML ou por outras funções globais
        // DEVEM estar no escopo global (fora do DOMContentLoaded)

        function showTab(tabId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            if (document.getElementById(tabId)) { const el = document.getElementById(tabId); if (el) { el.classList.add('active'); } }

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            // O dashboard é um link externo, não um item com onclick que muda a tab diretamente
            const navItemToActivate = document.querySelector(`.nav-item button[onclick="showTab('${tabId}')"]`);
            if (navItemToActivate) {
                 navItemToActivate.parentElement.classList.add('active'); // Adiciona a classe ao <li> pai
            }


            // Renderiza o conteúdo específico da aba
            if (tabId === 'documents') {
                fetchAndRenderDocuments();
                fetchAndRenderDocuments();
            } else if (tabId === 'clients') {
                // Ao ir para a aba de clientes, esconde o botão de editar temporariamente
                document.getElementById('editClientTabButton').style.display = 'none';
                showClientTab('view-clients'); // Padrão para visualizar clientes ao abrir a aba de clientes
                fetchAndRenderClients();
            } else if (tabId === 'homologacao') {
                fetchAndRenderHomologacoes();
            }
            else if (tabId === 'dashboard') { // NOVA ABA: DASHBOARD
                fetchAndRenderDashboards(); 
            }
        }

        function showClientTab(tabId) {
            document.querySelectorAll('.client-tab-content').forEach(section => {
                section.style.display = 'none';
            });
            if (document.getElementById(tabId)) { const el = document.getElementById(tabId); if (el) { el.style.display = 'block'; } }

            // Atualiza os botões da aba de cliente para marcar o ativo
            document.querySelectorAll('.client-tab-button').forEach(button => {
                button.classList.remove('active');
            });
            // Encontra o botão correspondente e adiciona a classe 'active'
            const activeClientButton = document.querySelector(`.client-tab-button[onclick="showClientTab('${tabId}')"]`);
            if (activeClientButton) {
                activeClientButton.classList.add('active');
            }

            // Esconde o botão "Editar Cliente" das abas de adição/visualização, ele só aparece quando uma edição é iniciada
            const editButton = document.getElementById('editClientTabButton');
            if (tabId === 'edit-client-tab') {
                editButton.style.display = 'block'; // Mostra se está na aba de edição
                editButton.classList.add('active'); // Marca como ativo
            } else {
                editButton.style.display = 'none'; // Esconde nas outras abas
                editButton.classList.remove('active');
            }


            if (tabId === 'view-clients') {
                fetchAndRenderClients();
            }
        }

        function previewLogo(input) {
            const logoPreview = document.getElementById('logoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.innerHTML = `<img src="${e.target.result}" class="logo-preview" alt="Logo preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                // Se nenhum arquivo for selecionado, restaura o estado padrão
                logoPreview.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                    <p>Clique para adicionar logo</p>
                `;
            }
        }

        function previewEditLogo(input) {
            const logoPreview = document.getElementById('editLogoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.innerHTML = `<img src="${e.target.result}" class="logo-preview" alt="Logo preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                // Se nenhum arquivo for selecionado, tenta restaurar a logo atual se houver
                const clientId = document.getElementById('editClientId').value;
                const client = clients.find(c => c.id == clientId);
                if (client && client.logo_url) {
                    logoPreview.innerHTML = `<img src="${client.logo_url}" class="logo-preview" alt="Logo preview">`;
                } else {
                     logoPreview.innerHTML = `
                        <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                        <p>Clique para adicionar logo</p>
                    `;
                }
            }
        }

        function addProduct() {
            const productName = document.getElementById('productName').value;
            const productQuantity = document.getElementById('productQuantity').value;

            if (productName && productQuantity > 0) {
                currentProducts.push({ name: productName, quantity: parseInt(productQuantity) });
                updateProductsList('currentProducts', 'productsContainer');
                document.getElementById('productName').value = '';
                document.getElementById('productQuantity').value = '1'; // Resetar para 1
                document.getElementById('productsList').style.display = 'block';
            } else {
                alert('Por favor, insira um nome e uma quantidade válida para o produto.');
            }
        }

        function removeProduct(index, listType) {
            if (listType === 'currentProducts') {
                currentProducts.splice(index, 1);
                updateProductsList('currentProducts', 'productsContainer');
            } else if (listType === 'editingProducts') {
                editingProducts.splice(index, 1);
                updateProductsList('editingProducts', 'editProductsContainer');
            }
        }

        function addEditProduct() {
            const productName = document.getElementById('editProductName').value;
            const productQuantity = document.getElementById('editProductQuantity').value;

            if (productName && productQuantity > 0) {
                editingProducts.push({ name: productName, quantity: parseInt(productQuantity) });
                updateProductsList('editingProducts', 'editProductsContainer');
                document.getElementById('editProductName').value = '';
                document.getElementById('editProductQuantity').value = '1';
                document.getElementById('editProductsList').style.display = 'block';
            } else {
                alert('Por favor, insira um nome e uma quantidade válida para o produto.');
            }
        }

        function updateProductsList(listName, containerId) {
            const productsToRender = listName === 'currentProducts' ? currentProducts : editingProducts;
            const productsContainer = document.getElementById(containerId);
            const productsListDiv = document.getElementById(containerId === 'productsContainer' ? 'productsList' : 'editProductsList');

            if (productsToRender.length === 0) {
                productsContainer.innerHTML = '<p style="color: rgba(255,255,255,0.7);">Nenhum produto adicionado ainda.</p>';
                productsListDiv.style.display = 'none';
                return;
            }
            
            productsListDiv.style.display = 'block'; 
            productsContainer.innerHTML = productsToRender.map((product, index) => `
                <div class="product-item">
                    <span>${product.name} (x${product.quantity})</span>
                    <button class="delete-btn" onclick="removeProduct(${index}, '${listName}')">X</button>
                </div>
            `).join('');
        }

        // A função viewClientDocuments também é chamada diretamente do HTML
        async function viewClientDocuments(clientId) {
            const clientName = clients.find(c => c.id === clientId)?.name || `Cliente ID: ${clientId}`;
            
            let clientDocumentsSection = document.getElementById('view-client-documents');
            if (!clientDocumentsSection) {
                    // Criar a seção dinamicamente se ela não existir (caso a página seja carregada com um link direto para esta aba)
                const clientsDiv = document.getElementById('clients');
                clientsDiv.insertAdjacentHTML('beforeend', `<div id="view-client-documents" class="client-tab-content" style="display:none;"></div>`);
                clientDocumentsSection = document.getElementById('view-client-documents');
            }
            
            clientDocumentsSection.innerHTML = `
                <div class="form-container">
                    <h3 style="margin-bottom: 20px;">Documentos de: ${clientName}</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientDocumentTitle">Título</label>
                            <input type="text" id="clientDocumentTitle" placeholder="Título do documento...">
                        </div>
                        <div class="form-group">
                            <label for="clientDocumentType">Tipo</label>
                            <select id="clientDocumentType">
                                <option value="">Selecione o tipo</option>
                                <option value="apresentacao">Apresentação</option>
                                <option value="relatorio">Relatório</option>
                                <option value="atas">Atas</option>
                                <option value="planilha">Planilha</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="clientDocumentFile">Arquivo</label>
                            <div class="upload-area" onclick="document.getElementById('clientDocumentFile').click()">
                                <div class="upload-icon">📄</div>
                                <p>Arraste e solte ou clique para selecionar um arquivo</p>
                                <input type="file" id="clientDocumentFile" style="display: none;">
                            </div>
                        </div>
                    </div>
                    <button class="btn-secondary" onclick="addClientDocument(${clientId})">Adicionar Documento ao Cliente</button>
                    <button class="btn-secondary" onclick="showClientTab('view-clients')" style="margin-left: 10px;">Voltar aos Clientes</button>
                </div>

                <h3 style="margin-top: 40px; margin-bottom: 20px;">Documentos Existentes</h3>
                <div id="clientDocumentsList" class="documents-grid">
                    <div class="empty-state">
                        <div class="empty-state-icon">📁</div>
                        <p>Nenhum documento para este cliente.</p>
                    </div>
                </div>
            `;
            
            // Exibir a nova aba
            showClientTab('view-client-documents');
            
            // Carregar e renderizar os documentos específicos deste cliente
            await fetchAndRenderClientDocuments(clientId);
        }

        // Funções para documentos
        async function addDocument() {
            const title = document.getElementById('documentTitle').value;
            const author = document.getElementById('documentAuthor').value;
            const type = document.getElementById('documentType').value;
            const fileInput = document.getElementById('documentFile');
            const file = fileInput.files[0];

            if (title && author && type && file) {
                const filePath = `${Date.now()}_${file.name}`;
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('documentfiles') // Nome do seu bucket de documentos
                    .upload(filePath, file);

                if (uploadError) {
                    console.error('Erro ao fazer upload do arquivo:', uploadError.message);
                    alert('Erro ao fazer upload do documento.');
                    return;
                }

                // Ajuste a URL pública para o formato correto do Supabase Storage v1
                // O formato deve ser: SUPABASE_URL/storage/v1/object/public/seu_bucket_name/caminho_do_arquivo
                const publicURL = `${SUPABASE_URL}/storage/v1/object/public/documentfiles/${filePath}`;

                const { data, error } = await supabase
                    .from('documents') // Nome da sua tabela de documentos
                    .insert([
                        { title, author, type, file_url: publicURL, file_path: filePath }
                    ]);

                if (error) {
                    console.error('Erro ao adicionar documento no banco de dados:', error.message);
                    alert('Erro ao adicionar documento.');
                } else {
                    alert('Documento adicionado com sucesso!');
                    // Limpar formulário
                    document.getElementById('documentTitle').value = '';
                    document.getElementById('documentAuthor').value = '';
                    document.getElementById('documentType').value = '';
                    fileInput.value = ''; // Limpa o input de arquivo
                    fetchAndRenderDocuments(); // Re-renderiza os documentos do DB
                }
            } else {
                alert('Por favor, preencha todos os campos e selecione um arquivo.');
            }
        }

        async function fetchAndRenderDocuments() {
            const { data, error } = await supabase
                .from('documents')
                .select('*');

            const container = document.getElementById('documentsList');

            if (error) {
                console.error('Erro ao buscar documentos:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">❌</div><p>Erro ao carregar documentos.</p></div>`;
                return;
            }

            documents = data; // Atualiza a variável local com os dados do Supabase

            if (documents.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📁</div>
                        <p>Nenhum documento encontrado</p>
                        <p>Adicione documentos para começar</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = documents.map(doc => `
                <div class="document-card">
                    <div class="document-header">
                        <span class="document-type">${doc.type}</span>
                        <button class="delete-btn" onclick="deleteDocument(${doc.id}, '${doc.file_path}')">X</button>
                    </div>
                    <div class="document-title">${doc.title}</div>
                    <div class="document-author">${doc.author}</div>
                    <a href="${doc.file_url}" download="${doc.title}.${doc.file_url.split('.').pop()}" target="_blank" class="btn-secondary" style="margin-top: 15px; display: block; text-align: center;">Download</a>
                </div>
            `).join('');
        }

        async function deleteDocument(id, filePath) {
            if (!confirm('Tem certeza que deseja deletar este documento?')) {
                return;
            }

            // Primeiro, deleta o arquivo do Storage
            const { error: storageError } = await supabase.storage
                .from('documentfiles') // Nome do seu bucket de documentos
                .remove([filePath]);

            if (storageError) {
                console.error('Erro ao deletar arquivo do Storage:', storageError.message);
                alert('Erro ao deletar arquivo do Storage. Verifique as permissões do bucket.');
                return;
            }

            // Depois, deleta o registro do banco de dados
            const { error: dbError } = await supabase
                .from('documents') // Nome da sua tabela de documentos
                .delete()
                .eq('id', id);

            if (dbError) {
                console.error('Erro ao deletar documento do banco de dados:', dbError.message);
                alert('Erro ao deletar documento do banco de dados. Verifique as permissões da tabela.');
            } else {
                alert('Documento deletado com sucesso!');
                fetchAndRenderDocuments(); // Re-renderiza os documentos
            }
        }

        // Funções para clientes
        async function saveClient() {
            const name = document.getElementById('clientName').value;
            const email = document.getElementById('clientEmail').value;
            const phone = document.getElementById('clientPhone').value;
            const biLink = document.getElementById('clientBiLink').value; // NOVO: Link do BI
            
            let logoUrl = null;
            let logoPath = null;

            console.log("---------------------------------------");
            console.log("Iniciando saveClient...");
            console.log("Nome do Cliente:", name);
            console.log("Email do Cliente:", email);
            console.log("Telefone do Cliente:", phone);
            console.log("Link do BI do Cliente:", biLink); // NOVO: Log do link do BI
            

            if (name && email && phone) {
                // Tentativa de obter o input do logo aqui, após a validação inicial dos campos
                const logoFileInput = document.getElementById('clientLogo'); 
                
                // DEPURANDO: Verifique se o elemento 'clientLogo' é encontrado.
                console.log("Elemento 'clientLogo' encontrado?", logoFileInput); 

                // Adição da verificação: Apenas tenta fazer upload se o elemento e o arquivo existirem
                if (logoFileInput && logoFileInput.files && logoFileInput.files[0]) {
                    const logoFile = logoFileInput.files[0]; 
                    console.log("Arquivo do logo (obtido do input):", logoFile);

                    if (logoFile) { 
                        console.log("Arquivo de logo detectado.");
                        const logoFilePath = `logos/${Date.now()}_${logoFile.name}`;
                        console.log("Caminho do upload no Storage:", logoFilePath);
                        
                        const { data: uploadData, error: uploadError } = await supabase.storage
                            .from('clientlogos') 
                            .upload(logoFilePath, logoFile);

                        if (uploadError) {
                            console.error('Erro ao fazer upload do logo:', uploadError.message);
                            alert('Erro ao fazer upload do logo. Verifique as permissões do bucket e o console.');
                            return; // Sair da função se o upload falhar
                        }
                        
                        logoUrl = `${SUPABASE_URL}/storage/v1/object/public/clientlogos/${logoFilePath}`;
                        logoPath = logoFilePath;
                        console.log("Upload do logo bem-sucedido. URL Pública:", logoUrl);
                    } else {
                        console.log("Nenhum arquivo de logo selecionado (input vazio). 'logoUrl' permanecerá nulo.");
                    }
                } else {
                    console.warn("Elemento 'clientLogo' não encontrado ou nenhum arquivo selecionado. O cliente será salvo sem logo.");
                    // alert("Erro interno: O campo de seleção de logo não foi encontrado. Por favor, recarregue a página e tente novamente.");
                    // Não dar return aqui, para que o cliente possa ser salvo mesmo sem o logo, se a intenção for essa.
                    // Se o logo for OBRIGATÓRIO, adicione `return;` aqui.
                }


                // Salva o cliente
                console.log("Tentando inserir cliente no banco de dados com logo_url:", logoUrl, "e bi_link:", biLink);
                const { data: clientData, error: clientError } = await supabase
                    .from('clients') 
                    .insert([
                        { name, email, phone, logo_url: logoUrl, logo_path: logoPath, bi_link: biLink } // NOVO: Salva bi_link
                    ])
                    .select(); 

                if (clientError) {
                    console.error('Erro ao salvar cliente no banco de dados:', clientError.message);
                    alert('Erro ao salvar cliente. Verifique as permissões da tabela e o console.');
                    return;
                }

                const clientId = clientData[0].id;
                console.log("Cliente salvo com sucesso! ID:", clientId);

                // Salva os produtos
                if (currentProducts.length > 0) {
                    console.log("Produtos detectados. Tentando salvar produtos...");
                    const productsToInsert = currentProducts.map(p => ({
                        client_id: clientId,
                        name: p.name,
                        quantity: p.quantity
                    }));
                    const { error: productsError } = await supabase
                        .from('products') 
                        .insert(productsToInsert);

                    if (productsError) {
                        console.error('Erro ao salvar produtos:', productsError.message);
                        alert('Cliente salvo, mas erro ao salvar produtos. Verifique as permissões da tabela de produtos.');
                    } else {
                         console.log("Produtos salvos com sucesso!");
                    }
                } else {
                    console.log("Nenhum produto para salvar.");
                }
                
                alert('Cliente salvo com sucesso!');
                // Limpar formulário
                document.getElementById('clientName').value = '';
                document.getElementById('clientEmail').value = '';
                document.getElementById('clientPhone').value = '';
                document.getElementById('clientBiLink').value = ''; // NOVO: Limpa o link do BI
                // Verifica novamente se logoFileInput não é null antes de tentar limpar o valor
                if (logoFileInput) { 
                    logoFileInput.value = ''; 
                }
                document.getElementById('logoPreview').innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                    <p>Clique para adicionar logo</p>
                `;
                currentProducts = [];
                updateProductsList('currentProducts', 'productsContainer');
                fetchAndRenderClients(); 
                showClientTab('view-clients'); 
                
            } else {
                console.log("Campos obrigatórios do cliente não preenchidos.");
                alert('Por favor, preencha todos os campos obrigatórios do cliente.');
            }
            console.log("---------------------------------------");
        }

        async function fetchAndRenderClients() {
            const { data, error } = await supabase
                .from('clients')
                .select(`
                    *,
                    products (
                        id, name, quantity
                    )
                `);

            const container = document.getElementById('clientsList');

            if (error) {
                console.error('Erro ao buscar clientes:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">❌</div><p>Erro ao carregar clientes.</p></div>`;
                return;
            }

            clients = data; // Atualiza a variável local com os dados do Supabase

            if (clients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">👥</div>
                        <p>Nenhum cliente encontrado</p>
                        <p>Adicione clientes para começar</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = clients.map(client => `
                <div class="client-card-vertical">
                    <div class="client-card-top">
                        <button class="delete-btn-card" onclick="deleteClient(${client.id}, '${client.logo_path || ''}')"><span style="font-size: 16px;">🗑️</span></button>
                        <span class="client-status-card">Ativo</span>
                    </div>
                    <div class="client-logo-vertical">
                        ${client.logo_url ? `<img src="${client.logo_url}" alt="Logo" class="logo-preview-vertical">` : client.name.charAt(0).toUpperCase()}
                    </div>
                    <p class="add-logo-text">${client.logo_url ? '' : 'Adicionar Logo'}</p>
                    <h3 class="client-name-vertical">${client.name}</h3>
                    <p class="client-status-text">Cliente Ativo</p>
                    <div class="products-info-vertical">
                        <div style="display: flex; align-items: center; gap: 5px; margin-bottom: 5px;">
                            <span style="font-size: 18px;">📦</span> <span style="font-weight: bold;">Produtos</span> (<span id="productCount-${client.id}">${client.products ? client.products.length : 0}</span>)
                        </div>
                        ${client.products && client.products.length > 0 ? client.products.map(p => `<p style="font-size: 14px; margin-left: 25px;">• ${p.name} (x${p.quantity})</p>`).join('') : '<p style="font-size: 14px; color: rgba(255,255,255,0.6); margin-left: 25px;">Nenhum produto</p>'}
                    </div>
                    <button class="btn-vertical" onclick="viewClientDocuments(${client.id})">Ver Documentos</button>
                    <button class="btn-vertical edit" onclick="editClient(${client.id})">Editar Cliente</button>
                </div>
            `).join('');
        }
        
        async function deleteClient(id, logoPath) { // Agora espera logoPath
            if (!confirm('Tem certeza que deseja deletar este cliente e todos os seus produtos e documentos? Esta ação é irreversível.')) {
                return;
            }

            // Se houver um logoPath, tenta deletá-lo do Storage
            if (logoPath) {
                const { error: storageError } = await supabase.storage
                    .from('clientlogos') 
                    .remove([logoPath]);

                if (storageError) {
                    console.warn('Aviso: Erro ao deletar logo do Storage (pode não existir ou caminho incorreto). Continuando com a exclusão do cliente no DB:', storageError.message);
                }
            }

            // Deleta o cliente (produtos e documentos associados serão deletados via ON DELETE CASCADE se configurado no DB)
            const { error: dbError } = await supabase
                .from('clients') 
                .delete()
                .eq('id', id);

            if (dbError) {
                console.error('Erro ao deletar cliente do banco de dados:', dbError.message);
                alert('Erro ao deletar cliente do banco de dados. Verifique as permissões da tabela ou as regras ON DELETE CASCADE.');
            } else {
                alert('Cliente deletado com sucesso!');
                fetchAndRenderClients(); 
            }
        }

        async function editClient(clientId) {
            const clientToEdit = clients.find(c => c.id === clientId);

            if (!clientToEdit) {
                alert('Cliente não encontrado para edição.');
                return;
            }

            // Preenche o formulário de edição
            document.getElementById('editClientId').value = clientToEdit.id;
            document.getElementById('editClientName').value = clientToEdit.name;
            document.getElementById('editClientEmail').value = clientToEdit.email;
            document.getElementById('editClientPhone').value = clientToEdit.phone;
            document.getElementById('editClientBiLink').value = clientToEdit.bi_link || ''; // NOVO: Preenche o link do BI

            const editLogoPreview = document.getElementById('editLogoPreview');
            if (clientToEdit.logo_url) {
                editLogoPreview.innerHTML = `<img src="${clientToEdit.logo_url}" class="logo-preview" alt="Logo preview">`;
            } else {
                editLogoPreview.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                    <p>Clique para adicionar logo</p>
                `;
            }

            // Carrega os produtos existentes para a edição
            editingProducts = clientToEdit.products ? [...clientToEdit.products] : [];
            updateProductsList('editingProducts', 'editProductsContainer');

            // Exibe a aba de edição
            showClientTab('edit-client-tab');
        }

        async function updateClient() {
            const clientId = document.getElementById('editClientId').value;
            const name = document.getElementById('editClientName').value;
            const email = document.getElementById('editClientEmail').value;
            const phone = document.getElementById('editClientPhone').value;
            const biLink = document.getElementById('editClientBiLink').value; // NOVO: Pega o link do BI
            const logoFileInput = document.getElementById('editClientLogo');
            const newLogoFile = logoFileInput.files[0];

            if (!name || !email || !phone) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            let logoUrl = null;
            let logoPath = null;
            const currentClient = clients.find(c => c.id == clientId);

            // 1. Lidar com o upload/atualização do logo
            if (newLogoFile) {
                // Se um novo arquivo foi selecionado, faça o upload e atualize
                const newLogoPath = `logos/${Date.now()}_${newLogoFile.name}`;
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('clientlogos') 
                    .upload(newLogoPath, newLogoFile);

                if (uploadError) {
                    console.error('Erro ao fazer upload do novo logo:', uploadError.message);
                    alert('Erro ao fazer upload do novo logo.');
                    return;
                }
                logoUrl = `${SUPABASE_URL}/storage/v1/object/public/clientlogos/${newLogoPath}`;
                logoPath = newLogoPath;

                // Se havia um logo antigo, tente deletá-lo do Storage
                if (currentClient && currentClient.logo_path) {
                    const { error: deleteOldLogoError } = await supabase.storage
                        .from('clientlogos')
                        .remove([currentClient.logo_path]);
                    if (deleteOldLogoError) {
                        console.warn('Aviso: Erro ao deletar logo antigo do Storage:', deleteOldLogoError.message);
                    }
                }
            } else {
                // Se nenhum novo arquivo foi selecionado, manter o logo existente (se houver)
                if (currentClient) {
                    logoUrl = currentClient.logo_url;
                    logoPath = currentClient.logo_path;
                }
            }

            // 2. Atualizar os dados do cliente no banco de dados
            const { error: clientError } = await supabase
                .from('clients')
                .update({ name, email, phone, logo_url: logoUrl, logo_path: logoPath, bi_link: biLink }) // NOVO: Atualiza bi_link
                .eq('id', clientId);

            if (clientError) {
                console.error('Erro ao atualizar cliente no banco de dados:', clientError.message);
                alert('Erro ao atualizar cliente.');
                return;
            }

            // 3. Atualizar os produtos associados: Deletar os antigos e inserir os novos
            // Primeiro, deleta todos os produtos associados a este cliente
            const { error: deleteProductsError } = await supabase
                .from('products')
                .delete()
                .eq('client_id', clientId);

            if (deleteProductsError) {
                console.error('Erro ao deletar produtos antigos:', deleteProductsError.message);
                alert('Cliente atualizado, mas erro ao limpar produtos antigos.');
                // Pode continuar, pois o cliente já foi atualizado
            }

            // Depois, insere os produtos da lista de edição
            if (editingProducts.length > 0) {
                const productsToInsert = editingProducts.map(p => ({
                    client_id: parseInt(clientId), // Garante que é um número
                    name: p.name,
                    quantity: p.quantity
                }));
                const { error: insertProductsError } = await supabase
                    .from('products')
                    .insert(productsToInsert);

                if (insertProductsError) {
                    console.error('Erro ao inserir novos produtos:', insertProductsError.message);
                    alert('Cliente atualizado, mas erro ao adicionar novos produtos.');
                }
            }

            alert('Cliente atualizado com sucesso!');
            // Limpa o input de arquivo do logo de edição
            logoFileInput.value = ''; 
            editingProducts = []; // Limpa a lista de produtos de edição
            fetchAndRenderClients(); // Re-renderiza a lista de clientes
            showClientTab('view-clients'); // Volta para a visualização de clientes
        }


        async function addClientDocument(clientId) {
            const title = document.getElementById('clientDocumentTitle').value;
            const type = document.getElementById('clientDocumentType').value;
            const fileInput = document.getElementById('clientDocumentFile');
            const file = fileInput.files[0];

            if (title && type && file) {
                const filePath = `client_documents/${clientId}/${Date.now()}_${file.name}`;
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('clientdocumentfiles') 
                    .upload(filePath, file);

                if (uploadError) {
                    console.error('Erro ao fazer upload do arquivo do cliente:', uploadError.message);
                    alert('Erro ao fazer upload do documento do cliente. Verifique as permissões do bucket.');
                    return;
                }

                const publicURL = `${SUPABASE_URL}/storage/v1/object/public/clientdocumentfiles/${filePath}`;

                const { data, error } = await supabase
                    .from('client_documents') 
                    .insert([
                        { client_id: clientId, title, type, file_url: publicURL, file_path: filePath }
                    ]);

                if (error) {
                    console.error('Erro ao adicionar documento do cliente no banco de dados:', error.message);
                    alert('Erro ao adicionar documento do cliente. Verifique as permissões da tabela.');
                } else {
                    alert('Documento do cliente adicionado com sucesso!');
                    // Limpar formulário
                    document.getElementById('clientDocumentTitle').value = '';
                    document.getElementById('clientDocumentType').value = '';
                    fileInput.value = '';
                    fetchAndRenderClientDocuments(clientId); 
                }
            } else {
                alert('Por favor, preencha todos os campos e selecione um arquivo para o documento do cliente.');
            }
        }

        async function fetchAndRenderClientDocuments(clientId) {
            const { data, error } = await supabase
                .from('client_documents') 
                .select('*')
                .eq('client_id', clientId);

            const container = document.getElementById('clientDocumentsList');

            if (error) {
                console.error('Erro ao buscar documentos do cliente:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">❌</div><p>Erro ao carregar documentos do cliente.</p></div>`;
                return;
            }

            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📁</div>
                        <p>Nenhum documento para este cliente.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.map(doc => `
                <div class="document-card">
                    <div class="document-header">
                        <span class="document-type">${doc.type}</span>
                        <button class="delete-btn" onclick="deleteClientDocument(${doc.id}, '${doc.file_path}', ${clientId})">X</button>
                    </div>
                    <div class="document-title">${doc.title}</div>
                    <div class="document-author">ID do Cliente: ${doc.client_id}</div>
                    <a href="${doc.file_url}" download="${doc.title}.${doc.file_url.split('.').pop()}" target="_blank" class="btn-secondary" style="margin-top: 15px; display: block; text-align: center;">Download</a>
                </div>
            `).join('');
        }

        async function deleteClientDocument(documentId, filePath, clientId) {
            if (!confirm('Tem certeza que deseja deletar este documento do cliente?')) {
                return;
            }

            // Primeiro, deleta o arquivo do Storage
            const { error: storageError } = await supabase.storage
                .from('clientdocumentfiles') 
                .remove([filePath]);

            if (storageError) {
                console.error('Erro ao deletar arquivo do Storage do cliente:', storageError.message);
                alert('Erro ao deletar arquivo do Storage do cliente. Verifique as permissões do bucket.');
                return;
            }

            // Depois, deleta o registro do banco de dados
            const { error: dbError } = await supabase
                .from('client_documents') 
                .delete()
                .eq('id', documentId);

            if (dbError) {
                console.error('Erro ao deletar documento do cliente do banco de dados:', dbError.message);
                alert('Erro ao deletar documento do cliente do banco de dados. Verifique as permissões da tabela.');
            } else {
                alert('Documento do cliente deletado com sucesso!');
                fetchAndRenderClientDocuments(clientId); 
            }
        }

        // NOVO: Funções para a aba de Dashboards
        async function fetchAndRenderDashboards() {
            const { data, error } = await supabase
                .from('clients')
                .select('id, name, logo_url, bi_link') // Seleciona apenas o necessário
                .not('bi_link', 'is', null) // Apenas clientes que têm um link de BI
                .not('bi_link', 'eq', ''); // E que o link não seja vazio

            const container = document.getElementById('dashboardsList');

            if (error) {
                console.error('Erro ao buscar dashboards:', error.message);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">❌</div><p>Erro ao carregar dashboards.</p></div>`;
                return;
            }

            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📊</div>
                        <p>Nenhum Dashboard de cliente encontrado.</p>
                        <p>Adicione clientes com links de BI para visualizá-los aqui.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.map(client => `
                <div class="dashboard-card">
                    <div class="client-logo-vertical">
                        ${client.logo_url ? `<img src="${client.logo_url}" alt="Logo" class="logo-preview-vertical">` : client.name.charAt(0).toUpperCase()}
                    </div>
                    <h3>${client.name}</h3>
                    <a href="${client.bi_link}" target="_blank" class="btn-bi">
                        <i class="fas fa-external-link-alt"></i> Acessar
                    </a>
                </div>
            `).join('');
        }


        // O código dentro deste bloco só será executado quando o DOM estiver completamente carregado.
        document.addEventListener('DOMContentLoaded', () => {
            showTab('documents'); // Agora "Time de Implantação" é a aba padrão ao carregar
        });

        // Helper function to convert hex to rgb for rgba usage
        function hexToRgb(hex) {
            var bigint = parseInt(hex.slice(1), 16);
            var r = (bigint >> 16) & 255;
            var g = (bigint >> 8) & 255;
            var b = bigint & 255;
            return `${r}, ${g}, ${b}`;
        }

        // Set RGB variables dynamically for rgba usage
        document.documentElement.style.setProperty('--primary-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--primary-color')));
        document.documentElement.style.setProperty('--text-color-rgb', hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--text-color')));

    

async function filtrarHomologacoes() {
    const sistemaFiltro = document.getElementById('filtroSistema').value.toLowerCase();
    const especialistaFiltro = document.getElementById('filtroEspecialista').value.toLowerCase();

    const { data, error } = await supabase
        .from('homologacoes')
        .select('*')
        .order('data_liberacao', { ascending: false });

    if (error || !data) return;

    const filtradas = data.filter(h =>
        (!sistemaFiltro || h.sistema.toLowerCase().includes(sistemaFiltro)) &&
        (!especialistaFiltro || h.especialista.toLowerCase().includes(especialistaFiltro))
    );

    const grid = document.getElementById('homologacoesGrid');
    const empty = document.getElementById('emptyState');

    if (filtradas.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'flex';
    } else {
        empty.style.display = 'none';
        grid.innerHTML = filtradas.map(h => {
            let html = '';
            html += '<div class="homologacao-card">';
            html += '<h4>Versão: ' + h.versao + '</h4>';
            html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
            html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
            html += '<p><strong>Liberação:</strong> ' + h.data_liberacao + '</p>';
            html += '<p><strong>Homologação:</strong> ' + (h.data_homologacao || '-') + '</p>';
            html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
            if (h.arquivos && h.arquivos.length) {
                html += '<p><strong>Arquivos:</strong><br>' + h.arquivos.map(function(a, i) {
        return '<a href="' + a + '" download target="_blank">📄 Arquivo ' + (i + 1) + '</a>';
    }).join('<br>') + '</p>';
            }
            html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '</div>';
            return html;
        }).join('');
    }
}

</script>
<script>
        let arquivosSelecionados = [];
        let homologacoesSalvas = JSON.parse(localStorage.getItem('homologacoes')) || [];

        // Função para abrir abas
        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove('active');
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            const tab = document.getElementById(tabName); if (tab) { tab.style.display = "block"; tab.classList.add("active"); }
            if (evt && evt.currentTarget) { evt.currentTarget.classList.add("active"); }

            // Se for a aba de homologações, atualiza a exibição
            if (tabName === 'listaHomologacoes') {
                exibirHomologacoes();
            }
        }

        // Carregar homologações ao iniciar e ativar a primeira aba
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('.tab-button').click(); // Ativa a primeira aba por padrão
            exibirHomologacoes(); // Garante que as homologações sejam carregadas
        });

        // Upload de arquivos (mesmo código original)
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            adicionarArquivos(files);
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            adicionarArquivos(files);
        });

        function adicionarArquivos(files) {
            files.forEach(file => {
                if (file.size > 10 * 1024 * 1024) {
                    alert(`Arquivo ${file.name} é muito grande. Limite: 10MB`);
                    return;
                }
                
                if (!arquivosSelecionados.find(f => f.name === file.name)) {
                    arquivosSelecionados.push(file);
                    criarItemArquivo(file);
                }
            });
        }

        function criarItemArquivo(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-info">
                    <span class="file-name">📄 ${file.name}</span>
                    <span class="file-size">(${formatarTamanho(file.size)})</span>
                </div>
                <button type="button" class="remove-file" onclick="removerArquivo('${file.name}')">
                    ❌ Remover
                </button>
            `;
            fileList.appendChild(fileItem);
        }

        function removerArquivo(nomeArquivo) {
            arquivosSelecionados = arquivosSelecionados.filter(f => f.name !== nomeArquivo);
            const fileItems = fileList.children;
            for (let item of fileItems) {
                if (item.querySelector('.file-name').textContent.includes(nomeArquivo)) {
                    fileList.removeChild(item);
                    break;
                }
            }
        }

        function formatarTamanho(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Envio do formulário (mesmo código original, com pequena alteração no scroll)
        document.getElementById('homologacaoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('especialista', document.getElementById('especialista').value);
            formData.append('versao', document.getElementById('versao').value);
            formData.append('dataLiberacao', document.getElementById('dataLiberacao').value);
            formData.append('dataHomologacao', document.getElementById('dataHomologacao').value);
            formData.append('sistema', document.getElementById('sistema').value);
            formData.append('observacao', document.getElementById('observacao').value);
            
            arquivosSelecionados.forEach((file, index) => {
                formData.append(`arquivo_${index}`, file);
            });

            const btn = document.querySelector('.btn-primary');
            const textoOriginal = btn.innerHTML;
            btn.innerHTML = '⏳ Enviando...';
            btn.disabled = true;

            setTimeout(() => {
                const novaHomologacao = {
                    id: Date.now(),
                    especialista: document.getElementById('especialista').value,
                    versao: document.getElementById('versao').value,
                    dataLiberacao: document.getElementById('dataLiberacao').value,
                    dataHomologacao: document.getElementById('dataHomologacao').value,
                    sistema: document.getElementById('sistema').value,
                    observacao: document.getElementById('observacao').value,
                    arquivos: arquivosSelecionados.map(file => ({
                        nome: file.name,
                        tamanho: file.size,
                        tipo: file.type
                    })),
                    dataCriacao: new Date().toISOString()
                };

                homologacoesSalvas.unshift(novaHomologacao);
                localStorage.setItem('homologacoes', JSON.stringify(homologacoesSalvas));
                
                alert('✅ Homologação registrada com sucesso!');
                btn.innerHTML = textoOriginal;
                btn.disabled = false;
                
                limparFormulario();
                exibirHomologacoes();
                
                // Mudar para a aba de homologações após salvar
                openTab(new Event('click'), 'listaHomologacoes');
            }, 2000);
        });

        function limparFormulario() {
            document.getElementById('homologacaoForm').reset();
        document.getElementById('fileList').innerHTML = '';
        document.getElementById('fileInput').value = '';
            arquivosSelecionados = [];
            fileList.innerHTML = '';
        }

        // Data automática
        document.getElementById('dataLiberacao').valueAsDate = new Date();

        // Funções para gerenciar homologações salvas (mesmo código original)
        function exibirHomologacoes() {
            const grid = document.getElementById('homologacoesGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (homologacoesSalvas.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            emptyState.style.display = 'none';
            
            grid.innerHTML = homologacoesSalvas.map(homologacao => criarCardHomologacao(homologacao)).join('');
        }

        function criarCardHomologacao(homologacao) {
            const dataLib = new Date(homologacao.dataLiberacao).toLocaleDateString('pt-BR');
            const dataHom = homologacao.dataHomologacao ? 
                new Date(homologacao.dataHomologacao).toLocaleDateString('pt-BR') : 
                'Pendente';
            
            const status = homologacao.dataHomologacao ? 'aprovado' : 'pendente';
            const statusText = homologacao.dataHomologacao ? 'Aprovado' : 'Pendente';
            
            return `
                <div class="homologacao-card">
                    <div class="status-indicator">
                        <span class="status-badge status-${status}">${statusText}</span>
                    </div>
                    
                    <div class="card-header">
                        <div>
                            <div class="card-title">${homologacao.sistema} ${homologacao.versao}</div>
                            <div class="card-subtitle">Por: ${homologacao.especialista}</div>
                        </div>
                    </div>
                    
                    <div class="card-info">
                        <div class="info-item">
                            <span class="info-label">📅 Data Liberação</span>
                            <span class="info-value">${dataLib}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">✅ Data Homologação</span>
                            <span class="info-value">${dataHom}</span>
                        </div>
                    </div>
                    
                    ${homologacao.observacao ? `
                        <div class="card-observacao">
                            <div class="info-label">📝 Observações</div>
                            <div class="info-value">${homologacao.observacao}</div>
                        </div>
                    ` : ''}
                    
                    ${homologacao.arquivos && homologacao.arquivos.length > 0 ? `
                        <div class="card-arquivos">
                            <div class="info-label">📁 Arquivos (${homologacao.arquivos.length})</div>
                            ${homologacao.arquivos.map(arquivo => `
                                <div class="arquivo-item">
                                    <span>📄 ${arquivo.nome}</span>
                                    <span style="color: #7f8c8d; font-size: 0.8em;">(${formatarTamanho(arquivo.tamanho)})</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="card-actions">
                        <button class="btn-small btn-view" onclick="visualizarHomologacao(${homologacao.id})">
                            👁️ Ver
                        </button>
                        <button class="btn-small btn-download" onclick="exportarHomologacao(${homologacao.id})">
                            <button onclick="baixarArquivosIndividuais(JSON.parse(this.dataset.arquivos))" data-arquivos='["URL_DO_ARQUIVO_AQUI"]'>📥 Exportar</button>
                        </button>
                        <button class="btn-small btn-delete" onclick="excluirHomologacao(${homologacao.id})">
                            🗑️ Excluir
                        </button>
                    </div>
                </div>
            `;
        }

        function filtrarHomologacoes() {
            const filtroSistema = document.getElementById('filtroSistema').value.toLowerCase();
            const filtroEspecialista = document.getElementById('filtroEspecialista').value.toLowerCase();
            
            const homologacoesFiltradas = homologacoesSalvas.filter(h => {
                const matchSistema = !filtroSistema || h.sistema.toLowerCase().includes(filtroSistema);
                const matchEspecialista = !filtroEspecialista || h.especialista.toLowerCase().includes(filtroEspecialista);
                return matchSistema && matchEspecialista;
            });
            
            const grid = document.getElementById('homologacoesGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (homologacoesFiltradas.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                grid.style.display = 'grid';
                emptyState.style.display = 'none';
                grid.innerHTML = homologacoesFiltradas.map(h => criarCardHomologacao(h)).join('');
            }
        }

        function visualizarHomologacao(id) {
            const homologacao = homologacoesSalvas.find(h => h.id === id);
            if (!homologacao) return;
            
            const detalhes = `
                🚀 DETALHES DA HOMOLOGAÇÃO
                
                👨‍💻 Especialista: ${homologacao.especialista}
                🖥️ Sistema: ${homologacao.sistema}
                📋 Versão: ${homologacao.versao}
                📅 Data Liberação: ${new Date(homologacao.dataLiberacao).toLocaleDateString('pt-BR')}
                ✅ Data Homologação: ${homologacao.dataHomologacao ? new Date(homologacao.dataHomologacao).toLocaleDateString('pt-BR') : 'Pendente'}
                
                📝 Observações:
                ${homologacao.observacao || 'Nenhuma observação'}
                
                📁 Arquivos: ${homologacao.arquivos ? homologacao.arquivos.length : 0}
                ${homologacao.arquivos ? homologacao.arquivos.map(a => `• ${a.nome}`).join('\n') : ''}
            `;
            
            alert(detalhes);
        }

        function exportarHomologacao(id) {
            const homologacao = homologacoesSalvas.find(h => h.id === id);
            if (!homologacao) return;
            
            const dados = JSON.stringify(homologacao, null, 2);
            const blob = new Blob([dados], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `homologacao_${homologacao.sistema.replace(/\s/g, '_')}_${homologacao.versao}.json`; // Nome do arquivo mais amigável
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function excluirHomologacao(id) {
            if (confirm('❓ Tem certeza que deseja excluir esta homologação?')) {
                homologacoesSalvas = homologacoesSalvas.filter(h => h.id !== id);
                localStorage.setItem('homologacoes', JSON.stringify(homologacoesSalvas));
                exibirHomologacoes();
            }
        }
    

async function filtrarHomologacoes() {
    const sistemaFiltro = document.getElementById('filtroSistema').value.toLowerCase();
    const especialistaFiltro = document.getElementById('filtroEspecialista').value.toLowerCase();

    const { data, error } = await supabase
        .from('homologacoes')
        .select('*')
        .order('data_liberacao', { ascending: false });

    if (error || !data) return;

    const filtradas = data.filter(h =>
        (!sistemaFiltro || h.sistema.toLowerCase().includes(sistemaFiltro)) &&
        (!especialistaFiltro || h.especialista.toLowerCase().includes(especialistaFiltro))
    );

    const grid = document.getElementById('homologacoesGrid');
    const empty = document.getElementById('emptyState');

    if (filtradas.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'flex';
    } else {
        empty.style.display = 'none';
        grid.innerHTML = filtradas.map(h => {
            let html = '';
            html += '<div class="homologacao-card">';
            html += '<h4>Versão: ' + h.versao + '</h4>';
            html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
            html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
            html += '<p><strong>Liberação:</strong> ' + h.data_liberacao + '</p>';
            html += '<p><strong>Homologação:</strong> ' + (h.data_homologacao || '-') + '</p>';
            html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
            if (h.arquivos && h.arquivos.length) {
                html += '<p><strong>Arquivos:</strong><br>' + h.arquivos.map(function(a, i) {
        return '<a href="' + a + '" download target="_blank">📄 Arquivo ' + (i + 1) + '</a>';
    }).join('<br>') + '</p>';
            }
            html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(h.arquivos)">⬇️ Baixar Todos</button>';
html += '</div>';
            return html;
        }).join('');
    }
}

</script>




<script>
async function fetchAndRenderHomologacoes() {
    const { data, error } = await supabase
        .from('homologacoes')
        .select('*')
        .order('data_liberacao', { ascending: false });

    const grid = document.getElementById('homologacoesGrid');
    const empty = document.getElementById('emptyState');

    if (error || !data || data.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'flex';
        return;
    }

    empty.style.display = 'none';
    grid.innerHTML = data.map(h => {
        let html = "";
        html += '<div class="homologacao-card">';
        html += '<h4>Versão: ' + h.versao + '</h4>';
        html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
        html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
        html += '<p><strong>Liberação:</strong> ' + h.data_liberacao + '</p>';
        html += '<p><strong>Homologação:</strong> ' + (h.data_homologacao || '-') + '</p>';
        html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
        if (h.arquivos && h.arquivos.length) {
            html += '<p><strong>Arquivos:</strong><br>' +
                h.arquivos.map(function(file, i) {
                    return '<a href="#" onclick='baixarArquivosIndividuais([{' +
                        '"nome":"' + file.nome + '",' +
                        '"path":"' + file.path + '"' +
                    '}])'>📄 ' + file.nome + '</a>';
                }).join('<br>') +
            '</p>';

            const arquivosString = encodeURIComponent(JSON.stringify(h.arquivos));
            html += '<button class="btn-exportar" onclick="baixarArquivosIndividuais(JSON.parse(decodeURIComponent(this.dataset.arquivos)))"';
            html += ' data-arquivos="' + arquivosString + '">📥 Exportar</button>';
        }
        html += '</div>';
        return html;
    }).join('');
}
</script>








<script>
async function baixarArquivosIndividuais(arquivos) {
    if (!arquivos || arquivos.length === 0) {
        alert("Nenhum arquivo para baixar.");
        return;
    }

    for (let i = 0; i < arquivos.length; i++) {
        const url = arquivos[i];
        const filename = url.split('/').pop();

        try {
            const response = await fetch(url);
            const blob = await response.blob();
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        } catch (error) {
            console.error("Erro ao baixar arquivo:", url, error);
        }
    }
}
</script>





<script>
const SUPABASE_URL = 'https://<SEU_PROJETO>.supabase.co';  // Substituir pelo seu projeto real
const SUPABASE_ANON_KEY = '<SUA_ANON_KEY>';                // Substituir pela chave real
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(sec => sec.style.display = 'none');
    const tab = document.getElementById(tabId);
    if (tab) tab.style.display = 'block';
    if (tabId === 'listaHomologacoes') {
        fetchAndRenderHomologacoes();
    }
}

async function baixarArquivosIndividuais(arquivos) {
    if (!arquivos || arquivos.length === 0) {
        alert("Nenhum arquivo para baixar.");
        return;
    }

    for (let i = 0; i < arquivos.length; i++) {
        const { path, nome } = arquivos[i];
        try {
            const { data, error } = await supabase
              .storage
              .from('homologacaoarquivos')
              .createSignedUrl(path, 120, { download: true });

            if (data?.signedUrl) {
                const response = await fetch(data.signedUrl);
                const blob = await response.blob();
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = nome;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                console.error("Erro ao gerar URL assinada:", error);
            }
        } catch (error) {
            console.error("Erro ao baixar:", nome, error);
        }
    }
}

async function fetchAndRenderHomologacoes() {
    const { data, error } = await supabase
        .from('homologacoes')
        .select('*')
        .order('data_liberacao', { ascending: false });

    const grid = document.getElementById('homologacoesGrid');
    const empty = document.getElementById('emptyState');

    if (error || !data || data.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'flex';
        return;
    }

    empty.style.display = 'none';
    grid.innerHTML = data.map(h => {
        let html = "";
        html += '<div class="homologacao-card">';
        html += '<h4>Versão: ' + h.versao + '</h4>';
        html += '<p><strong>Especialista:</strong> ' + h.especialista + '</p>';
        html += '<p><strong>Sistema:</strong> ' + h.sistema + '</p>';
        html += '<p><strong>Liberação:</strong> ' + h.data_liberacao + '</p>';
        html += '<p><strong>Homologação:</strong> ' + (h.data_homologacao || '-') + '</p>';
        html += '<p><strong>Obs:</strong> ' + (h.observacao || '-') + '</p>';
        if (h.arquivos && h.arquivos.length) {
            html += '<p><strong>Arquivos:</strong><br>' + h.arquivos.map(function(a, i) {
                return '<a href="#" onclick='baixarArquivosIndividuais([' + JSON.stringify(a) + '])'>📄 ' + a.nome + '</a>';
            }).join('<br>') + '</p>';
            html += '<button class="btn-exportar" onclick='baixarArquivosIndividuais(' + JSON.stringify(h.arquivos) + ')'>📥 Exportar</button>';
        }
        html += '</div>';
        return html;
    }).join('');
}

document.addEventListener('DOMContentLoaded', () => {
    showTab('listaHomologacoes');
});
</script>


<script>
async function enviarHomologacaoComArquivos() {
  const versao = document.getElementById('versao').value;
  const especialista = document.getElementById('especialista').value;
  const sistema = document.getElementById('sistema').value;
  const data_liberacao = document.getElementById('data_liberacao').value;
  const data_homologacao = document.getElementById('data_homologacao').value;
  const observacao = document.getElementById('observacao').value;
  const arquivosSelecionados = document.getElementById('arquivos').files;

  const arquivos = [];

  for (const file of arquivosSelecionados) {
    const path = `${Date.now()}_${file.name}`;
    const { data, error } = await supabase
      .storage
      .from('homologacaoarquivos')
      .upload(path, file);

    if (!error) {
      arquivos.push({
        nome: file.name,
        path: path
      });
    } else {
      console.error('Erro no upload:', error);
    }
  }

  const { error: insertError } = await supabase
    .from('homologacoes')
    .insert([{
      versao,
      especialista,
      sistema,
      data_liberacao,
      data_homologacao,
      observacao,
      arquivos
    }]);

  if (insertError) {
    alert('Erro ao salvar homologação');
    console.error(insertError);
  } else {
    alert('Homologação registrada com sucesso!');
    document.getElementById('formHomologacao').reset();
    fetchAndRenderHomologacoes();
  }
}
</script>

</body>
</html>
